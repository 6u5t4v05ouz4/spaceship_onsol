import{_}from"./main-261ff586.js";import{s as g}from"./HeaderNavigation-e41ffb9c.js";import"./phaser-23102255.js";class w{constructor(e){this.scene=e,this.config={screenShake:1,flashEffects:1,particles:1,slowMotion:1,soundEffects:1,enabled:!0},this.shakeState={duration:0,intensity:0,originalX:0,originalY:0}}screenShake(e=200,t=5){if(!this.config.enabled||this.config.screenShake===0)return;const s=this.scene.cameras.main,a=t*this.config.screenShake;s.shake(e,a*.01)}flash(e=100,t=16777215,s=.5){if(!this.config.enabled||this.config.flashEffects===0)return;const a=this.scene.cameras.main,n=s*this.config.flashEffects;a.flash(e,t>>16&255,t>>8&255,t&255,!1,null,n)}slowMotion(e=200,t=.3){if(!this.config.enabled||this.config.slowMotion===0)return;const s=1-(1-t)*this.config.slowMotion;this.scene.time.timeScale=s,this.scene.time.delayedCall(e,()=>{this.scene.time.timeScale=1})}impactEffect(e="medium"){const t={small:{shake:3,flash:80,flashAlpha:.3,slowDuration:0},medium:{shake:6,flash:120,flashAlpha:.5,slowDuration:100},large:{shake:10,flash:200,flashAlpha:.7,slowDuration:200}},s=t[e]||t.medium;this.screenShake(s.flash,s.shake),this.flash(s.flash,16777215,s.flashAlpha),s.slowDuration>0&&this.slowMotion(s.slowDuration,.5)}damageFlash(e,t=100){if(!this.config.enabled)return;const s=e.tintTopLeft;e.setTint(16711680),this.scene.time.delayedCall(t,()=>{e.clearTint(),s!==16777215&&e.setTint(s)})}pulse(e,t=1.2,s=300){this.config.enabled&&(e.scale,this.scene.tweens.add({targets:e,scale:t,duration:s/2,yoyo:!0,ease:"Sine.easeInOut"}))}fadeIn(e=500){this.scene.cameras.main.fadeIn(e,0,0,0)}fadeOut(e=500,t=null){this.scene.cameras.main.fadeOut(e,0,0,0),t&&this.scene.time.delayedCall(e,t)}setConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}}class C{constructor(e){this.scene=e,this.volumes={master:1,music:.6,sfx:.8,ui:.5},this.soundPool=new Map}play(e,t={}){const{volume:s=1,pitchVariation:a=.1,category:n="sfx",loop:i=!1}=t,o=s*this.volumes[n]*this.volumes.master,r=1+(Math.random()*2-1)*a;try{const h=this.scene.sound.add(e,{volume:o,rate:r,loop:i});return h.play(),i||h.once("complete",()=>h.destroy()),h}catch(h){return console.warn(`Erro ao reproduzir som ${e}:`,h),null}}playExplosion(e="medium"){const t={small:{variation:.2,volume:.4},medium:{variation:.15,volume:.6},large:{variation:.1,volume:.8}},s=t[e]||t.medium;this.play("explosion",{volume:s.volume,pitchVariation:s.variation,category:"sfx"})}playShoot(){this.play("bullet",{volume:.3,pitchVariation:.25,category:"sfx"})}playImpact(e=1){this.play("explosion",{volume:.3*e,pitchVariation:.3,category:"sfx"})}playAmbient(e,t=.3){const s=this.play(e,{volume:t,pitchVariation:0,category:"music",loop:!0});return s&&this.soundPool.set(`ambient_${e}`,s),s}stop(e,t=0){const s=this.soundPool.get(e);s&&(t>0?this.scene.tweens.add({targets:s,volume:0,duration:t,onComplete:()=>{s.stop(),s.destroy(),this.soundPool.delete(e)}}):(s.stop(),s.destroy(),this.soundPool.delete(e)))}setVolume(e,t){this.volumes[e]=Phaser.Math.Clamp(t,0,1),this.soundPool.forEach((s,a)=>{a.startsWith(e)&&s.setVolume(t*this.volumes.master)})}setMasterVolume(e){this.volumes.master=Phaser.Math.Clamp(e,0,1),this.scene.sound.volume=this.volumes.master}stopAll(){this.scene.sound.stopAll(),this.soundPool.forEach(e=>e.destroy()),this.soundPool.clear()}destroy(){this.stopAll()}}class E{constructor(e){this.scene=e,this.emitters=new Map,this.createParticleTextures()}createParticleTextures(){if(!this.scene.textures.exists("particle_basic")){const e=this.scene.add.graphics();e.fillStyle(16777215,1),e.fillCircle(4,4,4),e.generateTexture("particle_basic",8,8),e.destroy()}if(!this.scene.textures.exists("particle_spark")){const e=this.scene.add.graphics();e.fillStyle(16777215,1),e.fillRect(0,0,8,2),e.generateTexture("particle_spark",8,2),e.destroy()}if(!this.scene.textures.exists("particle_square")){const e=this.scene.add.graphics();e.fillStyle(16777215,1),e.fillRect(0,0,4,4),e.generateTexture("particle_square",4,4),e.destroy()}}createThrustEffect(e){const t=this.scene.add.particles(0,0,"particle_basic",{speed:{min:50,max:150},scale:{start:.4,end:0},alpha:{start:.8,end:0},lifespan:300,frequency:60,tint:[16737792,16750848,52479],blendMode:"ADD",follow:e,followOffset:{x:0,y:0},emitting:!1});t.setDepth(e.depth-1);const s=`thrust_${Date.now()}`;return this.emitters.set(s,{emitter:t,ship:e}),s}updateThrustEffect(e){const t=this.emitters.get(e);if(!t)return;const{emitter:s,ship:a}=t,n=a.rotation-Math.PI/2,i=20,o=-Math.cos(n)*i,l=-Math.sin(n)*i;s.setPosition(a.x+o,a.y+l),s.setAngle({min:Phaser.Math.RadToDeg(n)+160,max:Phaser.Math.RadToDeg(n)+200})}setThrustEmitting(e,t){const s=this.emitters.get(e);s&&(s.emitter.setVisible(t),s.emitter.emitting=t)}createExplosion(e,t,s="medium"){const a={small:{particleCount:5,speed:{min:50,max:150},scale:{start:.4,end:0},lifespan:300},medium:{particleCount:10,speed:{min:100,max:250},scale:{start:.6,end:0},lifespan:400},large:{particleCount:15,speed:{min:150,max:350},scale:{start:.8,end:0},lifespan:500}},n=a[s]||a.medium,i=this.scene.add.particles(e,t,"particle_basic",{speed:n.speed,scale:n.scale,alpha:{start:1,end:0},lifespan:n.lifespan,tint:[16711680,16737792,16750848,16763904],blendMode:"ADD",quantity:n.particleCount,emitting:!1});i.setDepth(100),i.explode();const o=this.scene.add.particles(e,t,"particle_square",{speed:{min:n.speed.min*.6,max:n.speed.max*.6},scale:{start:.8,end:.2},alpha:{start:1,end:0},lifespan:n.lifespan*1.5,tint:[6710886,8947848,11184810],rotate:{min:0,max:360},quantity:Math.floor(n.particleCount*.5),emitting:!1});o.setDepth(99),o.explode(),this.scene.time.delayedCall(n.lifespan*2,()=>{i.destroy(),o.destroy()})}createImpactSparks(e,t,s=0){const a=this.scene.add.particles(e,t,"particle_spark",{speed:{min:100,max:200},scale:{start:.6,end:0},alpha:{start:1,end:0},lifespan:300,angle:{min:s-45,max:s+45},tint:[16776960,16777215,16750848],blendMode:"ADD",quantity:8,emitting:!1});a.setDepth(101),a.explode(),this.scene.time.delayedCall(600,()=>a.destroy())}createMiningEffect(e,t,s,a){const n=Phaser.Math.Angle.Between(e,t,s,a),i=this.scene.add.particles(e,t,"particle_basic",{speed:150,scale:{start:.5,end:0},alpha:{start:.8,end:0},lifespan:800,angle:{min:Phaser.Math.RadToDeg(n)-15,max:Phaser.Math.RadToDeg(n)+15},tint:[65280,65484,16776960],blendMode:"ADD",frequency:200,quantity:1});i.setDepth(10),this.scene.time.delayedCall(1e3,()=>i.destroy())}createProjectileTrail(e){const t=this.scene.add.particles(0,0,"particle_basic",{speed:10,scale:{start:.2,end:0},alpha:{start:.4,end:0},lifespan:150,frequency:40,tint:[52479],blendMode:"ADD",follow:e,emitting:!0});t.setDepth(e.depth-1);const s=`trail_${Date.now()}_${Math.random()}`;return this.emitters.set(s,{emitter:t,projectile:e}),s}removeEmitter(e){const t=this.emitters.get(e);t&&(t.emitter.destroy(),this.emitters.delete(e))}cleanup(){this.emitters.forEach(e=>e.emitter.destroy()),this.emitters.clear()}}class v{constructor(e){this.scene=e,this.floatingTexts=[]}animateCounter(e,t,s,a=500,n=null){const i={value:t};this.scene.tweens.add({targets:i,value:s,duration:a,ease:"Cubic.easeOut",onUpdate:()=>{const o=n?n(i.value):i.value.toFixed(2);e.setText(o)}})}animateBar(e,t,s,a=300,n="Cubic.easeOut"){e.originalWidth||(e.originalWidth=e.width),this.scene.tweens.add({targets:e,scaleX:s,duration:a,ease:n})}createFloatingText(e,t,s,a={}){const{color:n="#ffffff",fontSize:i="24px",duration:o=1500,distance:l=80,fadeDelay:r=500}=a,h=this.scene.add.text(e,t,s,{fontFamily:"Arial",fontSize:i,color:n,stroke:"#000000",strokeThickness:4,fontStyle:"bold"}).setOrigin(.5).setDepth(1e3);return this.floatingTexts.push(h),this.scene.tweens.add({targets:h,y:t-l,duration:o,ease:"Cubic.easeOut"}),this.scene.tweens.add({targets:h,alpha:0,duration:o-r,delay:r,onComplete:()=>{h.destroy();const c=this.floatingTexts.indexOf(h);c>-1&&this.floatingTexts.splice(c,1)}}),h}showCryptoGain(e,t,s){const a=`+${s.toFixed(2)} â¬¡`;return this.createFloatingText(e,t,a,{color:"#00ff00",fontSize:"20px",duration:1200,distance:60})}showDamage(e,t,s){const a=`-${Math.round(s)}`;return this.createFloatingText(e,t,a,{color:"#ff0000",fontSize:"28px",duration:1e3,distance:50})}pulse(e,t=1.1,s=300,a=0){return this.scene.tweens.killTweensOf(e),this.scene.tweens.add({targets:e,scale:t,duration:s/2,yoyo:!0,repeat:a,ease:"Sine.easeInOut"})}shakeText(e,t=5,s=200){const a=e.x,n=e.y,i=this.scene.time.addEvent({delay:16,repeat:s/16,callback:()=>{e.x=a+Phaser.Math.Between(-t,t),e.y=n+Phaser.Math.Between(-t,t)},callbackScope:this});this.scene.time.delayedCall(s,()=>{i.remove(),e.x=a,e.y=n})}showAchievement(e,t,s=3e3){const a=this.scene.cameras.main.width/2,n=-150,i=100,o=this.scene.add.container(a,n);o.setDepth(2e3),o.setScrollFactor(0);const l=this.scene.add.rectangle(0,0,400,100,6680,.95);l.setStrokeStyle(2,65484);const r=this.scene.add.text(0,-20,e,{fontFamily:"Arial",fontSize:"24px",color:"#00ffcc",fontStyle:"bold"}).setOrigin(.5),h=this.scene.add.text(0,15,t,{fontFamily:"Arial",fontSize:"16px",color:"#aef7ee"}).setOrigin(.5);return o.add([l,r,h]),this.scene.tweens.add({targets:o,y:i,duration:500,ease:"Back.easeOut"}),this.scene.time.delayedCall(s,()=>{this.scene.tweens.add({targets:o,y:n,alpha:0,duration:400,ease:"Back.easeIn",onComplete:()=>o.destroy()})}),o}glowPulse(e,t="#ff0000"){this.scene.tweens.killTweensOf(e);const s={glowAlpha:0};return this.scene.tweens.add({targets:s,glowAlpha:1,duration:600,yoyo:!0,repeat:-1,ease:"Sine.easeInOut",onUpdate:()=>{e.setShadow(0,0,t,10*s.glowAlpha,!1,!0)}})}removeGlow(e){this.scene.tweens.killTweensOf(e),e.setShadow(0,0,"transparent",0)}cleanup(){this.floatingTexts.forEach(e=>{e&&e.active&&e.destroy()}),this.floatingTexts=[]}}class k{constructor(e){this.scene=e,this.trails=new Map,this.graphics=this.scene.add.graphics(),this.graphics.setDepth(5)}createLineTrail(e,t=8,s=52479,a=.6,n=2){this.trails.set(e,{type:"line",points:[],maxPoints:t,color:s,alpha:a,width:n})}updateLineTrail(e,t,s){const a=this.trails.get(e);!a||a.type!=="line"||(a.points.push({x:t,y:s}),a.points.length>a.maxPoints&&a.points.shift())}renderLineTrails(){this.graphics.clear(),this.trails.forEach((e,t)=>{if(!(e.type!=="line"||e.points.length<2))for(let s=0;s<e.points.length-1;s++){const a=e.points[s],n=e.points[s+1],i=s/e.points.length,o=e.alpha*i;this.graphics.lineStyle(e.width,e.color,o),this.graphics.lineBetween(a.x,a.y,n.x,n.y)}})}createSpriteTrail(e,t={}){const{frequency:s=50,lifespan:a=300,alphaStart:n=.6,alphaEnd:i=0,tint:o=null,scaleStart:l=1,scaleEnd:r=.8}=t,h=this.scene.time.addEvent({delay:s,callback:()=>{const d=this.scene.add.sprite(e.x,e.y,e.texture.key,e.frame.name);d.setRotation(e.rotation),d.setScale(e.scaleX*l,e.scaleY*l),d.setAlpha(n),d.setDepth(e.depth-1),o!==null&&d.setTint(o),this.scene.tweens.add({targets:d,alpha:i,scaleX:e.scaleX*r,scaleY:e.scaleY*r,duration:a,ease:"Linear",onComplete:()=>d.destroy()})},loop:!0}),c=`sprite_trail_${Date.now()}_${Math.random()}`;return this.trails.set(c,{type:"sprite",timer:h,sprite:e}),c}removeSpriteTrail(e){const t=this.trails.get(e);!t||t.type!=="sprite"||(t.timer.remove(),this.trails.delete(e))}createMotionBlur(e,t=3){const s=`blur_${Date.now()}_${Math.random()}`,a=[],n=t,i=()=>{a.push({x:e.x,y:e.y,rotation:e.rotation}),a.length>n&&a.shift(),a.forEach((o,l)=>{const r=l/n*.3,h=this.scene.add.sprite(o.x,o.y,e.texture.key,e.frame.name);h.setRotation(o.rotation),h.setAlpha(r),h.setDepth(e.depth-1),this.scene.time.delayedCall(50,()=>h.destroy())})};return this.trails.set(s,{type:"blur",updateCallback:i}),s}removeLineTrail(e){this.trails.delete(e)}removeTrail(e){const t=this.trails.get(e);t&&(t.type==="sprite"&&t.timer&&t.timer.remove(),this.trails.delete(e))}cleanup(){this.trails.forEach((e,t)=>{e.type==="sprite"&&e.timer&&e.timer.remove()}),this.trails.clear(),this.graphics.clear()}}class P{constructor(e){this.scene=e,this.reset()}reset(){this.playerName="Pilot",this.shipMaxHealth=100,this.shipHealth=100,this.shipMaxFuel=100,this.shipFuel=100,this.shipMaxOxygen=100,this.shipOxygen=100,this.shipCargoCapacity=50,this.currentCargo=0,this.cryptoBalance=0,this.enemiesKilled=0,this.meteorsDestroyed=0,this.score=0,this.level=1,this.isGameOver=!1,this.isPaused=!1,this.gameStartTime=Date.now(),this.shipMaxSpeed=500,this.shipAcceleration=800,this.fuelConsumptionRate=20,this.fuelRechargeRate=10,this.oxygenConsumptionRate=1,this.shipMetadata=null}getPlayerStats(){return{name:this.playerName,health:this.shipHealth,maxHealth:this.shipMaxHealth,fuel:this.shipFuel,maxFuel:this.shipMaxFuel,oxygen:this.shipOxygen,maxOxygen:this.shipMaxOxygen,cargo:this.currentCargo,maxCargo:this.shipCargoCapacity,crypto:this.cryptoBalance}}getGameStats(){return{score:this.score,level:this.level,enemiesKilled:this.enemiesKilled,meteorsDestroyed:this.meteorsDestroyed,playTime:Date.now()-this.gameStartTime}}setPlayerName(e){this.playerName=e}setShipCharacteristics(e){Object.assign(this,e),this.shipFuel=this.shipMaxFuel,this.shipOxygen=this.shipMaxOxygen,this.shipHealth=this.shipMaxHealth,this.currentCargo=0}takeDamage(e){return this.isGameOver?!1:(this.shipHealth=Math.max(0,this.shipHealth-e),this.shipHealth<=0?(this.triggerGameOver("Vida esgotada!"),!0):!1)}heal(e){this.shipHealth=Math.min(this.shipMaxHealth,this.shipHealth+e)}consumeFuel(e){return this.shipFuel=Math.max(0,this.shipFuel-e),this.shipFuel>0}rechargeFuel(e){this.shipFuel=Math.min(this.shipMaxFuel,this.shipFuel+e)}consumeOxygen(e){return this.shipOxygen=Math.max(0,this.shipOxygen-e),this.shipOxygen<=0?(this.triggerGameOver("OxigÃªnio esgotado!"),!1):!0}addCargo(e){const t=this.currentCargo+e<=this.shipCargoCapacity;return t&&(this.currentCargo+=e),t}removeCargo(e){this.currentCargo=Math.max(0,this.currentCargo-e)}addCrypto(e){this.cryptoBalance+=e,this.score+=Math.floor(e*10)}incrementEnemiesKilled(){this.enemiesKilled++,this.score+=100}incrementMeteorsDestroyed(){this.meteorsDestroyed++,this.score+=50}triggerGameOver(e=""){this.isGameOver||(this.isGameOver=!0,this.scene.events.emit("gameover",{reason:e,stats:this.getGameStats(),playerStats:this.getPlayerStats()}))}pause(){this.isPaused=!0,this.scene.events.emit("pause")}resume(){this.isPaused=!1,this.scene.events.emit("resume")}saveToLocalStorage(){const e={playerName:this.playerName,cryptoBalance:this.cryptoBalance,score:this.score,level:this.level,shipMetadata:this.shipMetadata,timestamp:Date.now()};localStorage.setItem("spaceCryptoMiner_save",JSON.stringify(e))}loadFromLocalStorage(){try{const e=localStorage.getItem("spaceCryptoMiner_save");if(e){const t=JSON.parse(e);return this.playerName=t.playerName||this.playerName,this.cryptoBalance=t.cryptoBalance||0,this.score=t.score||0,this.level=t.level||1,this.shipMetadata=t.shipMetadata||null,!0}}catch(e){console.error("Erro ao carregar save:",e)}return!1}validateState(){const e=[];return(this.shipHealth<0||this.shipHealth>this.shipMaxHealth)&&e.push("Health out of bounds"),(this.shipFuel<0||this.shipFuel>this.shipMaxFuel)&&e.push("Fuel out of bounds"),(this.shipOxygen<0||this.shipOxygen>this.shipMaxOxygen)&&e.push("Oxygen out of bounds"),(this.currentCargo<0||this.currentCargo>this.shipCargoCapacity)&&e.push("Cargo out of bounds"),e}}class F{constructor(e,t){this.scene=e,this.gameState=t,this.ship=null,this.isThrusting=!1,this.thrustEmitterId=null,this.playerNameText=null}async create(){try{return console.log("ðŸ” ShipManager: Iniciando criaÃ§Ã£o da nave..."),console.log("ðŸ” ShipManager: Criando sprite da nave..."),this.ship=this.scene.physics.add.sprite(400,300,"ship_idle"),console.log("âœ… ShipManager: Sprite criado:",this.ship),this.ship?(console.log("ðŸ” ShipManager: Iniciando animaÃ§Ã£o..."),this.ship.play("ship_idle"),console.log("âœ… ShipManager: AnimaÃ§Ã£o iniciada"),console.log("ðŸ” ShipManager: Configurando fÃ­sica..."),this.setupPhysics(),console.log("âœ… ShipManager: FÃ­sica configurada"),console.log("ðŸ” ShipManager: Configurando efeitos visuais..."),this.setupVisualEffects(),console.log("âœ… ShipManager: Efeitos visuais configurados"),console.log("ðŸ” ShipManager: Criando texto do jogador..."),this.createPlayerNameText(),console.log("âœ… ShipManager: Texto do jogador criado"),console.log("ðŸ” ShipManager: Aplicando caracterÃ­sticas da nave..."),await this.applyShipCharacteristics(),console.log("âœ… ShipManager: CaracterÃ­sticas aplicadas"),console.log("ðŸŽ‰ ShipManager: Nave criada com sucesso!"),this.ship):(console.error("âŒ ShipManager: Falha ao criar sprite da nave"),null)}catch(e){return console.error("âŒ ShipManager: Erro na criaÃ§Ã£o da nave:",e),console.error("âŒ Stack trace:",e.stack),null}}setupPhysics(){try{this.ship.body.setCircle(Math.max(this.ship.width,this.ship.height)/2*.6),this.ship.body.setOffset(this.ship.width*.5-Math.max(this.ship.width,this.ship.height)/2*.6,this.ship.height*.5-Math.max(this.ship.width,this.ship.height)/2*.6),this.ship.setMaxVelocity(this.gameState.shipMaxSpeed),this.ship.setCollideWorldBounds(!1)}catch(e){console.error("âŒ ShipManager: Erro na configuraÃ§Ã£o da fÃ­sica:",e)}}setupVisualEffects(){this.scene.particleEffects?this.thrustEmitterId=this.scene.particleEffects.createThrustEffect(this.ship):console.log("âš ï¸ ShipManager: ParticleEffects nÃ£o disponÃ­vel ainda")}createPlayerNameText(){if(!this.ship){console.warn("âš ï¸ ShipManager: Tentando criar texto do jogador sem nave");return}this.playerNameText=this.scene.add.text(this.ship.x,this.ship.y+40,this.gameState.playerName,{fontFamily:"Arial",fontSize:"16px",color:"#ffffff",align:"center"}).setOrigin(.5).setDepth(5)}async applyShipCharacteristics(){this.loadDefaultCharacteristics(),this.scene.connectedWallet&&await this.loadNFTCharacteristics()}loadDefaultCharacteristics(){try{const e={Comum:{speed:100,cargo:50,fuel:100,oxygen:100,shield:100,acceleration:200,fuelConsumption:20,fuelRecharge:10,color:"#CCCCCC",description:"Nave bÃ¡sica com caracterÃ­sticas equilibradas"},Incomum:{speed:200,cargo:100,fuel:150,oxygen:150,shield:200,acceleration:300,fuelConsumption:18,fuelRecharge:12,color:"#00FF00",description:"Nave melhorada com vantagens moderadas"},Raro:{speed:300,cargo:150,fuel:200,oxygen:200,shield:300,acceleration:400,fuelConsumption:16,fuelRecharge:14,color:"#0080FF",description:"Nave avanÃ§ada com caracterÃ­sticas superiores"},Ã‰pico:{speed:400,cargo:175,fuel:250,oxygen:250,shield:400,acceleration:500,fuelConsumption:14,fuelRecharge:16,color:"#8000FF",description:"Nave Ã©pica com capacidades excepcionais"},LendÃ¡rio:{speed:500,cargo:200,fuel:300,oxygen:300,shield:500,acceleration:600,fuelConsumption:12,fuelRecharge:18,color:"#FF8000",description:"Nave lendÃ¡ria com caracterÃ­sticas mÃ¡ximas"}},t="Comum",s=e[t];console.log(`ðŸš€ Carregando nave de raridade: ${t}`),console.log("ðŸ“Š CaracterÃ­sticas:",s),this.gameState.setShipCharacteristics({shipMaxSpeed:s.speed,shipCargoCapacity:s.cargo,shipMaxFuel:s.fuel,shipMaxOxygen:s.oxygen,shipMaxHealth:s.shield,shipAcceleration:s.acceleration,fuelConsumptionRate:s.fuelConsumption,fuelRechargeRate:s.fuelRecharge,oxygenConsumptionRate:1}),this.gameState.shipMetadata={name:`Space Miner ${t}`,rarity:t,rarityColor:s.color,rarityDescription:s.description,attributes:[{trait_type:"Raridade",value:t},{trait_type:"Velocidade",value:s.speed},{trait_type:"Carga",value:s.cargo},{trait_type:"CombustÃ­vel",value:s.fuel},{trait_type:"OxigÃªnio",value:s.oxygen},{trait_type:"Escudo",value:s.shield}]},console.log("âœ… CaracterÃ­sticas de raridade aplicadas:",t)}catch(e){console.error("âŒ Erro ao carregar caracterÃ­sticas de raridade:",e)}}async loadNFTCharacteristics(){try{const{findFirstNftImageForOwner:e,findFirstNftMetadataForOwner:t}=await _(()=>import("./solana_nft-e45b1466.js"),["assets/solana_nft-e45b1466.js","assets/main-261ff586.js","assets/phaser-23102255.js","assets/index-7c2f8fd6.css","assets/solana-26dfd0f2.js"]),[s,a]=await Promise.all([e(this.scene.connectedWallet,{network:"devnet"}),t(this.scene.connectedWallet,{network:"devnet"})]);s&&a&&(console.log("Found NFT for wallet",this.scene.connectedWallet),this.applyNFTCharacteristics(a),await this.loadNFTSprite(s))}catch(e){console.error("Erro ao carregar NFT:",e)}}applyNFTCharacteristics(e){if(!e||!e.attributes)return;const t=e.attributes,s={shipMaxSpeed:this.getAttributeValue(t,"Velocidade")||this.gameState.shipMaxSpeed,shipCargoCapacity:this.getAttributeValue(t,"Carga")||this.gameState.shipCargoCapacity,shipMaxFuel:this.getAttributeValue(t,"CombustÃ­vel")||this.gameState.shipMaxFuel,shipMaxOxygen:this.getAttributeValue(t,"OxigÃªnio")||this.gameState.shipMaxOxygen,shipMaxHealth:this.getAttributeValue(t,"Escudo")||this.gameState.shipMaxHealth};if(this.gameState.setShipCharacteristics(s),this.gameState.shipMetadata=e,e.name&&this.playerNameText){this.playerNameText.setText(e.name);const a=this.getAttributeValue(t,"Raridade")||"Comum";this.playerNameText.setColor(this.getRarityColor(a))}console.log("âœ… CaracterÃ­sticas NFT aplicadas:",s)}async loadNFTSprite(e){return new Promise(t=>{this.scene.load.image("nft_ship",e),this.scene.load.once("complete",()=>{try{const s=this.scene.textures.get("nft_ship");if(s&&s.source&&s.source[0]){this.ship.setTexture("nft_ship");const a=.6,n=this.ship.displayWidth,i=this.ship.displayHeight;Math.max(n,i)>256&&this.ship.setScale(a)}}catch(s){console.warn("Failed to apply NFT texture",s)}t()}),this.scene.load.start()})}getAttributeValue(e,t){if(!e||!Array.isArray(e))return null;const s=e.find(a=>a.trait_type===t||a.trait_type===t.toLowerCase());return s?s.value:null}getRarityColor(e){return{Comum:"#CCCCCC",Incomum:"#00FF00",Raro:"#0080FF",Ã‰pico:"#A020F0",LendÃ¡rio:"#FFD700"}[e]||"#FFFFFF"}setRarityForTesting(e){console.log(`ðŸ”„ Alterando raridade para: ${e}`);const s={Comum:{speed:100,cargo:50,fuel:100,oxygen:100,shield:100,acceleration:200},Incomum:{speed:200,cargo:100,fuel:150,oxygen:150,shield:200,acceleration:300},Raro:{speed:300,cargo:150,fuel:200,oxygen:200,shield:300,acceleration:400},Ã‰pico:{speed:400,cargo:175,fuel:250,oxygen:250,shield:400,acceleration:500},LendÃ¡rio:{speed:500,cargo:200,fuel:300,oxygen:300,shield:500,acceleration:600}}[e];s&&(this.gameState.setShipCharacteristics({shipMaxSpeed:s.speed,shipCargoCapacity:s.cargo,shipMaxFuel:s.fuel,shipMaxOxygen:s.oxygen,shipMaxHealth:s.shield,shipAcceleration:s.acceleration}),console.log(`âœ… Raridade alterada para: ${e}`))}updateMovement(e,t){if(!this.ship||this.gameState.isGameOver){console.log("âš ï¸ ShipManager: Nave nÃ£o existe ou jogo acabou");return}e.thrust&&(console.log("ðŸŽ® PropulsÃ£o detectada:",{thrust:e.thrust,mouseX:this.scene.input.activePointer.x,mouseY:this.scene.input.activePointer.y}),console.log("ðŸ” Nave posiÃ§Ã£o atual:",{x:this.ship.x,y:this.ship.y}));const s=this.scene.input.activePointer.positionToCamera(this.scene.cameras.main);this.ship.rotation=Phaser.Math.Angle.Between(this.ship.x,this.ship.y,s.x,s.y)+Math.PI/2,e.thrust&&this.gameState.shipFuel>0?this.startThrust(t):(this.stopThrust(),this.rechargeFuel(t)),this.limitVelocity()}startThrust(e){this.isThrusting||(this.ship.play("ship_thrust",!0),this.isThrusting=!0,this.thrustEmitterId&&this.scene.particleEffects&&this.scene.particleEffects.setThrustEmitting(this.thrustEmitterId,!0),this.scene.rocketSound&&!this.scene.isRocketPlaying&&(this.scene.rocketSound.play(),this.scene.isRocketPlaying=!0));const t=this.ship.rotation-Math.PI/2,s=this.gameState.shipAcceleration||200,a=Math.cos(t)*s,n=Math.sin(t)*s;console.log("ðŸš€ Aplicando propulsÃ£o:",{angle:t,acceleration:s,vx:a,vy:n,rotation:this.ship.rotation}),this.ship.setAcceleration(a,n);const i=e/1e3,o=this.gameState.fuelConsumptionRate*i;this.gameState.consumeFuel(o)||(this.ship.setAcceleration(0),this.ship.play("ship_idle",!0),this.isThrusting=!1,this.scene.isRocketPlaying&&(this.scene.rocketSound.stop(),this.scene.isRocketPlaying=!1))}stopThrust(){this.isThrusting&&(this.ship.play("ship_idle",!0),this.isThrusting=!1,this.thrustEmitterId&&this.scene.particleEffects&&this.scene.particleEffects.setThrustEmitting(this.thrustEmitterId,!1),this.scene.isRocketPlaying&&(this.scene.rocketSound.stop(),this.scene.isRocketPlaying=!1)),this.ship.setAcceleration(0)}rechargeFuel(e){const t=e/1e3,s=this.gameState.fuelRechargeRate*t;this.gameState.rechargeFuel(s)}limitVelocity(){const e=this.ship.body.velocity,t=Math.sqrt(e.x*e.x+e.y*e.y);if(t>this.gameState.shipMaxSpeed){const s=this.gameState.shipMaxSpeed/t;this.ship.setVelocity(e.x*s,e.y*s)}}update(){this.ship&&(this.playerNameText&&(this.playerNameText.x=this.ship.x,this.playerNameText.y=this.ship.y+40),this.isThrusting&&this.thrustEmitterId&&this.scene.particleEffects&&this.scene.particleEffects.updateThrustEffect(this.thrustEmitterId))}destroy(){this.thrustEmitterId&&this.scene.particleEffects&&this.scene.particleEffects.removeEmitter(this.thrustEmitterId),this.playerNameText&&this.playerNameText.destroy(),this.ship&&this.ship.destroy()}}class T{constructor(e){this.scene=e,this.collisionGroups=new Map,this.collisionHandlers=new Map,this.setupCollisionGroups()}setupCollisionGroups(){this.collisionGroups.set("projectiles",this.scene.physics.add.group()),this.collisionGroups.set("rockets",this.scene.physics.add.group()),this.collisionGroups.set("enemies",this.scene.physics.add.group()),this.collisionGroups.set("meteors",this.scene.physics.add.group()),this.collisionGroups.set("miningPlanets",this.scene.physics.add.group())}setupAllCollisions(e){this.setupCollision("projectiles","enemies",this.handleProjectileEnemyCollision.bind(this)),this.setupCollision("projectiles","meteors",this.handleProjectileMeteorCollision.bind(this)),this.setupCollision("rockets","enemies",this.handleRocketEnemyCollision.bind(this)),this.setupCollision("rockets","meteors",this.handleRocketMeteorCollision.bind(this)),this.setupCollision(e,"meteors",this.handleShipMeteorCollision.bind(this)),this.setupCollision(e,"enemies",this.handleShipEnemyCollision.bind(this)),this.setupCollision(e,"miningPlanets",this.handleShipMiningPlanetCollision.bind(this))}setupCollision(e,t,s){const a=`${e}_${t}`;this.collisionHandlers.set(a,s),typeof e=="string"&&(e=this.collisionGroups.get(e)),typeof t=="string"&&(t=this.collisionGroups.get(t)),this.scene.physics.add.overlap(e,t,s,null,this.scene)}handleProjectileEnemyCollision(e,t){this.createImpactEffects(e,t),t.health-=35,this.updateEnemyHealthBar(t),e.destroy(),t.health<=0&&this.destroyEnemy(t)}handleProjectileMeteorCollision(e,t){this.createImpactEffects(e,t),t.health-=15,e.destroy(),t.health<=0?this.destroyMeteor(t):this.scene.audioManager&&this.scene.audioManager.playImpact(.4)}handleRocketEnemyCollision(e,t){const s=e.damage||100;console.log(`ðŸš€ Foguete atingiu inimigo! Dano: ${s}`),this.createImpactEffects(e,t),this.createExplosion(e.x,e.y),this.scene.particleEffects&&this.scene.particleEffects.createExplosion(e.x,e.y,"large"),t.health-=s,e.destroy(),t.health<=0?this.destroyEnemy(t):this.scene.audioManager&&this.scene.audioManager.playExplosion("large")}handleRocketMeteorCollision(e,t){const s=e.damage||100;console.log(`ðŸš€ Foguete atingiu meteoro! Dano: ${s}`),this.createImpactEffects(e,t),this.createExplosion(e.x,e.y),this.scene.particleEffects&&this.scene.particleEffects.createExplosion(e.x,e.y,"medium"),t.health-=s,e.destroy(),t.health<=0?this.destroyMeteor(t):this.scene.audioManager&&this.scene.audioManager.playExplosion("medium")}handleShipMeteorCollision(e,t){if(this.scene.gameState.isGameOver)return;const s=10;this.createShipDamageEffects(e,s),!this.scene.gameState.takeDamage(s)&&this.destroyMeteor(t)}handleShipEnemyCollision(e,t){if(this.scene.gameState.isGameOver)return;const s=25;this.createShipDamageEffects(e,s),!this.scene.gameState.takeDamage(s)&&this.destroyEnemy(t)}handleShipMiningPlanetCollision(e,t){this.scene.events.emit("mining_planet_contact",{ship:e,planet:t})}createImpactEffects(e,t){const s=Phaser.Math.Angle.Between(e.x,e.y,t.x,t.y);this.scene.particleEffects&&this.scene.particleEffects.createImpactSparks(e.x,e.y,Phaser.Math.RadToDeg(s)+180),this.scene.juiceManager&&this.scene.juiceManager.damageFlash(t,100),this.scene.juiceManager&&this.scene.juiceManager.screenShake(80,3),this.scene.audioManager&&this.scene.audioManager.playImpact(.6),this.scene.uiAnimations&&this.scene.uiAnimations.createFloatingText(t.x+Phaser.Math.Between(-20,20),t.y-20,"-35",{color:"#ff4444",fontSize:"18px",duration:1e3,distance:40,fadeDelay:300})}createShipDamageEffects(e,t){this.scene.juiceManager&&(this.scene.juiceManager.damageFlash(e,150),this.scene.juiceManager.screenShake(200,8),this.scene.juiceManager.flash(150,16711680,.4)),this.scene.uiAnimations&&this.scene.uiAnimations.showDamage(e.x,e.y-30,t),this.createExplosion(e.x,e.y),this.scene.particleEffects&&this.scene.particleEffects.createExplosion(e.x,e.y,"medium"),this.scene.audioManager&&this.scene.audioManager.playExplosion("large")}createExplosion(e,t){const s=this.scene.add.sprite(e,t,"explosion");s.setDepth(100),s.play("explosion_anim"),s.once("animationcomplete",()=>{s.destroy()})}destroyEnemy(e){this.scene.juiceManager&&this.scene.juiceManager.impactEffect("large"),this.scene.uiAnimations&&this.scene.uiAnimations.createFloatingText(e.x,e.y-30,"DESTROYED!",{color:"#00ff00",fontSize:"24px",duration:1500,distance:60,fadeDelay:500}),this.createExplosion(e.x,e.y),this.scene.particleEffects&&this.scene.particleEffects.createExplosion(e.x,e.y,"medium"),this.scene.audioManager&&this.scene.audioManager.playExplosion("medium"),e._movementTimer&&e._movementTimer.remove(!1),e.healthBar&&e.healthBar.destroy(),e.healthBarBg&&e.healthBarBg.destroy(),this.collisionGroups.get("enemies").remove(e),e.destroy(),this.scene.gameState&&this.scene.gameState.incrementEnemiesKilled()}destroyMeteor(e){this.createExplosion(e.x,e.y),this.scene.particleEffects&&this.scene.particleEffects.createExplosion(e.x,e.y,"small"),this.scene.audioManager&&this.scene.audioManager.playExplosion("small"),this.scene.juiceManager&&this.scene.juiceManager.impactEffect("small"),e.trailId&&this.scene.trailEffects&&this.scene.trailEffects.removeTrail(e.trailId),this.collisionGroups.get("meteors").remove(e),e.destroy(),this.scene.gameState&&this.scene.gameState.incrementMeteorsDestroyed()}updateEnemyHealthBar(e){if(!e.healthBar||!e.maxHealth)return;const t=Math.max(0,e.health/e.maxHealth);this.scene.uiAnimations&&this.scene.uiAnimations.animateBar(e.healthBar,e.healthBar.scaleX,t,200),t<.3?e.healthBar.setFillStyle(16711680):t<.6&&e.healthBar.setFillStyle(16737792)}addToGroup(e,t){const s=this.collisionGroups.get(e);s&&s.add(t)}removeFromGroup(e,t){const s=this.collisionGroups.get(e);s&&s.remove(t)}getGroup(e){return this.collisionGroups.get(e)}destroy(){this.collisionGroups.clear(),this.collisionHandlers.clear()}}class b{constructor(e,t){this.scene=e,this.gameState=t,this.uiElements=new Map,this.createUI()}createUI(){this.titleStyle={fontSize:"13px",fill:"#00d4ff",fontFamily:"Arial, sans-serif",fontStyle:"bold"},this.valueStyle={fontSize:"20px",fill:"#ffffff",fontFamily:"Arial, sans-serif",fontStyle:"bold"},this.createUIPanel(),this.createCryptoDisplay(),this.createHealthBar(),this.createFuelBar(),this.createOxygenBar(),this.createCargoDisplay(),this.createSpeedDisplay(),this.createRarityDisplay(),this.createCoordinatesDisplay()}createUIPanel(){this.uiElements.set("panel",this.scene.add.rectangle(16,16,320,320,657935,.85).setOrigin(0,0).setScrollFactor(0).setDepth(18)),this.uiElements.set("panelBorder",this.scene.add.rectangle(16,16,320,320,54527,0).setOrigin(0,0).setScrollFactor(0).setDepth(18).setStrokeStyle(2,54527,.8)),this.uiElements.set("panelInnerBorder",this.scene.add.rectangle(16+3,16+3,320-6,320-6,54527,0).setOrigin(0,0).setScrollFactor(0).setDepth(18).setStrokeStyle(1,54527,.3))}createCryptoDisplay(){let n=34;this.scene.add.text(34,n,"ðŸ’° CRYPTO",this.titleStyle).setScrollFactor(0).setDepth(20),n+=20,this.uiElements.set("cryptoText",this.scene.add.text(34,n,"0.00",{...this.valueStyle,fill:"#00ff88",fontSize:"22px"}).setScrollFactor(0).setDepth(20)),this.currentY=n+32}createHealthBar(){let n=this.currentY;this.scene.add.text(34,n,"â¤ï¸ HEALTH",this.titleStyle).setScrollFactor(0).setDepth(20),n+=20;const i=20;this.uiElements.set("healthBarBg",this.scene.add.rectangle(34,n,284,i,2228224,.9).setOrigin(0,0).setScrollFactor(0).setDepth(19).setStrokeStyle(1,6684672,.6)),this.uiElements.set("healthBar",this.scene.add.rectangle(34+1,n+1,284-2,i-2,16711680,1).setOrigin(0,0).setScrollFactor(0).setDepth(20)),this.uiElements.set("healthText",this.scene.add.text(34+284/2,n+i/2,"100/100",{fontSize:"13px",fill:"#ffffff",fontFamily:"Arial, sans-serif",fontStyle:"bold"}).setOrigin(.5,.5).setScrollFactor(0).setDepth(21)),this.currentY=n+i+16}createFuelBar(){let n=this.currentY;this.scene.add.text(34,n,"âš¡ FUEL",this.titleStyle).setScrollFactor(0).setDepth(20),n+=20;const i=18;this.uiElements.set("fuelBarBg",this.scene.add.rectangle(34,n,284,i,6690,.9).setOrigin(0,0).setScrollFactor(0).setDepth(19).setStrokeStyle(1,17510,.6)),this.uiElements.set("fuelBar",this.scene.add.rectangle(34+1,n+1,284-2,i-2,43775,1).setOrigin(0,0).setScrollFactor(0).setDepth(20)),this.uiElements.set("fuelText",this.scene.add.text(34+284/2,n+i/2,"100/100",{fontSize:"12px",fill:"#ffffff",fontFamily:"Arial, sans-serif",fontStyle:"bold"}).setOrigin(.5,.5).setScrollFactor(0).setDepth(21)),this.currentY=n+i+16}createOxygenBar(){let n=this.currentY;this.scene.add.text(34,n,"ðŸ« OXYGEN",this.titleStyle).setScrollFactor(0).setDepth(20),n+=20;const i=18;this.uiElements.set("oxygenBarBg",this.scene.add.rectangle(34,n,284,i,4386,.9).setOrigin(0,0).setScrollFactor(0).setDepth(19).setStrokeStyle(1,17510,.6)),this.uiElements.set("oxygenBar",this.scene.add.rectangle(34+1,n+1,284-2,i-2,52479,1).setOrigin(0,0).setScrollFactor(0).setDepth(20)),this.uiElements.set("oxygenText",this.scene.add.text(34+284/2,n+i/2,"100/100",{fontSize:"12px",fill:"#ffffff",fontFamily:"Arial, sans-serif",fontStyle:"bold"}).setOrigin(.5,.5).setScrollFactor(0).setDepth(21)),this.currentY=n+i+16}createCargoDisplay(){let a=this.currentY;this.scene.add.text(34,a,"ðŸ“¦ CARGO",this.titleStyle).setScrollFactor(0).setDepth(20),a+=20,this.uiElements.set("cargoText",this.scene.add.text(34,a,"0/50 kg",{fontSize:"16px",fill:"#ffaa00",fontFamily:"Arial, sans-serif",fontStyle:"bold"}).setScrollFactor(0).setDepth(20)),this.currentY=a+25}createSpeedDisplay(){let a=this.currentY;this.uiElements.set("speedText",this.scene.add.text(34,a,"ðŸš€ SPEED: 0 km/h",{fontSize:"13px",fill:"#55aaff",fontFamily:"Arial, sans-serif",fontStyle:"bold"}).setScrollFactor(0).setDepth(20)),this.currentY=a+20}createRarityDisplay(){let a=this.currentY;this.uiElements.set("rarityText",this.scene.add.text(34,a,"",{fontSize:"12px",fill:"#cccccc",fontFamily:"Arial, sans-serif",fontStyle:"bold"}).setScrollFactor(0).setDepth(20))}createCoordinatesDisplay(){const e=this.scene.game.config.width,t=280,s=140,a=e-t-16,n=16;this.uiElements.set("coordsPanel",this.scene.add.rectangle(a,n,t,s,657935,.85).setOrigin(0,0).setScrollFactor(0).setDepth(18)),this.uiElements.set("coordsPanelBorder",this.scene.add.rectangle(a,n,t,s,54527,0).setOrigin(0,0).setScrollFactor(0).setDepth(18).setStrokeStyle(2,54527,.8));const i=a+18;let o=n+18;this.scene.add.text(i,o,"ðŸ“ POSIÃ‡ÃƒO",{fontSize:"13px",fill:"#00d4ff",fontFamily:"Arial, sans-serif",fontStyle:"bold"}).setScrollFactor(0).setDepth(20),o+=25,this.uiElements.set("coordsText",this.scene.add.text(i,o,"X: 0 | Y: 0",{fontSize:"16px",fill:"#ffffff",fontFamily:"Courier New, monospace",fontStyle:"bold"}).setScrollFactor(0).setDepth(20)),o+=25,this.uiElements.set("chunkText",this.scene.add.text(i,o,"Chunk: (0, 0)",{fontSize:"14px",fill:"#00ff88",fontFamily:"Arial, sans-serif",fontStyle:"bold"}).setScrollFactor(0).setDepth(20)),o+=25,this.uiElements.set("zoneText",this.scene.add.text(i,o,"Zona: Safe",{fontSize:"14px",fill:"#00ff88",fontFamily:"Arial, sans-serif",fontStyle:"bold"}).setScrollFactor(0).setDepth(20)),o+=25,this.uiElements.set("playersText",this.scene.add.text(i,o,"Players: 0",{fontSize:"12px",fill:"#ffaa00",fontFamily:"Arial, sans-serif",fontStyle:"bold"}).setScrollFactor(0).setDepth(20))}update(){this.updateHealthBar(),this.updateFuelBar(),this.updateOxygenBar(),this.updateCargoDisplay(),this.updateSpeedDisplay(),this.updateRarityDisplay(),this.updateCoordinatesDisplay()}updateHealthBar(){const e=this.uiElements.get("healthBar"),t=this.uiElements.get("healthText");if(!e||!t)return;const s=Math.max(0,this.gameState.shipHealth/this.gameState.shipMaxHealth);Math.abs(e.scaleX-s)>.01&&(this.scene.uiAnimations?this.scene.uiAnimations.animateBar(e,e.scaleX,s,250):e.setScale(s,1)),t.setText(`${Math.round(this.gameState.shipHealth)}/${this.gameState.shipMaxHealth}`),s<.3&&!t._glowing?(t._glowing=!0,this.scene.uiAnimations&&this.scene.uiAnimations.glowPulse(t,"#ff0000")):s>=.3&&t._glowing&&(t._glowing=!1,this.scene.uiAnimations&&this.scene.uiAnimations.removeGlow(t))}updateFuelBar(){const e=this.uiElements.get("fuelBar"),t=this.uiElements.get("fuelText");if(!e||!t)return;const s=Math.max(0,this.gameState.shipFuel/this.gameState.shipMaxFuel);Math.abs(e.scaleX-s)>.01&&(this.scene.uiAnimations?this.scene.uiAnimations.animateBar(e,e.scaleX,s,200,"Linear"):e.setScale(s,1)),t.setText(`${Math.round(this.gameState.shipFuel)}/${this.gameState.shipMaxFuel}`),s<.2&&!e._pulsing?(e._pulsing=!0,e.setFillStyle(16737792)):s>=.2&&e._pulsing&&(e._pulsing=!1,e.setFillStyle(43775))}updateOxygenBar(){const e=this.uiElements.get("oxygenBar"),t=this.uiElements.get("oxygenText");if(!e||!t)return;const s=Math.max(0,this.gameState.shipOxygen/this.gameState.shipMaxOxygen);Math.abs(e.scaleX-s)>.01&&(this.scene.uiAnimations?this.scene.uiAnimations.animateBar(e,e.scaleX,s,200,"Linear"):e.setScale(s,1)),t.setText(`${Math.round(this.gameState.shipOxygen)}/${this.gameState.shipMaxOxygen}`),s<.25?e.setFillStyle(16711680):s<.5?e.setFillStyle(16755200):e.setFillStyle(52479)}updateCargoDisplay(){const e=this.uiElements.get("cargoText");if(!e)return;e.setText(`${this.gameState.currentCargo}/${this.gameState.shipCargoCapacity} kg`);const t=this.gameState.currentCargo/this.gameState.shipCargoCapacity;t>=.9?e.setColor("#ff4444"):(t>=.7,e.setColor("#ffaa00"))}updateSpeedDisplay(){const e=this.uiElements.get("speedText");if(!e||!this.scene.ship)return;const t=this.scene.ship.body.velocity,s=Math.round(Math.sqrt(t.x*t.x+t.y*t.y));e.setText(`ðŸš€ SPEED: ${s}/${this.gameState.shipMaxSpeed} km/h`);const a=Math.min(1,s/this.gameState.shipMaxSpeed),n=Math.round(85+170*a),i=Math.round(170-170*a),o=255;e.setColor(`rgb(${n},${i},${o})`)}updateRarityDisplay(){const e=this.uiElements.get("rarityText");if(!e||!this.gameState.shipMetadata)return;const t=this.getAttributeValue(this.gameState.shipMetadata.attributes,"Raridade")||"Comum";e.setText(`â­ ${t.toUpperCase()}`),e.setColor(this.getRarityColor(t))}updateCoordinatesDisplay(){var m;const e=this.uiElements.get("coordsText"),t=this.uiElements.get("chunkText"),s=this.uiElements.get("zoneText"),a=this.uiElements.get("playersText");if(!e||!t||!s||!a)return;const n=(m=this.scene.shipManager)==null?void 0:m.ship;if(!n)return;const i=Math.round(n.x),o=Math.round(n.y);e.setText(`X: ${i} | Y: ${o}`);const l=Math.floor(i/1e3),r=Math.floor(o/1e3);t.setText(`Chunk: (${l}, ${r})`);const h=Math.sqrt(l*l+r*r);let c="Safe",d="#00ff88";h>=50?(c="Hostile (PvP)",d="#ff4444"):h>=20&&(c="Transition",d="#ffaa00"),s.setText(`Zona: ${c}`),s.setColor(d);const p=this.scene.multiplayerManager;let f=1;if(p&&p.otherPlayers){const x=`${l},${r}`;p.otherPlayers.forEach(y=>{y.data&&y.data.current_chunk===x&&f++})}a.setText(`Players: ${f}`),f>1?a.setColor("#00ff88"):a.setColor("#ffaa00")}updateCryptoDisplay(e,t){const s=this.uiElements.get("cryptoText");s&&(this.scene.uiAnimations?this.scene.uiAnimations.animateCounter(s,e,t,500,a=>`${a.toFixed(2)}`):s.setText(t.toFixed(2)))}getAttributeValue(e,t){if(!e||!Array.isArray(e))return null;const s=e.find(a=>a.trait_type===t||a.trait_type===t.toLowerCase());return s?s.value:null}getRarityColor(e){return{Comum:"#CCCCCC",Incomum:"#00FF00",Raro:"#0080FF",Ã‰pico:"#A020F0",LendÃ¡rio:"#FFD700"}[e]||"#FFFFFF"}destroy(){this.uiElements.forEach(e=>{e&&e.destroy&&e.destroy()}),this.uiElements.clear()}}class A{constructor(e){this.scene=e,this.starsBg=null,this.stars=[],this.starTiles=[],this.playerShip=null,this.lastShipPosition={x:0,y:0},console.log("ðŸŒŒ BackgroundManager inicializado (sistema infinito)")}initialize(e=null){this.playerShip=e,console.log("ðŸŒŒ BackgroundManager: Criando background simples..."),this.createBackground(),console.log("âœ… BackgroundManager: Background simples criado com sucesso!")}createBackground(){const e=this.scene.scale.width,t=this.scene.scale.height;console.log(`ðŸŒŒ Criando background infinito BRILHANTE para tela ${e}x${t}`),this.scene.add.rectangle(0,0,e,t,4403).setOrigin(.5).setDepth(-10),console.log("âœ… Fundo azul escuro criado"),this.createInfiniteStarTiles(),console.log("âœ… Sistema de TileSprites infinitos criado");const s=Math.floor(e*t/4e3);console.log(`ðŸŒŒ Criando ${s} estrelas procedurais brilhantes...`);for(let n=0;n<s;n++){const i=Phaser.Math.Between(-e/2,e/2),o=Phaser.Math.Between(-t/2,t/2),l=Phaser.Math.Between(1,4),r=this.scene.add.rectangle(i,o,l,l,16777215);r.setDepth(-8),r.setAlpha(Phaser.Math.FloatBetween(.8,1)),Math.random()<.6&&this.scene.tweens.add({targets:r,alpha:{from:.8,to:1},scale:{from:1,to:1.5},duration:Phaser.Math.Between(1e3,3e3),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.stars.push(r)}const a=Math.floor(e*t/5e4);console.log(`ðŸŒŒ Criando ${a} estrelas grandes brilhantes...`);for(let n=0;n<a;n++){const i=Phaser.Math.Between(-e/2,e/2),o=Phaser.Math.Between(-t/2,t/2),l=this.scene.add.rectangle(i,o,6,6,11193599);l.setDepth(-8),l.setAlpha(.9),this.scene.tweens.add({targets:l,alpha:{from:.7,to:1},scale:{from:1,to:2},duration:Phaser.Math.Between(2e3,4e3),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.stars.push(l)}this.createNebulas(),console.log(`âœ… Background infinito brilhante criado: ${s+a} estrelas procedurais`)}createInfiniteStarTiles(){const e=this.scene.scale.width,t=this.scene.scale.height,s=Math.max(e,t)*2;for(let a=-1;a<=1;a++)for(let n=-1;n<=1;n++){const i=a*s,o=n*s,l=this.scene.add.tileSprite(i,o,s,s,"stars");l.setOrigin(.5).setDepth(-9).setAlpha(1).setTint(11184895),l.tileX=i,l.tileY=o,l.gridX=a,l.gridY=n,this.starTiles.push(l)}console.log(`âœ… Criados ${this.starTiles.length} TileSprites para cobertura infinita`)}createNebulas(){const e=this.scene.scale.width,t=this.scene.scale.height,s=[6710954,6728294,11176038,6719658];for(let a=0;a<5;a++){const n=Phaser.Math.Between(-e/2,e/2),i=Phaser.Math.Between(-t/2,t/2),o=s[a%s.length],l=this.scene.add.graphics();l.setDepth(-7),l.fillStyle(o,.25),l.fillEllipse(n,i,Phaser.Math.Between(300,600),Phaser.Math.Between(200,400)),l.fillStyle(o,.15),l.fillEllipse(n+50,i+30,Phaser.Math.Between(200,400),Phaser.Math.Between(150,300)),this.scene.tweens.add({targets:l,x:n+Phaser.Math.Between(-30,30),y:i+Phaser.Math.Between(-30,30),alpha:{from:.8,to:1},duration:Phaser.Math.Between(8e3,15e3),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}console.log("âœ… Nebulosas luminosas criadas")}update(e,t){if(!this.playerShip||!this.playerShip.ship)return;const s=this.playerShip.ship,a=s.x,n=s.y;this.starTiles.forEach(i=>{i&&i.active&&(i.tilePositionX+=.3,i.tilePositionY+=.1)}),this.repositionTiles(a,n),this.protectStarsFromCulling(),this.lastShipPosition.x=a,this.lastShipPosition.y=n}repositionTiles(e,t){const s=this.scene.scale.width,a=this.scene.scale.height,n=Math.max(s,a)*2,i=n*.5;this.starTiles.forEach(o=>{if(o&&o.active){const l=e-o.tileX,r=t-o.tileY;if(Math.abs(l)>i||Math.abs(r)>i){const h=Math.round(e/n),c=Math.round(t/n);o.tileX=h*n,o.tileY=c*n,o.x=o.tileX,o.y=o.tileY,o.gridX=h,o.gridY=c}}})}protectStarsFromCulling(){this.stars.forEach(e=>{if(e&&e.active&&(e.setVisible(!0),e.x===0&&e.y===0)){const t=this.scene.scale.width,s=this.scene.scale.height;e.x=Phaser.Math.Between(-t/2,t/2),e.y=Phaser.Math.Between(-s/2,s/2)}})}getBackgroundStats(){return{starTiles:this.starTiles.length,activeTiles:this.starTiles.filter(e=>e&&e.active).length,starsCount:this.stars.length,visibleStars:this.stars.filter(e=>e&&e.visible).length,system:"Infinite Background System"}}destroy(){console.log("ðŸŒŒ BackgroundManager: Destruindo..."),this.starTiles.forEach(e=>{e&&e.active&&e.destroy()}),this.stars.forEach(e=>{e&&e.active&&e.destroy()}),this.starTiles=[],this.stars=[],console.log("âœ… BackgroundManager: DestruÃ­do")}}class O{constructor(e){this.scene=e,this.isGameOver=!1,this.gameOverReason="",this.gameOverElements=[],this.overlayAlpha=.9,this.panelColor=657935,this.borderColor=16711680,this.textColor=16777215,this.slowMotionDuration=1e3,this.slowMotionFactor=.2,this.zoomDuration=1e3,this.zoomLevel=.5,this.screenDelay=1500,this.gameState=null,this.shipManager=null,this.juiceManager=null,this.particleEffects=null,this.audioManager=null,this.uiAnimations=null,console.log("ðŸ’€ GameOverManager inicializado")}initialize(e,t,s,a,n,i){this.gameState=e,this.shipManager=t,this.juiceManager=s,this.particleEffects=a,this.audioManager=n,this.uiAnimations=i,console.log("ðŸ’€ GameOverManager: Sistema inicializado"),this.setupGameOverEvents(),console.log("âœ… GameOverManager: Sistema de game over pronto")}setupGameOverEvents(){this.scene.events.on("gameover",this.handleGameOver.bind(this)),console.log("ðŸ’€ Eventos de game over configurados")}handleGameOver(e){this.isGameOver||(this.isGameOver=!0,this.gameOverReason=e.reason||"unknown",console.log("ðŸ’€ Game Over:",this.gameOverReason),this.trackGameOverEvent(),this.executeGameOverSequence())}executeGameOverSequence(){this.disableShipCollisions(),this.applySlowMotion(),this.createDramaticExplosion(),this.playExplosionSound(),this.destroyShipVisually(),this.applyDramaticZoom(),this.scene.time.delayedCall(this.screenDelay,()=>{this.showGameOverScreen()})}disableShipCollisions(){this.shipManager&&this.shipManager.ship&&this.shipManager.ship.body&&(this.shipManager.ship.body.enable=!1,console.log("ðŸ’€ ColisÃµes da nave desabilitadas"))}applySlowMotion(){this.juiceManager&&(this.juiceManager.slowMotion(this.slowMotionDuration,this.slowMotionFactor),console.log("ðŸ’€ Slow motion aplicado"))}createDramaticExplosion(){this.particleEffects&&this.shipManager&&this.shipManager.ship&&(this.particleEffects.createExplosion(this.shipManager.ship.x,this.shipManager.ship.y,"large"),console.log("ðŸ’€ ExplosÃ£o dramÃ¡tica criada"))}playExplosionSound(){this.audioManager&&(this.audioManager.playExplosion("large"),console.log("ðŸ’€ Som de explosÃ£o tocado"))}destroyShipVisually(){this.scene.time.delayedCall(500,()=>{this.shipManager&&this.shipManager.ship&&(this.shipManager.ship.setVisible(!1),console.log("ðŸ’€ Nave destruÃ­da visualmente"))})}applyDramaticZoom(){this.scene.tweens.add({targets:this.scene.cameras.main,zoom:this.zoomLevel,duration:this.zoomDuration,ease:"Cubic.easeIn",onComplete:()=>{console.log("ðŸ’€ Zoom dramÃ¡tico concluÃ­do")}})}showGameOverScreen(){console.log("ðŸ’€ Mostrando tela de game over..."),this.scene.sound.stopAll();const e=this.createGameOverElements();this.animateGameOverScreen(e),this.setupGameOverControls()}createGameOverElements(){const e=this.scene.cameras.main,t=e.width/2,s=e.height/2,a=this.scene.add.rectangle(e.scrollX+t,e.scrollY+s,e.width*3,e.height*3,0,this.overlayAlpha).setScrollFactor(0).setDepth(200),n=this.scene.add.rectangle(t,s,700,550,this.panelColor,.98).setScrollFactor(0).setDepth(201),i=this.scene.add.rectangle(t,s,700,550,this.borderColor,0).setScrollFactor(0).setDepth(201).setStrokeStyle(5,this.borderColor,1),o=this.scene.add.text(t,s-180,"GAME OVER",{fontSize:"48px",fill:this.textColor,fontFamily:"Arial",stroke:"#ff0000",strokeThickness:3}).setScrollFactor(0).setDepth(202).setOrigin(.5),l=this.scene.add.text(t,s-120,this.getReasonText(),{fontSize:"20px",fill:"#ff6666",fontFamily:"Arial"}).setScrollFactor(0).setDepth(202).setOrigin(.5),r=this.getGameStats(),h=this.scene.add.text(t,s-40,r,{fontSize:"16px",fill:this.textColor,fontFamily:"Arial",align:"center"}).setScrollFactor(0).setDepth(202).setOrigin(.5),c=this.createButton(t-100,s+120,"RESTART",()=>{this.restartGame()}),d=this.createButton(t+100,s+120,"MENU",()=>{this.returnToMenu()}),p={overlay:a,gameOverPanel:n,gameOverBorder:i,gameOverText:o,reasonText:l,statsText:h,restartButton:c,menuButton:d};return this.gameOverElements.push(p),p}createButton(e,t,s,a){const n=this.scene.add.rectangle(e,t,150,50,3355443,.8).setScrollFactor(0).setDepth(202).setStrokeStyle(2,this.borderColor,1),i=this.scene.add.text(e,t,s,{fontSize:"18px",fill:this.textColor,fontFamily:"Arial"}).setScrollFactor(0).setDepth(203).setOrigin(.5);return n.setInteractive(),n.on("pointerover",()=>{n.setFillStyle(4473924),i.setStyle({fill:"#ffff00"})}),n.on("pointerout",()=>{n.setFillStyle(3355443),i.setStyle({fill:this.textColor})}),n.on("pointerdown",a),{button:n,buttonText:i}}getReasonText(){const e={oxygen:"ðŸ’¨ OxigÃªnio Esgotado",collision:"ðŸ’¥ ColisÃ£o Fatal",enemy:"ðŸ‘¾ Derrotado por Inimigo",meteor:"â˜„ï¸ Impacto de Meteoro",unknown:"â“ Causa Desconhecida"};return e[this.gameOverReason]||e.unknown}getGameStats(){return this.gameState?`Score: ${this.gameState.score||0}
Level: ${this.gameState.level||1}
Crypto Mined: ${this.gameState.cryptoBalance||0}
Enemies Killed: ${this.gameState.enemiesKilled||0}
Time Survived: ${this.getSurvivalTime()}`:"EstatÃ­sticas nÃ£o disponÃ­veis"}getSurvivalTime(){if(!this.gameState||!this.gameState.startTime)return"0s";const e=Date.now()-this.gameState.startTime,t=Math.floor(e/6e4),s=Math.floor(e%6e4/1e3);return`${t}m ${s}s`}animateGameOverScreen(e){e.overlay.setAlpha(0),e.gameOverPanel.setAlpha(0),e.gameOverBorder.setAlpha(0),e.gameOverText.setAlpha(0),e.reasonText.setAlpha(0),e.statsText.setAlpha(0),e.restartButton.button.setAlpha(0),e.restartButton.buttonText.setAlpha(0),e.menuButton.button.setAlpha(0),e.menuButton.buttonText.setAlpha(0),this.scene.tweens.add({targets:e.overlay,alpha:this.overlayAlpha,duration:500,ease:"Cubic.easeOut"}),this.scene.time.delayedCall(200,()=>{this.scene.tweens.add({targets:[e.gameOverPanel,e.gameOverBorder],alpha:1,duration:300,ease:"Cubic.easeOut"})}),this.scene.time.delayedCall(400,()=>{this.scene.tweens.add({targets:[e.gameOverText,e.reasonText],alpha:1,duration:300,ease:"Cubic.easeOut"})}),this.scene.time.delayedCall(600,()=>{this.scene.tweens.add({targets:e.statsText,alpha:1,duration:300,ease:"Cubic.easeOut"})}),this.scene.time.delayedCall(800,()=>{this.scene.tweens.add({targets:[e.restartButton.button,e.restartButton.buttonText,e.menuButton.button,e.menuButton.buttonText],alpha:1,duration:300,ease:"Cubic.easeOut"})})}setupGameOverControls(){this.scene.input.keyboard.on("keydown-R",()=>{this.restartGame()}),this.scene.input.keyboard.on("keydown-M",()=>{this.returnToMenu()}),this.scene.input.keyboard.on("keydown-ESC",()=>{this.returnToMenu()})}restartGame(){console.log("ðŸ’€ Reiniciando jogo..."),this.clearGameOverElements(),this.resetGameState(),this.scene.scene.restart()}returnToMenu(){console.log("ðŸ’€ Retornando ao menu..."),this.clearGameOverElements(),this.scene.scene.start("MenuScene")}clearGameOverElements(){this.gameOverElements.forEach(e=>{Object.values(e).forEach(t=>{t&&t.destroy&&t.destroy()})}),this.gameOverElements=[]}resetGameState(){this.isGameOver=!1,this.gameOverReason="",this.gameState&&this.gameState.reset()}trackGameOverEvent(){console.log("ðŸ’€ Game over tracked:",{reason:this.gameOverReason,score:this.gameState?this.gameState.score:0,crypto:this.gameState?this.gameState.cryptoBalance:0})}isGameOverActive(){return this.isGameOver}forceGameOver(e="test"){this.handleGameOver({reason:e})}destroy(){console.log("ðŸ’€ GameOverManager: Destruindo..."),this.clearGameOverElements(),this.scene.events.off("gameover"),this.resetGameState(),console.log("âœ… GameOverManager: DestruÃ­do")}}class M{constructor(e){this.scene=e,this.loadedAssets=new Map,this.loadedChunks=new Set,this.chunkAssets=new Map,this.preloadRadius=1,this.maxCacheSize=100}async init(){console.log("ðŸŽ¨ Inicializando Asset Manager..."),await this.loadSpriteSheets(),console.log("âœ… Asset Manager inicializado")}async loadSpriteSheets(){const e=[{key:"asteroids_common",texturePath:"/assets/spritesheets/asteroids/common_asteroids.png",atlasPath:"/assets/spritesheets/asteroids/common_asteroids.json"},{key:"asteroids_rare",texturePath:"/assets/spritesheets/asteroids/rare_asteroids.png",atlasPath:"/assets/spritesheets/asteroids/rare_asteroids.json"},{key:"asteroids_legendary",texturePath:"/assets/spritesheets/asteroids/legendary_asteroids.png",atlasPath:"/assets/spritesheets/asteroids/legendary_asteroids.json"},{key:"crystals_basic",texturePath:"/assets/spritesheets/crystals/basic_crystals.png",atlasPath:"/assets/spritesheets/crystals/basic_crystals.json"},{key:"crystals_energy",texturePath:"/assets/spritesheets/crystals/energy_crystals.png",atlasPath:"/assets/spritesheets/crystals/energy_crystals.json"},{key:"crystals_quantum",texturePath:"/assets/spritesheets/crystals/quantum_crystals.png",atlasPath:"/assets/spritesheets/crystals/quantum_crystals.json"},{key:"resources_metals",texturePath:"/assets/spritesheets/resources/metals.png",atlasPath:"/assets/spritesheets/resources/metals.json"},{key:"resources_fuels",texturePath:"/assets/spritesheets/resources/fuels.png",atlasPath:"/assets/spritesheets/resources/fuels.json"},{key:"resources_oxygen",texturePath:"/assets/spritesheets/resources/oxygen.png",atlasPath:"/assets/spritesheets/resources/oxygen.json"},{key:"resources_crystals",texturePath:"/assets/spritesheets/resources/crystals.png",atlasPath:"/assets/spritesheets/resources/crystals.json"},{key:"resources_projectiles",texturePath:"/assets/spritesheets/resources/projectiles.png",atlasPath:"/assets/spritesheets/resources/projectiles.json"},{key:"resources_special",texturePath:"/assets/spritesheets/resources/special.png",atlasPath:"/assets/spritesheets/resources/special.json"},{key:"planets",texturePath:"/assets/spritesheets/planets/planets.png",atlasPath:"/assets/spritesheets/planets/planets.json"},{key:"npc_ships",texturePath:"/assets/spritesheets/npcs/npc_ships.png",atlasPath:"/assets/spritesheets/npcs/npc_ships.json"},{key:"space_stations",texturePath:"/assets/spritesheets/stations/space_stations.png",atlasPath:"/assets/spritesheets/stations/space_stations.json"},{key:"effects_explosions",texturePath:"/assets/spritesheets/effects/explosions.png",atlasPath:"/assets/spritesheets/effects/explosions.json"},{key:"effects_particles",texturePath:"/assets/spritesheets/effects/particle_effects.png",atlasPath:"/assets/spritesheets/effects/particle_effects.json"}];for(const t of e)try{if(this.scene.textures.exists(t.key)){console.log(`âš ï¸ Sprite sheet jÃ¡ carregado: ${t.key}`);continue}console.log(`ðŸ“¦ Carregando sprite sheet: ${t.key}`),this.createDummyTexture(t.key)}catch(s){console.warn(`âš ï¸ Erro ao carregar sprite sheet ${t.key}:`,s.message),this.createDummyTexture(t.key)}}createDummyTexture(e){if(this.scene.textures.exists(e))return;const t=this.scene.add.graphics();t.generateTexture(e,64,64),t.destroy(),console.log(`ðŸŽ¨ Criada textura dummy para: ${e}`)}getAssetForElement(e,t,s){const a={asteroid:{getSpriteSheet:i=>i<=10?"asteroids_common":i<=30?"asteroids_rare":"asteroids_legendary",getFrame:i=>`asteroid_${(i==null?void 0:i.size)||"small"}_${Math.floor(Math.random()*3)+1}`},crystal:{getSpriteSheet:i=>i<=10?"crystals_basic":i<=30?"crystals_energy":"crystals_quantum",getFrame:i=>{const o=(i==null?void 0:i.value)||10;return`crystal_${o<=20?"basic":o<=50?"energy":"quantum"}_${Math.floor(Math.random()*2)+1}`}},resource:{getSpriteSheet:i=>{const o=(t==null?void 0:t.resource_type)||"iron";return["iron","copper","aluminum","titanium","platinum"].includes(o)?"resources_metals":["hydrogen","deuterium","antimatter"].includes(o)?"resources_fuels":["liquid_oxygen","compressed_oxygen","air_crystal"].includes(o)?"resources_oxygen":["energy_crystal","power_crystal"].includes(o)?"resources_crystals":["basic_missiles","guided_missiles","energy_missiles","plasma_torpedoes"].includes(o)?"resources_projectiles":"resources_special"},getFrame:i=>{const o=(i==null?void 0:i.resource_type)||"iron",l=Math.floor(Math.random()*3)+1;return`${o}_${l}`}},planet:{getSpriteSheet:i=>"planets",getFrame:i=>{const o=(i==null?void 0:i.planet_type)||"rocky",l=Math.floor(Math.random()*2)+1;return`planet_${o}_${l}`}},npc_trader:{getSpriteSheet:i=>"npc_ships",getFrame:i=>"npc_trader_1"},npc_miner:{getSpriteSheet:i=>"npc_ships",getFrame:i=>"npc_miner_1"},npc_patrol:{getSpriteSheet:i=>"npc_ships",getFrame:i=>"npc_patrol_1"},npc_scavenger:{getSpriteSheet:i=>"npc_ships",getFrame:i=>"npc_scavenger_1"},npc_explorer:{getSpriteSheet:i=>"npc_ships",getFrame:i=>"npc_explorer_1"},station_trading_post:{getSpriteSheet:i=>"space_stations",getFrame:i=>"station_trading_post"},station_mining_station:{getSpriteSheet:i=>"space_stations",getFrame:i=>"station_mining"},station_research_outpost:{getSpriteSheet:i=>"space_stations",getFrame:i=>"station_research"},station_military_base:{getSpriteSheet:i=>"space_stations",getFrame:i=>"station_military"},station_refueling_station:{getSpriteSheet:i=>"space_stations",getFrame:i=>"station_refuel"}};if(e.startsWith("npc_"))return{spriteSheet:"npc_ships",frame:`npc_${e.replace("npc_","")}_1`};if(e.startsWith("station_"))return{spriteSheet:"space_stations",frame:`station_${e.replace("station_","")}`};const n=a[e];return n?{spriteSheet:n.getSpriteSheet(s),frame:n.getFrame(t)}:(console.warn(`âš ï¸ Tipo de elemento nÃ£o mapeado: ${e}`),{spriteSheet:"asteroids_common",frame:"default"})}async preloadChunkAssets(e,t){const s=`${e},${t}`;if(!this.loadedChunks.has(s)){console.log(`ðŸ“¦ Preparando assets para chunk (${e}, ${t})`),this.loadedChunks.add(s),this.loadedChunks.size>this.maxCacheSize&&this.cleanupOldestChunks();for(let a=-this.preloadRadius;a<=this.preloadRadius;a++)for(let n=-this.preloadRadius;n<=this.preloadRadius;n++){const i=`${e+a},${t+n}`;this.loadedChunks.has(i)||this.loadedChunks.add(i)}console.log(`âœ… Assets preparados para chunk (${e}, ${t}) e adjacentes`)}}cleanupOldestChunks(){const e=Array.from(this.loadedChunks).slice(0,10);e.forEach(t=>{this.loadedChunks.delete(t),this.chunkAssets.delete(t)}),console.log(`ðŸ§¹ Removidos ${e.length} chunks mais antigos do cache`)}createElement(e,t,s){const{element_type:a,x:n,y:i,rotation:o,scale:l,data:r}=e,h=Math.sqrt(t*t+s*s),c=this.getAssetForElement(a,r,h);if(!this.scene.textures.exists(c.spriteSheet))return console.warn(`âš ï¸ Sprite sheet nÃ£o encontrado: ${c.spriteSheet}`),this.createFallbackElement(e);const d=this.scene.physics.add.sprite(n,i,c.spriteSheet,c.frame);return d.setRotation(o||0),d.setScale(l||1),d.elementId=e.id,d.elementType=a,d.chunkPosition={x:t,y:s},a==="asteroid"?this.setupAsteroidInteractions(d,e):a==="crystal"&&this.setupCrystalInteractions(d,e),d}setupAsteroidInteractions(e,t){e.setInteractive(),e.on("pointerdown",()=>{console.log("ðŸ’¥ Asteroide clicado:",t.id)})}setupCrystalInteractions(e,t){e.setInteractive(),this.scene.tweens.add({targets:e,alpha:{from:1,to:.7},duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.on("pointerdown",()=>{console.log("ðŸ’Ž Cristal clicado:",t.id)})}createFallbackElement(e){const{element_type:t,x:s,y:a,rotation:n,scale:i}=e,o=this.scene.add.graphics();if(t==="asteroid")o.fillStyle(9143936),o.fillCircle(0,0,20);else if(t==="crystal"){o.fillStyle(65535),o.beginPath();for(let h=0;h<6;h++){const c=Math.PI/3*h,d=Math.cos(c)*15,p=Math.sin(c)*15;h===0?o.moveTo(d,p):o.lineTo(d,p)}o.closePath(),o.fillPath()}const l=`fallback_${t}_${e.id}`;o.generateTexture(l,64,64),o.destroy();const r=this.scene.physics.add.sprite(s,a,l);return r.setRotation(n||0),r.setScale(i||1),r.elementId=e.id,r.elementType=t,r}unloadChunkAssets(e,t){const s=`${e},${t}`;this.loadedChunks.has(s)&&(this.loadedChunks.delete(s),this.chunkAssets.delete(s),console.log(`ðŸ—‘ï¸ Assets descarregados do chunk (${e}, ${t})`))}cleanup(){console.log("ðŸ§¹ Limpando Asset Manager..."),this.loadedAssets.clear(),this.loadedChunks.clear(),this.chunkAssets.clear(),this.scene.textures.getTextureKeys().forEach(t=>{t.startsWith("fallback_")&&this.scene.textures.remove(t)}),console.log("âœ… Asset Manager limpo")}getStats(){return{loadedAssets:this.loadedAssets.size,loadedChunks:this.loadedChunks.size,chunkCacheSize:this.chunkAssets.size,textureCount:this.scene.textures.getTextureKeys().length}}}class S{constructor(e){this.scene=e,this.spriteSheets=new Map,this.frameMappings=new Map,this.textureAtlases=new Map}async init(){console.log("ðŸ–¼ï¸ Inicializando Sprite Sheet Manager..."),await this.loadSpriteSheetConfigs(),await this.generateTextureAtlases(),console.log("âœ… Sprite Sheet Manager inicializado")}async loadSpriteSheetConfigs(){const e=[{key:"asteroids_common",frames:[{name:"asteroid_small_1",x:0,y:0,width:32,height:32},{name:"asteroid_small_2",x:32,y:0,width:32,height:32},{name:"asteroid_small_3",x:64,y:0,width:32,height:32},{name:"asteroid_large_1",x:0,y:32,width:64,height:64},{name:"asteroid_large_2",x:64,y:32,width:64,height:64},{name:"asteroid_large_3",x:128,y:32,width:64,height:64}]},{key:"asteroids_rare",frames:[{name:"asteroid_small_rare_1",x:0,y:0,width:32,height:32},{name:"asteroid_small_rare_2",x:32,y:0,width:32,height:32},{name:"asteroid_small_rare_3",x:64,y:0,width:32,height:32},{name:"asteroid_large_rare_1",x:0,y:32,width:64,height:64},{name:"asteroid_large_rare_2",x:64,y:32,width:64,height:64},{name:"asteroid_large_rare_3",x:128,y:32,width:64,height:64}]},{key:"asteroids_legendary",frames:[{name:"asteroid_small_legendary_1",x:0,y:0,width:32,height:32},{name:"asteroid_small_legendary_2",x:32,y:0,width:32,height:32},{name:"asteroid_small_legendary_3",x:64,y:0,width:32,height:32},{name:"asteroid_large_legendary_1",x:0,y:32,width:64,height:64},{name:"asteroid_large_legendary_2",x:64,y:32,width:64,height:64},{name:"asteroid_large_legendary_3",x:128,y:32,width:64,height:64}]},{key:"crystals_basic",frames:[{name:"crystal_basic_1",x:0,y:0,width:24,height:24},{name:"crystal_basic_2",x:24,y:0,width:24,height:24},{name:"crystal_basic_3",x:48,y:0,width:24,height:24},{name:"crystal_basic_4",x:72,y:0,width:24,height:24}]},{key:"crystals_energy",frames:[{name:"crystal_energy_1",x:0,y:0,width:28,height:28},{name:"crystal_energy_2",x:28,y:0,width:28,height:28},{name:"crystal_energy_3",x:56,y:0,width:28,height:28},{name:"crystal_energy_4",x:84,y:0,width:28,height:28}]},{key:"crystals_quantum",frames:[{name:"crystal_quantum_1",x:0,y:0,width:32,height:32},{name:"crystal_quantum_2",x:32,y:0,width:32,height:32},{name:"crystal_quantum_3",x:64,y:0,width:32,height:32},{name:"crystal_quantum_4",x:96,y:0,width:32,height:32}]},{key:"resources_metals",frames:[{name:"iron_1",x:0,y:0,width:20,height:20},{name:"iron_2",x:20,y:0,width:20,height:20},{name:"iron_3",x:40,y:0,width:20,height:20},{name:"copper_1",x:60,y:0,width:20,height:20},{name:"copper_2",x:80,y:0,width:20,height:20},{name:"copper_3",x:100,y:0,width:20,height:20},{name:"aluminum_1",x:120,y:0,width:22,height:22},{name:"aluminum_2",x:142,y:0,width:22,height:22},{name:"titanium_1",x:164,y:0,width:24,height:24},{name:"titanium_2",x:188,y:0,width:24,height:24},{name:"platinum_1",x:212,y:0,width:26,height:26}]},{key:"resources_fuels",frames:[{name:"hydrogen_1",x:0,y:0,width:18,height:18},{name:"hydrogen_2",x:18,y:0,width:18,height:18},{name:"hydrogen_3",x:36,y:0,width:18,height:18},{name:"deuterium_1",x:54,y:0,width:20,height:20},{name:"deuterium_2",x:74,y:0,width:20,height:20},{name:"antimatter_1",x:94,y:0,width:22,height:22}]},{key:"resources_oxygen",frames:[{name:"liquid_oxygen_1",x:0,y:0,width:16,height:16},{name:"liquid_oxygen_2",x:16,y:0,width:16,height:16},{name:"compressed_oxygen_1",x:32,y:0,width:18,height:18}]},{key:"resources_crystals",frames:[{name:"basic_crystal_1",x:0,y:0,width:24,height:24},{name:"basic_crystal_2",x:24,y:0,width:24,height:24},{name:"basic_crystal_3",x:48,y:0,width:24,height:24},{name:"basic_crystal_4",x:72,y:0,width:24,height:24},{name:"energy_crystal_1",x:96,y:0,width:28,height:28},{name:"energy_crystal_2",x:124,y:0,width:28,height:28},{name:"quantum_crystal_1",x:152,y:0,width:32,height:32},{name:"quantum_crystal_2",x:184,y:0,width:32,height:32},{name:"quantum_crystal_3",x:216,y:0,width:32,height:32},{name:"quantum_crystal_4",x:248,y:0,width:32,height:32},{name:"air_crystal_1",x:0,y:32,width:30,height:30},{name:"power_crystal_1",x:30,y:32,width:34,height:34}]},{key:"resources_projectiles",frames:[{name:"basic_missile_1",x:0,y:0,width:24,height:8},{name:"basic_missile_2",x:24,y:0,width:24,height:8},{name:"guided_missile_1",x:48,y:0,width:28,height:10},{name:"energy_missile_1",x:76,y:0,width:26,height:12},{name:"plasma_torpedo_1",x:102,y:0,width:32,height:14}]},{key:"resources_special",frames:[{name:"space_crystal_1",x:0,y:0,width:36,height:36},{name:"stellar_essence_1",x:36,y:0,width:40,height:40},{name:"reality_fragment_1",x:76,y:0,width:44,height:44}]},{key:"planets",frames:[{name:"planet_rocky_1",x:0,y:0,width:128,height:128},{name:"planet_rocky_2",x:128,y:0,width:128,height:128},{name:"planet_icy_1",x:256,y:0,width:128,height:128},{name:"planet_icy_2",x:384,y:0,width:128,height:128},{name:"planet_desert_1",x:0,y:128,width:128,height:128},{name:"planet_crystal_1",x:128,y:128,width:128,height:128},{name:"planet_gas_1",x:256,y:128,width:128,height:128},{name:"planet_gas_2",x:384,y:128,width:128,height:128}]},{key:"npc_ships",frames:[{name:"npc_trader_1",x:0,y:0,width:48,height:32},{name:"npc_miner_1",x:48,y:0,width:44,height:36},{name:"npc_patrol_1",x:92,y:0,width:52,height:40},{name:"npc_scavenger_1",x:144,y:0,width:36,height:28},{name:"npc_explorer_1",x:180,y:0,width:40,height:30}]},{key:"space_stations",frames:[{name:"station_trading_post",x:0,y:0,width:96,height:80},{name:"station_mining",x:96,y:0,width:80,height:72},{name:"station_research",x:176,y:0,width:88,height:76},{name:"station_military",x:264,y:0,width:104,height:88},{name:"station_refuel",x:368,y:0,width:84,height:74}]},{key:"effects_explosions",frames:[{name:"explosion_small_1",x:0,y:0,width:48,height:48},{name:"explosion_small_2",x:48,y:0,width:48,height:48},{name:"explosion_small_3",x:96,y:0,width:48,height:48},{name:"explosion_small_4",x:144,y:0,width:48,height:48},{name:"explosion_large_1",x:0,y:48,width:96,height:96},{name:"explosion_large_2",x:96,y:48,width:96,height:96},{name:"explosion_large_3",x:192,y:48,width:96,height:96},{name:"explosion_large_4",x:288,y:48,width:96,height:96}]},{key:"effects_particles",frames:[{name:"particle_spark_1",x:0,y:0,width:8,height:8},{name:"particle_spark_2",x:8,y:0,width:8,height:8},{name:"particle_debris_1",x:16,y:0,width:12,height:12},{name:"particle_debris_2",x:28,y:0,width:12,height:12},{name:"particle_energy_1",x:40,y:0,width:16,height:16},{name:"particle_energy_2",x:56,y:0,width:16,height:16}]}];e.forEach(t=>{this.spriteSheets.set(t.key,t),t.frames.forEach(s=>{this.frameMappings.set(s.name,{spriteSheet:t.key,frame:s})})}),console.log(`ðŸ“‹ Carregadas ${e.length} configuraÃ§Ãµes de sprite sheets`)}async generateTextureAtlases(){console.log("ðŸŽ¨ Gerando atlas de texturas...");for(const[e,t]of this.spriteSheets)await this.generateProceduralTextureAtlas(e,t);console.log("âœ… Atlas de texturas gerados")}async generateProceduralTextureAtlas(e,t){const s=document.createElement("canvas"),a=s.getContext("2d");let n=0,i=0;t.frames.forEach(r=>{n=Math.max(n,r.x+r.width),i=Math.max(i,r.y+r.height)}),s.width=Math.max(n,256),s.height=Math.max(i,256),t.frames.forEach(r=>{this.generateFrameTexture(a,r,e)});const o=e;this.scene.textures.exists(o)&&this.scene.textures.remove(o),this.scene.textures.addCanvas(o,s);const l={};t.frames.forEach(r=>{l[r.name]={x:r.x,y:r.y,width:r.width,height:r.height}}),this.scene.textures.get(o).add("atlas",l),console.log(`ðŸŽ¨ Gerado atlas procedural: ${o}`)}generateFrameTexture(e,t,s){e.save(),e.clearRect(t.x,t.y,t.width,t.height),s.includes("asteroid")?this.drawAsteroid(e,t,s):s.includes("crystal")?this.drawCrystal(e,t,s):s.includes("resources")?this.drawResource(e,t,s):s.includes("planets")?this.drawPlanet(e,t,s):s.includes("npc_ships")?this.drawNPCShip(e,t,s):s.includes("space_stations")?this.drawSpaceStation(e,t,s):s.includes("effects")&&this.drawEffect(e,t,s),e.restore()}drawAsteroid(e,t,s){const a=t.x+t.width/2,n=t.y+t.height/2,i=Math.min(t.width,t.height)/2-2;let o="#8B8680";s.includes("rare")?o="#CD853F":s.includes("legendary")&&(o="#FFD700"),e.fillStyle=o,e.strokeStyle="#000000",e.lineWidth=1,e.beginPath();const l=8;for(let r=0;r<l;r++){const h=Math.PI*2*r/l,c=i+(Math.random()-.5)*i*.3,d=a+Math.cos(h)*c,p=n+Math.sin(h)*c;r===0?e.moveTo(d,p):e.lineTo(d,p)}e.closePath(),e.fill(),e.stroke(),e.fillStyle="rgba(0, 0, 0, 0.3)";for(let r=0;r<3;r++){const h=a+(Math.random()-.5)*i,c=n+(Math.random()-.5)*i,d=Math.random()*i*.2;e.beginPath(),e.arc(h,c,d,0,Math.PI*2),e.fill()}}drawCrystal(e,t,s){const a=t.x+t.width/2,n=t.y+t.height/2,i=Math.min(t.width,t.height)*.4;let o="#00FFFF";s.includes("energy")?o="#FF00FF":s.includes("quantum")&&(o="#FFFF00"),e.fillStyle=o,e.strokeStyle="#000000",e.lineWidth=1,e.beginPath();for(let r=0;r<6;r++){const h=Math.PI/3*r,c=a+Math.cos(h)*i,d=n+Math.sin(h)*i;r===0?e.moveTo(c,d):e.lineTo(c,d)}e.closePath(),e.fill(),e.stroke();const l=e.createRadialGradient(a,n,0,a,n,i);l.addColorStop(0,"rgba(255, 255, 255, 0.8)"),l.addColorStop(.5,"rgba(255, 255, 255, 0.3)"),l.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=l,e.beginPath(),e.arc(a,n,i*.6,0,Math.PI*2),e.fill()}drawEffect(e,t,s){const a=t.x+t.width/2,n=t.y+t.height/2;s.includes("explosion")?this.drawExplosion(e,t,a,n):s.includes("particle")&&this.drawParticle(e,t,a,n)}drawNPCShip(e,t,s,a,n,i){let o="trader",l=["#32CD32","#228B22"];s.includes("miner")?(o="miner",l=["#FFD700","#FFA500"]):s.includes("patrol")?(o="patrol",l=["#FF0000","#8B0000"]):s.includes("scavenger")?(o="scavenger",l=["#808080","#696969"]):s.includes("explorer")&&(o="explorer",l=["#00CED1","#008B8B"]),e.fillStyle=l[0],e.strokeStyle=l[1],e.lineWidth=2,e.beginPath(),o==="trader"||o==="miner"?(e.rect(a-i,n-i*.6,i*2,i*1.2),e.moveTo(a-i*1.3,n),e.lineTo(a-i,n-i*.3),e.moveTo(a-i*1.3,n),e.lineTo(a-i,n+i*.3),e.moveTo(a+i*1.3,n),e.lineTo(a+i,n-i*.3),e.moveTo(a+i*1.3,n),e.lineTo(a+i,n+i*.3)):o==="patrol"?(e.moveTo(a,n-i),e.lineTo(a-i*.8,n+i*.8),e.lineTo(a+i*.8,n+i*.8),e.closePath()):o==="scavenger"?(e.moveTo(a-i*.7,n-i*.5),e.lineTo(a+i*.3,n-i*.7),e.lineTo(a+i*.8,n+i*.2),e.lineTo(a-i*.2,n+i*.8),e.lineTo(a-i*.9,n),e.closePath()):o==="explorer"&&e.ellipse(a,n,i*.6,i*1.2,0,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle=l[1],e.beginPath(),e.arc(a,n,i*.2,0,Math.PI*2),e.fill(),e.fillStyle="#FFFFFF";for(let r=0;r<3;r++){const h=a-i*.6+r*i*.6,c=n-i*.2;e.beginPath(),e.arc(h,c,2,0,Math.PI*2),e.fill()}}drawSpaceStation(e,t,s,a,n,i){let o="trading_post",l="#4169E1";if(s.includes("mining")?(o="mining_station",l="#FF8C00"):s.includes("research")?(o="research_outpost",l="#9370DB"):s.includes("military")?(o="military_base",l="#DC143C"):s.includes("refueling")&&(o="refueling_station",l="#00CED1"),e.fillStyle=l,e.strokeStyle="#000000",e.lineWidth=2,e.beginPath(),o==="trading_post"||o==="military_base")e.rect(a-i,n-i,i*2,i*2);else if(o==="mining_station"||o==="refueling_station")e.arc(a,n,i,0,Math.PI*2);else if(o==="research_outpost"){for(let r=0;r<6;r++){const h=Math.PI/3*r,c=a+Math.cos(h)*i,d=n+Math.sin(h)*i;r===0?e.moveTo(c,d):e.lineTo(c,d)}e.closePath()}e.fill(),e.stroke(),e.fillStyle="#C0C0C0",e.strokeStyle="#808080",e.lineWidth=1;for(let r=0;r<4;r++){const h=Math.PI/2*r,c=a+Math.cos(h)*i*1.5,d=n+Math.sin(h)*i*1.5;e.beginPath(),e.rect(c-i*.3,d-i*.3,i*.6,i*.6),e.fill(),e.stroke(),e.beginPath(),e.moveTo(a+Math.cos(h)*i,n+Math.sin(h)*i),e.lineTo(c,d),e.stroke()}e.fillStyle="#FFFF00";for(let r=0;r<8;r++){const h=Math.PI/4*r,c=a+Math.cos(h)*i*.8,d=n+Math.sin(h)*i*.8;e.beginPath(),e.arc(c,d,2,0,Math.PI*2),e.fill()}e.fillStyle="#000000",e.beginPath(),e.arc(a,n,i*.3,0,Math.PI*2),e.fill()}drawResource(e,t,s){const a=t.x+t.width/2,n=t.y+t.height/2,i=Math.min(t.width,t.height)/2;s.includes("metals")?this.drawMetalResource(e,t,s,a,n,i):s.includes("fuels")?this.drawFuelResource(e,t,s,a,n,i):s.includes("oxygen")?this.drawOxygenResource(e,t,s,a,n,i):s.includes("crystals")?this.drawSpecialCrystal(e,t,s,a,n,i):s.includes("projectiles")?this.drawProjectileResource(e,t,s,a,n,i):s.includes("special")&&this.drawSpecialResource(e,t,s,a,n,i)}drawMetalResource(e,t,s,a,n,i){let o="#8B8680";s.includes("copper")?o="#B87333":s.includes("aluminum")?o="#C0C0C0":s.includes("titanium")?o="#8890A0":s.includes("platinum")&&(o="#E5E4E2"),e.fillStyle=o,e.strokeStyle="#000000",e.lineWidth=1,e.beginPath();const l=6;for(let h=0;h<l;h++){const c=Math.PI*2*h/l-Math.PI/2,d=a+Math.cos(c)*i,p=n+Math.sin(c)*i;h===0?e.moveTo(d,p):e.lineTo(d,p)}e.closePath(),e.fill(),e.stroke();const r=e.createLinearGradient(a-i,n-i,a+i,n+i);r.addColorStop(0,"rgba(255, 255, 255, 0.3)"),r.addColorStop(.5,"rgba(255, 255, 255, 0.1)"),r.addColorStop(1,"rgba(0, 0, 0, 0.1)"),e.fillStyle=r,e.fill()}drawFuelResource(e,t,s,a,n,i){let o="#00FFFF";s.includes("deuterium")?o="#00CCFF":s.includes("antimatter")&&(o="#FF00FF"),e.fillStyle=o,e.strokeStyle="#000000",e.lineWidth=1,e.beginPath(),e.ellipse(a,n,i*.8,i,0,0,Math.PI*2),e.fill(),e.stroke();const l=e.createRadialGradient(a,n,0,a,n,i);l.addColorStop(0,"rgba(255, 255, 255, 0.6)"),l.addColorStop(.7,o),l.addColorStop(1,"rgba(0, 0, 0, 0.2)"),e.fillStyle=l,e.fill()}drawOxygenResource(e,t,s,a,n,i){let o="#4169E1";s.includes("compressed")?o="#6495ED":s.includes("air")&&(o="#87CEEB"),e.fillStyle=o,e.strokeStyle="#000000",e.lineWidth=1,e.beginPath(),e.arc(a,n,i,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.6)";for(let l=0;l<3;l++){const r=a+(Math.random()-.5)*i,h=n+(Math.random()-.5)*i,c=i*.2;e.beginPath(),e.arc(r,h,c,0,Math.PI*2),e.fill()}}drawSpecialCrystal(e,t,s,a,n,i){let o="#FFD700";s.includes("air")?o="#87CEEB":s.includes("power")&&(o="#FFFF00"),e.fillStyle=o,e.strokeStyle="#000000",e.lineWidth=1;const l=8;e.beginPath();for(let h=0;h<l*2;h++){const c=Math.PI*h/l,d=h%2===0?i:i*.5,p=a+Math.cos(c)*d,f=n+Math.sin(c)*d;h===0?e.moveTo(p,f):e.lineTo(p,f)}e.closePath(),e.fill(),e.stroke();const r=e.createRadialGradient(a,n,0,a,n,i);r.addColorStop(0,"rgba(255, 255, 255, 0.9)"),r.addColorStop(.3,"rgba(255, 255, 255, 0.5)"),r.addColorStop(.6,o),r.addColorStop(1,"rgba(0, 0, 0, 0.2)"),e.fillStyle=r,e.fill()}drawProjectileResource(e,t,s,a,n,i){let o="#FF6347";s.includes("guided")?o="#FF4500":s.includes("energy")?o="#FF1493":s.includes("plasma")&&(o="#DC143C"),e.fillStyle=o,e.strokeStyle="#000000",e.lineWidth=1,e.beginPath(),e.moveTo(a-i,n),e.lineTo(a+i*.7,n-i*.3),e.lineTo(a+i,n),e.lineTo(a+i*.7,n+i*.3),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#FF8800",e.beginPath(),e.moveTo(a+i*.7,n-i*.3),e.lineTo(a+i*1.2,n),e.lineTo(a+i*.7,n+i*.3),e.closePath(),e.fill()}drawSpecialResource(e,t,s,a,n,i){let o="#9400D3";s.includes("stellar")?o="#FFB6C1":s.includes("reality")&&(o="#FFA500");for(let r=3;r>0;r--){const h=i*(r/3),c=.3/r;e.fillStyle=o,e.globalAlpha=c,e.strokeStyle="#000000",e.lineWidth=1,e.beginPath();const d=12;for(let p=0;p<d;p++){const f=Math.PI*2*p/d,m=h+Math.sin(f*3)*h*.3,x=a+Math.cos(f)*m,y=n+Math.sin(f)*m;p===0?e.moveTo(x,y):e.lineTo(x,y)}e.closePath(),e.fill(),e.stroke()}e.globalAlpha=1;const l=e.createRadialGradient(a,n,0,a,n,i);l.addColorStop(0,"rgba(255, 255, 255, 0.9)"),l.addColorStop(.2,o),l.addColorStop(1,"rgba(0, 0, 0, 0.1)"),e.fillStyle=l,e.beginPath(),e.arc(a,n,i*.3,0,Math.PI*2),e.fill()}drawPlanet(e,t,s,a,n,i){let o=["#8B7355","#A0522D"];s.includes("icy")?o=["#B0E0E6","#87CEEB"]:s.includes("desert")?o=["#DEB887","#D2691E"]:s.includes("crystal")?o=["#E6E6FA","#D8BFD8"]:s.includes("gas")&&(o=["#FFB6C1","#FFC0CB"]);const l=e.createRadialGradient(a-i*.3,n-i*.3,0,a,n,i);l.addColorStop(0,o[0]),l.addColorStop(.7,o[1]),l.addColorStop(1,"rgba(0, 0, 0, 0.3)"),e.fillStyle=l,e.beginPath(),e.arc(a,n,i,0,Math.PI*2),e.fill(),s.includes("gas")&&(e.strokeStyle="rgba(255, 255, 255, 0.3)",e.lineWidth=2,e.beginPath(),e.ellipse(a,n,i*1.5,i*.3,0,0,Math.PI*2),e.stroke()),e.fillStyle="rgba(0, 0, 0, 0.1)";for(let r=0;r<5;r++){const h=a+(Math.random()-.5)*i*1.5,c=n+(Math.random()-.5)*i*1.5,d=Math.random()*i*.2;e.beginPath(),e.arc(h,c,d,0,Math.PI*2),e.fill()}}drawExplosion(e,t,s,a){const n=Math.min(t.width,t.height)/2-2;["#FFFFFF","#FFFF00","#FF8800","#FF0000","#880000"].forEach((o,l)=>{const r=n*(1-l*.2);r>0&&(e.fillStyle=o,e.globalAlpha=.7-l*.1,e.beginPath(),e.arc(s,a,r,0,Math.PI*2),e.fill())}),e.globalAlpha=1}drawParticle(e,t,s,a){const n=Math.min(t.width,t.height)/3,i=e.createRadialGradient(s,a,0,s,a,n);i.addColorStop(0,"#FFFFFF"),i.addColorStop(.5,"#FFFF00"),i.addColorStop(1,"rgba(255, 255, 0, 0)"),e.fillStyle=i,e.beginPath(),e.arc(s,a,n,0,Math.PI*2),e.fill()}getRandomFrame(e,t="common"){const s=Array.from(this.frameMappings.keys()).filter(n=>n.includes(e)&&n.includes(t));if(s.length===0)return console.warn(`âš ï¸ Nenhum frame encontrado para ${e}_${t}`),"asteroid_small_1";const a=s[Math.floor(Math.random()*s.length)];return this.frameMappings.get(a)}getAllFrames(e){return Array.from(this.frameMappings.keys()).filter(s=>s.includes(e)).map(s=>this.frameMappings.get(s))}isSpriteSheetLoaded(e){return this.scene.textures.exists(e)}getStats(){return{spriteSheetsCount:this.spriteSheets.size,frameMappingsCount:this.frameMappings.size,loadedAtlases:this.textureAtlases.size,availableFrames:Array.from(this.frameMappings.keys())}}cleanup(){console.log("ðŸ§¹ Limpando Sprite Sheet Manager...");for(const e of this.spriteSheets.keys())this.scene.textures.exists(e)&&this.scene.textures.remove(e);this.spriteSheets.clear(),this.frameMappings.clear(),this.textureAtlases.clear(),console.log("âœ… Sprite Sheet Manager limpo")}}class B{constructor(e){this.scene=e,this.otherPlayers=new Map,this.currentChunk={x:0,y:0},this.lastPositionUpdate=0,this.positionUpdateInterval=100,this.playerId=null,this.isConnected=!1,this.isAuthenticated=!1,this.assetManager=new M(e),this.spriteSheetManager=new S(e),this.chunkElements=new Map}async init(){console.log("ðŸŒ Inicializando Multiplayer Manager..."),await this.spriteSheetManager.init(),await this.assetManager.init(),g.isConnected()||(g.connect(),await new Promise(e=>{if(g.isConnected())e();else{const t=()=>{g.isConnected()&&(window.removeEventListener("socket:connected",t),e())};window.addEventListener("socket:connected",t),setTimeout(()=>{window.removeEventListener("socket:connected",t),e()},5e3)}})),console.log("ðŸ” Tentando autenticar..."),await g.authenticate(),await this.waitForAuthentication(),this.setupEventListeners(),this.enterChunk(0,0),console.log("âœ… Multiplayer Manager inicializado")}async waitForAuthentication(){return new Promise(e=>{if(g.isAuthenticated()){this.isAuthenticated=!0,this.playerId=g.getPlayerId(),console.log("âœ… JÃ¡ autenticado:",this.playerId),e();return}const t=()=>{g.isAuthenticated()&&(this.isAuthenticated=!0,this.playerId=g.getPlayerId(),console.log("âœ… Autenticado:",this.playerId),window.removeEventListener("socket:authenticated",t),e())};window.addEventListener("socket:authenticated",t),setTimeout(()=>{this.isAuthenticated||(console.warn("âš ï¸ Timeout de autenticaÃ§Ã£o, continuando sem multiplayer"),window.removeEventListener("socket:authenticated",t),e())},1e4)})}setupEventListeners(){window.addEventListener("socket:chunk:data",e=>{this.handleChunkData(e.detail)}),window.addEventListener("socket:player:joined",e=>{this.handlePlayerJoined(e.detail)}),window.addEventListener("socket:player:left",e=>{this.handlePlayerLeft(e.detail)}),window.addEventListener("socket:player:moved",e=>{this.handlePlayerMoved(e.detail)}),window.addEventListener("socket:battle:hit",e=>{this.handleBattleHit(e.detail)}),window.addEventListener("socket:battle:attack",e=>{this.handleBattleAttack(e.detail)}),window.addEventListener("socket:player:died",e=>{this.handlePlayerDied(e.detail)}),window.addEventListener("socket:player:death",e=>{this.handlePlayerDeath(e.detail)}),window.addEventListener("socket:player:respawned",e=>{this.handlePlayerRespawned(e.detail)})}enterChunk(e,t){this.isAuthenticated&&(console.log(`ðŸ“ Entrando no chunk (${e}, ${t})`),this.currentChunk={x:e,y:t},g.enterChunk(e,t))}updatePosition(e,t){if(!this.isAuthenticated)return;const s=Date.now();if(s-this.lastPositionUpdate<this.positionUpdateInterval)return;this.lastPositionUpdate=s;const a=Math.floor(e/1e3),n=Math.floor(t/1e3);(a!==this.currentChunk.x||n!==this.currentChunk.y)&&this.enterChunk(a,n),g.updatePosition(Math.floor(e),Math.floor(t),a,n)}handleChunkData(e){var t,s,a,n,i,o,l;console.log("ðŸ“¦ Chunk data recebido:",e),console.log("ðŸ“Š Players no chunk:",((t=e.players)==null?void 0:t.length)||0),console.log("ðŸ“Š Asteroides no chunk:",((s=e.asteroids)==null?void 0:s.length)||0),console.log("ðŸ“Š Cristais no chunk:",((a=e.crystals)==null?void 0:a.length)||0),console.log("ðŸ“Š Recursos no chunk:",((n=e.resources)==null?void 0:n.length)||0),console.log("ðŸ“Š Planetas no chunk:",((i=e.planets)==null?void 0:i.length)||0),console.log("ðŸ“Š NPCs no chunk:",((o=e.npcs)==null?void 0:o.length)||0),console.log("ðŸ“Š EstaÃ§Ãµes no chunk:",((l=e.stations)==null?void 0:l.length)||0),console.log("ðŸ†” Meu player ID:",this.playerId),this.clearOtherPlayers(),this.clearChunkElements(e.chunk.chunkX,e.chunk.chunkY),this.assetManager.preloadChunkAssets(e.chunk.chunkX,e.chunk.chunkY),e.asteroids&&e.asteroids.length>0&&(console.log("ðŸŒ‘ Processando asteroides do chunk..."),this.spawnChunkElements(e.asteroids,e.chunk.chunkX,e.chunk.chunkY,"asteroid")),e.crystals&&e.crystals.length>0&&(console.log("ðŸ’Ž Processando cristais do chunk..."),this.spawnChunkElements(e.crystals,e.chunk.chunkX,e.chunk.chunkY,"crystal")),e.resources&&e.resources.length>0&&(console.log("â›ï¸ Processando recursos minerais do chunk..."),this.spawnChunkElements(e.resources,e.chunk.chunkX,e.chunk.chunkY,"resource")),e.planets&&e.planets.length>0&&(console.log("ðŸª Processando planetas do chunk..."),this.spawnChunkElements(e.planets,e.chunk.chunkX,e.chunk.chunkY,"planet")),e.npcs&&e.npcs.length>0&&(console.log("ðŸš€ Processando NPCs do chunk..."),e.npcs.forEach(r=>{this.spawnNPC(r,e.chunk.chunkX,e.chunk.chunkY)})),e.stations&&e.stations.length>0&&(console.log("ðŸ­ Processando estaÃ§Ãµes espaciais do chunk..."),e.stations.forEach(r=>{this.spawnSpaceStation(r,e.chunk.chunkX,e.chunk.chunkY)})),e.players&&e.players.length>0?(console.log("ðŸ‘¥ Processando players do chunk..."),e.players.forEach(r=>{console.log(`  - Player: ${r.username} (ID: ${r.id})`),r.id!==this.playerId?(console.log(`    âœ… Adicionando player ${r.username}`),this.addOtherPlayer(r)):console.log("    â­ï¸ Pulando (Ã© vocÃª mesmo)")})):console.log("âš ï¸ Nenhum player no chunk ou data.players vazio"),console.log("ðŸ“Š Total de outros players apÃ³s processamento:",this.otherPlayers.size),console.log("ðŸ“Š Total de elementos visÃ­veis:",this.chunkElements.size)}handlePlayerJoined(e){console.log("ðŸ‘¤ Player entrou:",e.username),e.id!==this.playerId&&this.addOtherPlayer(e)}handlePlayerLeft(e){console.log("ðŸ‘‹ Player saiu:",e.playerId),this.removeOtherPlayer(e.playerId)}handlePlayerMoved(e){const t=this.otherPlayers.get(e.playerId);t&&t.sprite&&this.scene.tweens.add({targets:[t.sprite,t.nameText],x:e.x,y:e.y,duration:this.positionUpdateInterval,ease:"Linear"})}spawnChunkElements(e,t,s,a){const n=`${t},${s}`;this.chunkElements.has(n)||this.chunkElements.set(n,[]);const i=this.chunkElements.get(n);e.forEach(o=>{try{const l=this.assetManager.createElement({...o,element_type:a,chunk_x:t,chunk_y:s},t,s);i.push({id:o.id,sprite:l,type:a,chunkX:t,chunkY:s}),console.log(`âœ… Elemento spawnado: ${a} (${o.x}, ${o.y})`)}catch(l){console.error(`âŒ Erro ao spawnar elemento ${a}:`,l)}})}clearChunkElements(e,t){const s=`${e},${t}`,a=this.chunkElements.get(s);a&&(a.forEach(n=>{n.sprite&&n.sprite.destroy(),n.text&&n.text.destroy(),n.texts&&n.texts.forEach(i=>i.destroy())}),this.chunkElements.delete(s),console.log(`ðŸ§¹ Limpos elementos do chunk (${e}, ${t})`))}removeElement(e,t,s){var i,o;const a=`${t},${s}`,n=this.chunkElements.get(a);if(n){const l=n.findIndex(r=>r.id===e);if(l!==-1){const r=n[l],h=((i=r.sprite)==null?void 0:i.x)||0,c=((o=r.sprite)==null?void 0:o.y)||0;r.sprite&&r.sprite.destroy(),r.text&&r.text.destroy(),r.texts&&r.texts.forEach(d=>d.destroy()),n.splice(l,1),this.createElementDestroyEffect(h,c,r.type),console.log(`ðŸ’¥ Elemento removido: ${r.type} (${e})`)}}}createElementDestroyEffect(e,t,s){if(this.scene.textures.exists("effects_explosions")){const a=this.scene.add.sprite(e,t,"effects_explosions","explosion_small_1");a.setScale(.5),a.setDepth(20),this.scene.tweens.add({targets:a,scaleX:1.2,scaleY:1.2,alpha:0,duration:300,ease:"Power2",onComplete:()=>{a.destroy()}})}else{const a=this.scene.add.graphics();a.fillStyle(16746496,.8),a.fillCircle(e,t,20),this.scene.tweens.add({targets:a,scaleX:2,scaleY:2,alpha:0,duration:400,ease:"Power2",onComplete:()=>{a.destroy()}})}}addOtherPlayer(e){if(this.otherPlayers.has(e.id)){console.log("âš ï¸ Player jÃ¡ existe:",e.username);return}if(console.log("âž• Adicionando player:",e.username,`(${e.x}, ${e.y})`),console.log("ðŸ“Š Data completa:",e),!this.scene.textures.exists("enemy")&&(console.error('âŒ Sprite "enemy" nÃ£o encontrado! Usando fallback...'),!(this.scene.textures.exists("nave")?"nave":null))){console.error("âŒ Nenhum sprite disponÃ­vel para outros players!");return}const t=this.scene.textures.exists("enemy")?"enemy":"nave";console.log("ðŸŽ¨ Usando sprite:",t);const s=this.scene.physics.add.sprite(e.x,e.y,t);s.setScale(.6);try{this.scene.anims.exists("enemy_thrust")?s.play("enemy_thrust"):this.scene.anims.exists("nave_thrust")&&s.play("nave_thrust")}catch(o){console.warn("âš ï¸ AnimaÃ§Ã£o nÃ£o disponÃ­vel:",o.message)}s.setDepth(10),console.log("âœ… Sprite criado:",s);const a=this.scene.add.text(e.x,e.y-40,e.username,{fontSize:"14px",fontFamily:"Arial",color:"#00ff88",stroke:"#000000",strokeThickness:3,align:"center"});a.setOrigin(.5),a.setDepth(11);const n=this.scene.add.rectangle(e.x,e.y-50,50,5,0);n.setOrigin(.5),n.setDepth(11);const i=this.scene.add.rectangle(e.x,e.y-50,50,5,65280);i.setOrigin(.5,.5),i.setDepth(12),this.otherPlayers.set(e.id,{id:e.id,username:e.username,sprite:s,nameText:a,healthBarBg:n,healthBar:i,health:e.health||100,maxHealth:e.max_health||100,data:e})}removeOtherPlayer(e){const t=this.otherPlayers.get(e);t&&(console.log("âž– Removendo player:",t.username),t.sprite&&t.sprite.destroy(),t.nameText&&t.nameText.destroy(),t.healthBarBg&&t.healthBarBg.destroy(),t.healthBar&&t.healthBar.destroy(),this.otherPlayers.delete(e))}clearOtherPlayers(){this.otherPlayers.forEach((e,t)=>{this.removeOtherPlayer(t)})}handleBattleHit(e){console.log("ðŸ’¥ VocÃª foi atingido!",e),this.scene.shipHealth!==void 0&&(this.scene.shipHealth=e.health,this.scene.updateHealthBar&&this.scene.updateHealthBar(),this.scene.juiceManager&&(this.scene.juiceManager.screenShake(200,.01),this.scene.juiceManager.flashColor(this.scene.ship,16711680,200)),e.wasFatal&&console.log("ðŸ’€ VocÃª morreu!"))}handleBattleAttack(e){console.log("âš”ï¸ Combate:",e);const t=this.otherPlayers.get(e.attackerId),s=this.otherPlayers.get(e.defenderId);if(t&&s){const a=this.scene.add.graphics();if(a.lineStyle(2,e.isCritical?16711680:16776960,1),a.beginPath(),a.moveTo(t.sprite.x,t.sprite.y),a.lineTo(s.sprite.x,s.sprite.y),a.strokePath(),a.setDepth(5),this.scene.time.delayedCall(200,()=>{a.destroy()}),s.healthBar){s.health=Math.max(0,s.health-e.damage);const n=s.health/s.maxHealth;s.healthBar.setScale(n,1),n>.5?s.healthBar.setFillStyle(65280):n>.25?s.healthBar.setFillStyle(16776960):s.healthBar.setFillStyle(16711680)}}}handlePlayerDied(e){console.log("ðŸ’€ Player morreu:",e.victimName);const t=this.otherPlayers.get(e.victimId);t&&t.sprite&&(this.scene.createExplosion&&this.scene.createExplosion(t.sprite.x,t.sprite.y),this.removeOtherPlayer(e.victimId))}handlePlayerDeath(e){console.log("ðŸ’€ VocÃª morreu!",e),this.scene.showDeathScreen&&this.scene.showDeathScreen(e),this.scene.time.delayedCall(e.respawnDelay||5e3,()=>{g.respawn()})}handlePlayerRespawned(e){console.log("ðŸ”„ Respawn:",e),this.scene.shipHealth!==void 0&&(this.scene.shipHealth=e.health,this.scene.shipMaxHealth=e.maxHealth,this.scene.updateHealthBar&&this.scene.updateHealthBar()),this.scene.ship&&this.scene.ship.setPosition(e.x,e.y),this.scene.juiceManager&&this.scene.juiceManager.flashColor(this.scene.ship,65535,500)}attackPlayer(e){if(!this.isAuthenticated){console.warn("âš ï¸ NÃ£o autenticado, nÃ£o pode atacar");return}console.log("âš”ï¸ Atacando player:",e),g.attack(e)}spawnNPC(e,t,s){const a=`${t},${s}`;this.chunkElements.has(a)||this.chunkElements.set(a,[]);const n=this.chunkElements.get(a);try{const i=this.assetManager.createElement({...e,element_type:e.ship_type?`npc_${e.ship_type}`:"npc_trader",chunk_x:t,chunk_y:s},t,s),o=this.scene.add.text(i.x,i.y-30,e.behavior||"neutral",{fontSize:"12px",fill:e.behavior==="hostile"?"#ff0000":e.behavior==="friendly"?"#00ff00":"#ffff00",backgroundColor:"rgba(0,0,0,0.7)",padding:{x:4,y:2}}).setOrigin(.5).setDepth(1e3);n.push({id:e.id,sprite:i,text:o,type:"npc",chunkX:t,chunkY:s}),console.log(`âœ… NPC spawnado: ${e.ship_type} (${e.x}, ${e.y})`)}catch(i){console.error("âŒ Erro ao spawnar NPC:",i)}}spawnSpaceStation(e,t,s){var i;const a=`${t},${s}`;this.chunkElements.has(a)||this.chunkElements.set(a,[]);const n=this.chunkElements.get(a);try{const o=this.assetManager.createElement({...e,element_type:e.station_type?`station_${e.station_type}`:"station_trading_post",chunk_x:t,chunk_y:s},t,s),l=this.scene.add.text(o.x,o.y-50,((i=e.station_type)==null?void 0:i.replace("_"," "))||"trading post",{fontSize:"14px",fill:"#00ffff",backgroundColor:"rgba(0,0,0,0.8)",padding:{x:6,y:3}}).setOrigin(.5).setDepth(1e3),r=this.scene.add.text(o.x,o.y-35,(e.services||[]).slice(0,3).join(" â€¢ "),{fontSize:"10px",fill:"#ffffff",backgroundColor:"rgba(0,0,100,0.6)",padding:{x:4,y:2}}).setOrigin(.5).setDepth(1e3);n.push({id:e.id,sprite:o,texts:[l,r],type:"station",chunkX:t,chunkY:s}),console.log(`âœ… EstaÃ§Ã£o spawnada: ${e.station_type} (${e.x}, ${e.y})`)}catch(o){console.error("âŒ Erro ao spawnar estaÃ§Ã£o:",o)}}update(){this.otherPlayers.forEach(e=>{e.sprite&&e.nameText&&e.nameText.setPosition(e.sprite.x,e.sprite.y-40),e.sprite&&e.healthBarBg&&e.healthBarBg.setPosition(e.sprite.x,e.sprite.y-50),e.sprite&&e.healthBar&&e.healthBar.setPosition(e.sprite.x,e.sprite.y-50)}),this.chunkElements.forEach(e=>{e.forEach(t=>{t.type==="npc"&&t.text&&t.sprite?t.text.setPosition(t.sprite.x,t.sprite.y-30):t.type==="station"&&t.texts&&t.sprite&&(t.texts[0].setPosition(t.sprite.x,t.sprite.y-50),t.texts[1].setPosition(t.sprite.x,t.sprite.y-35))})})}destroy(){console.log("ðŸ§¹ Limpando Multiplayer Manager..."),this.clearOtherPlayers(),this.chunkElements.forEach((e,t)=>{e.forEach(s=>{s.sprite&&s.sprite.destroy(),s.text&&s.text.destroy(),s.texts&&s.texts.forEach(a=>a.destroy())})}),this.chunkElements.clear(),this.assetManager&&this.assetManager.cleanup(),this.spriteSheetManager&&this.spriteSheetManager.cleanup(),console.log("âœ… Multiplayer Manager limpo")}}class R extends Phaser.Scene{constructor(){super("MultiplayerGameScene"),this.juiceManager=null,this.audioManager=null,this.particleEffects=null,this.uiAnimations=null,this.trailEffects=null,this.gameState=null,this.shipManager=null,this.collisionManager=null,this.uiManager=null,this.backgroundManager=null,this.gameOverManager=null,this.multiplayerManager=null,this.assetManager=null,this.spriteSheetManager=null,this.connectedWallet=null,this.cursors=null,this.spaceKey=null,this.testExplosionKey=null,this.projectiles=null,this.lastCleanup=0,this.cleanupInterval=3e4,this.lastDebugTime=0,this.crosshair=null,this.crosshairPulseTween=null,this.lockedTarget=null,this.lockOnStartTime=0,this.lockOnDuration=3e3,this.lockOnIndicator=null,this.currentChunk={x:0,y:0},this.chunkTransitionTime=0,this.isTransitioning=!1}preload(){this.load.setPath(""),this.load.json("defaultShipMetadata","src/assets/default_ship_metadata.json"),this.load.atlas("ship","/assets/images/01.png","/assets/images/01.json"),this.load.image("ship_idle","/assets/images/idle.png"),this.load.atlas("rocket","/assets/images/rocket.png","/assets/images/rocket.json"),this.load.atlas("minibullet","/assets/images/minibullet.png","/assets/images/minibullet.json"),this.load.atlas("enemy","/assets/images/02.png","/assets/images/02.json"),this.load.atlas("meteoro","/assets/images/meteoro.png","/assets/images/meteoro.json"),this.load.atlas("explosion","/assets/images/explosion.png","/assets/images/explosion.json"),this.load.image("crosshair","/assets/aim/aim1.png"),this.load.atlas("planets","/assets/background/planets.png","/assets/background/planets.json"),this.load.image("stars","/assets/background/stars.jpeg"),this.load.audio("laser","/assets/sounds/laser.mp3"),this.load.audio("explosion","/assets/sounds/explosion.mp3"),this.load.audio("engine","/assets/sounds/engine.mp3"),this.load.audio("pickup","/assets/sounds/pickup.mp3"),this.load.audio("rocket","/assets/sounds/rocket.mp3"),this.load.audio("damage","/assets/sounds/damage.mp3"),this.load.audio("powerup","/assets/sounds/powerup.mp3"),this.load.on("progress",e=>{console.log(`ðŸ“¦ Carregando assets: ${Math.floor(e*100)}%`)}),this.load.on("complete",()=>{console.log("âœ… Todos os assets carregados com sucesso")})}async create(e){console.log("ðŸš€ Iniciando MultiplayerGameScene..."),console.log("ðŸ“Š Dados recebidos:",e);try{this.initializeEffectManagers(),this.initializeEssentialManagers(e),this.initializeMultiplayerManagers(),this.setupScene(e),await this.createGameObjects(),this.setupSystems(),this.setupInput(),this.setupMultiplayerEvents(),console.log("âœ… MultiplayerGameScene inicializada com sucesso!")}catch(t){console.error("âŒ Erro ao inicializar MultiplayerGameScene:",t)}}initializeEffectManagers(){console.log("ðŸŽ¨ Inicializando managers de efeitos visuais..."),console.log("ðŸ” Inicializando JuiceManager..."),this.juiceManager=new w(this),console.log("âœ… JuiceManager inicializado"),console.log("ðŸ” Inicializando AudioManager..."),this.audioManager=new C(this),console.log("âœ… AudioManager inicializado"),console.log("ðŸ” Inicializando ParticleEffects..."),this.particleEffects=new E(this),console.log("âœ… ParticleEffects inicializado"),console.log("ðŸ” Inicializando UIAnimations..."),this.uiAnimations=new v(this),console.log("âœ… UIAnimations inicializado"),console.log("ðŸ” Inicializando TrailEffects..."),this.trailEffects=new k(this),console.log("âœ… TrailEffects inicializado")}initializeEssentialManagers(e){if(console.log("ðŸ”§ Inicializando managers essenciais..."),!this.sys){console.error("âŒ this.sys nÃ£o estÃ¡ disponÃ­vel!");return}this.gameState=new P(this),console.log("âœ… GameStateManager inicializado"),e&&e.playerName&&(this.gameState.setPlayerName(e.playerName),console.log("âœ… Nome do jogador configurado")),this.connectedWallet=e&&e.walletAddress?e.walletAddress:null,this.shipManager=new F(this,this.gameState),console.log("âœ… ShipManager inicializado"),this.collisionManager=new T(this),console.log("âœ… CollisionManager inicializado"),this.uiManager=new b(this,this.gameState),console.log("âœ… UIManager inicializado"),this.backgroundManager=new A(this),console.log("âœ… BackgroundManager inicializado"),this.gameOverManager=new O(this),console.log("âœ… GameOverManager inicializado")}initializeMultiplayerManagers(){console.log("ðŸŒ Inicializando managers multiplayer..."),console.log("ðŸ” Inicializando SpriteSheetManager..."),this.spriteSheetManager=new S(this),this.spriteSheetManager.createAllSpriteSheets(),console.log("âœ… SpriteSheetManager inicializado"),console.log("ðŸ” Inicializando AssetManager..."),this.assetManager=new M(this,this.spriteSheetManager),console.log("âœ… AssetManager inicializado"),console.log("ðŸ” Inicializando MultiplayerManager..."),this.multiplayerManager=new B(this,this.assetManager,this.spriteSheetManager,this.juiceManager),console.log("âœ… MultiplayerManager inicializado")}setupScene(e){this.game.config.width,this.game.config.height,this.physics.world.setBounds(-5e4,-5e4,1e5,1e5),this.rocketSound=this.sound.add("rocket",{loop:!0,volume:.5}),this.isRocketPlaying=!1,console.log("ðŸŒŒ Background configurado para contexto multiplayer"),this.createAnimations(),this.setupCamera(),this.createCrosshair(),this.projectiles=this.physics.add.group({defaultKey:"minibullet",maxSize:50}),console.log("âœ… Cena multiplayer configurada")}async createGameObjects(){console.log("ðŸŽ® Criando objetos do jogo multiplayer..."),console.log("ðŸ” Inicializando sistema de background..."),this.backgroundManager.initialize(),console.log("âœ… Sistema de background inicializado"),console.log("ðŸ” Criando nave do jogador..."),await this.shipManager.create(),console.log("âœ… Nave criada:",this.shipManager.ship),this.shipManager.ship&&(this.cameras.main.startFollow(this.shipManager.ship),console.log("âœ… CÃ¢mera configurada para seguir a nave")),console.log("ðŸ” Configurando colisÃµes multiplayer..."),this.collisionManager.setupAllCollisions(this.shipManager.ship),console.log("âœ… ColisÃµes configuradas"),console.log("ðŸ” Inicializando interface multiplayer..."),this.uiManager.initialize(),console.log("âœ… Interface inicializada"),console.log("ðŸŒ Inicializando conexÃ£o multiplayer...");try{await this.multiplayerManager.init(),console.log("âœ… Sistema multiplayer inicializado")}catch(e){console.error("âŒ Erro ao inicializar multiplayer:",e)}console.log("âœ… Objetos do jogo multiplayer criados")}setupSystems(){this.events.on("gameover",this.handleGameOver.bind(this)),this.events.on("pause",this.handlePause.bind(this)),this.events.on("resume",this.handleResume.bind(this)),this.events.on("chunk_changed",this.handleChunkChanged.bind(this)),this.events.on("element_destroyed",this.handleElementDestroyed.bind(this)),console.log("âœ… Sistemas configurados")}setupInput(){this.input.on("pointerdown",e=>{e.rightButtonDown()}),this.cursors=this.input.keyboard.createCursorKeys(),this.spaceKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.testExplosionKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E),this.input.on("pointerdown",e=>{e.leftButtonDown()&&this.fireProjectile()}),console.log("âœ… Controles configurados")}setupMultiplayerEvents(){console.log("âœ… Eventos multiplayer configurados")}createAnimations(){this.anims.create({key:"ship_thrust",frames:this.anims.generateFrameNames("ship",{prefix:"01 ",start:0,end:1,suffix:".aseprite"}),frameRate:10,repeat:-1}),this.anims.create({key:"ship_idle",frames:[{key:"ship_idle"}],frameRate:1,repeat:0}),this.anims.create({key:"explosion",frames:this.anims.generateFrameNames("explosion",{prefix:"explo",start:0,end:7,suffix:".aseprite"}),frameRate:20,repeat:0}),console.log("âœ… AnimaÃ§Ãµes criadas")}setupCamera(){this.cameras.main.setZoom(1),this.cameras.main.setBounds(-5e4,-5e4,1e5,1e5),console.log("âœ… CÃ¢mera configurada")}createCrosshair(){this.crosshair=this.add.image(0,0,"crosshair").setOrigin(.5).setScrollFactor(0).setDepth(1e3),this.crosshairPulseTween=this.tweens.add({targets:this.crosshair,scaleX:1.1,scaleY:1.1,duration:500,ease:"Sine.easeInOut",yoyo:!0,repeat:-1}),console.log("âœ… Mira criada")}fireProjectile(){if(!this.shipManager||!this.shipManager.ship)return;const e=this.shipManager.ship,t=this.input.activePointer,s=Phaser.Math.Angle.Between(e.x,e.y,t.worldX,t.worldY),a=this.projectiles.get(e.x,e.y);if(a){a.setActive(!0),a.setVisible(!0);const n=800;a.setVelocity(Math.cos(s)*n,Math.sin(s)*n),a.rotation=s,this.particleEffects&&this.particleEffects.createMuzzleFlash(e.x,e.y,s),this.audioManager&&this.audioManager.playSound("laser"),this.juiceManager&&this.juiceManager.screenShake(50,2),this.time.delayedCall(2e3,()=>{a.setActive(!1),a.setVisible(!1)})}}update(e,t){this.particleEffects&&this.particleEffects.update(e,t),this.trailEffects&&this.trailEffects.update(e,t),this.shipManager&&this.shipManager.update(e,t),this.multiplayerManager&&this.multiplayerManager.update(),this.updateCrosshair(),this.updateLockOn(),e-this.lastCleanup>this.cleanupInterval&&(this.performCleanup(),this.lastCleanup=e),e-this.lastDebugTime>1e3&&(this.debugInfo(),this.lastDebugTime=e)}updateCrosshair(){this.crosshair&&this.input.activePointer&&(this.crosshair.x=this.input.activePointer.x,this.crosshair.y=this.input.activePointer.y)}updateLockOn(){}performCleanup(){console.log("ðŸ§¹ Realizando cleanup de performance..."),this.projectiles.children.entries.forEach(e=>{e.active||this.projectiles.remove(e,!0,!0)})}debugInfo(){if(this.multiplayerManager){const e=this.multiplayerManager.getServerStats();console.log("ðŸ“Š Stats Multiplayer:",e)}}handleGameOver(){console.log("ðŸ’€ Game Over - Contexto Multiplayer"),this.gameOverManager&&this.gameOverManager.showGameOver(),this.multiplayerManager&&this.multiplayerManager.disconnect()}handlePause(){console.log("â¸ï¸ Jogo pausado - Contexto Multiplayer"),this.multiplayerManager}handleResume(){console.log("â–¶ï¸ Jogo resumido - Contexto Multiplayer"),this.multiplayerManager}handleChunkChanged(e){console.log("ðŸ”„ MudanÃ§a de chunk:",e),this.juiceManager&&this.juiceManager.flashColor(this.cameras.main,65535,300),this.uiManager&&this.uiManager.updateChunkInfo(e)}handleElementDestroyed(e){console.log("ðŸ’¥ Elemento destruÃ­do:",e),this.juiceManager&&this.juiceManager.screenShake(200,5),this.particleEffects&&this.particleEffects.createExplosion(e.x,e.y,e.type),this.audioManager&&this.audioManager.playSound("explosion")}destroy(){console.log("ðŸ§¹ Destruindo MultiplayerGameScene..."),this.multiplayerManager&&this.multiplayerManager.destroy(),this.assetManager&&this.assetManager.cleanup(),this.spriteSheetManager&&this.spriteSheetManager.cleanup(),this.juiceManager,this.particleEffects&&this.particleEffects.destroy(),this.trailEffects&&this.trailEffects.destroy(),this.uiAnimations,this.audioManager&&this.audioManager.destroy(),console.log("âœ… MultiplayerGameScene destruÃ­da")}}export{R as default};
