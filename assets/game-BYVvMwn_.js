const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./solana_nft-86y89O3K.js","./solana-lqo6e836.js","./phaser-Dt4UB6eP.js"])))=>i.map(i=>d[i]);
import{P as h}from"./phaser-CprFsQX7.js";import{t as y,i as T}from"./vercel-Dl3BFvA9.js";import"./phaser-Dt4UB6eP.js";const E="modulepreload",v=function(f,e){return new URL(f,e).href},S={},M=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){let r=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};const n=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),o=l?.nonce||l?.getAttribute("nonce");i=r(t.map(c=>{if(c=v(c,s),c in S)return;S[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(s)for(let m=n.length-1;m>=0;m--){const g=n[m];if(g.href===c&&(!d||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${u}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":E,d||(p.as="script"),p.crossOrigin="",p.href=c,o&&p.setAttribute("nonce",o),document.head.appendChild(p),d)return new Promise((m,g)=>{p.addEventListener("load",m),p.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(n){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=n,window.dispatchEvent(l),!l.defaultPrevented)throw n}return i.then(n=>{for(const l of n||[])l.status==="rejected"&&a(l.reason);return e().catch(a)})};class F{constructor(e){this.scene=e,this.config={screenShake:1,flashEffects:1,particles:1,slowMotion:1,soundEffects:1,enabled:!0},this.shakeState={duration:0,intensity:0,originalX:0,originalY:0}}screenShake(e=200,t=5){if(!this.config.enabled||this.config.screenShake===0)return;const s=this.scene.cameras.main,i=t*this.config.screenShake;s.shake(e,i*.01)}flash(e=100,t=16777215,s=.5){if(!this.config.enabled||this.config.flashEffects===0)return;const i=this.scene.cameras.main,a=s*this.config.flashEffects;i.flash(e,t>>16&255,t>>8&255,t&255,!1,null,a)}slowMotion(e=200,t=.3){if(!this.config.enabled||this.config.slowMotion===0)return;const s=1-(1-t)*this.config.slowMotion;this.scene.time.timeScale=s,this.scene.time.delayedCall(e,()=>{this.scene.time.timeScale=1})}impactEffect(e="medium"){const t={small:{shake:3,flash:80,flashAlpha:.3,slowDuration:0},medium:{shake:6,flash:120,flashAlpha:.5,slowDuration:100},large:{shake:10,flash:200,flashAlpha:.7,slowDuration:200}},s=t[e]||t.medium;this.screenShake(s.flash,s.shake),this.flash(s.flash,16777215,s.flashAlpha),s.slowDuration>0&&this.slowMotion(s.slowDuration,.5)}damageFlash(e,t=100){if(!this.config.enabled)return;const s=e.tintTopLeft;e.setTint(16711680),this.scene.time.delayedCall(t,()=>{e.clearTint(),s!==16777215&&e.setTint(s)})}pulse(e,t=1.2,s=300){this.config.enabled&&(e.scale,this.scene.tweens.add({targets:e,scale:t,duration:s/2,yoyo:!0,ease:"Sine.easeInOut"}))}fadeIn(e=500){this.scene.cameras.main.fadeIn(e,0,0,0)}fadeOut(e=500,t=null){this.scene.cameras.main.fadeOut(e,0,0,0),t&&this.scene.time.delayedCall(e,t)}setConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}}class B{constructor(e){this.scene=e,this.volumes={master:1,music:.6,sfx:.8,ui:.5},this.soundPool=new Map}play(e,t={}){const{volume:s=1,pitchVariation:i=.1,category:a="sfx",loop:n=!1}=t,l=s*this.volumes[a]*this.volumes.master,r=1+(Math.random()*2-1)*i;try{const c=this.scene.sound.add(e,{volume:l,rate:r,loop:n});return c.play(),n||c.once("complete",()=>c.destroy()),c}catch(c){return console.warn(`Erro ao reproduzir som ${e}:`,c),null}}playExplosion(e="medium"){const t={small:{variation:.2,volume:.4},medium:{variation:.15,volume:.6},large:{variation:.1,volume:.8}},s=t[e]||t.medium;this.play("explosion",{volume:s.volume,pitchVariation:s.variation,category:"sfx"})}playShoot(){this.play("bullet",{volume:.3,pitchVariation:.25,category:"sfx"})}playImpact(e=1){this.play("explosion",{volume:.3*e,pitchVariation:.3,category:"sfx"})}playAmbient(e,t=.3){const s=this.play(e,{volume:t,pitchVariation:0,category:"music",loop:!0});return s&&this.soundPool.set(`ambient_${e}`,s),s}stop(e,t=0){const s=this.soundPool.get(e);s&&(t>0?this.scene.tweens.add({targets:s,volume:0,duration:t,onComplete:()=>{s.stop(),s.destroy(),this.soundPool.delete(e)}}):(s.stop(),s.destroy(),this.soundPool.delete(e)))}setVolume(e,t){this.volumes[e]=h.Math.Clamp(t,0,1),this.soundPool.forEach((s,i)=>{i.startsWith(e)&&s.setVolume(t*this.volumes.master)})}setMasterVolume(e){this.volumes.master=h.Math.Clamp(e,0,1),this.scene.sound.volume=this.volumes.master}stopAll(){this.scene.sound.stopAll(),this.soundPool.forEach(e=>e.destroy()),this.soundPool.clear()}destroy(){this.stopAll()}}class b{constructor(e){this.scene=e,this.emitters=new Map,this.createParticleTextures()}createParticleTextures(){if(!this.scene.textures.exists("particle_basic")){const e=this.scene.add.graphics();e.fillStyle(16777215,1),e.fillCircle(4,4,4),e.generateTexture("particle_basic",8,8),e.destroy()}if(!this.scene.textures.exists("particle_spark")){const e=this.scene.add.graphics();e.fillStyle(16777215,1),e.fillRect(0,0,8,2),e.generateTexture("particle_spark",8,2),e.destroy()}if(!this.scene.textures.exists("particle_square")){const e=this.scene.add.graphics();e.fillStyle(16777215,1),e.fillRect(0,0,4,4),e.generateTexture("particle_square",4,4),e.destroy()}}createThrustEffect(e){const t=this.scene.add.particles(0,0,"particle_basic",{speed:{min:50,max:150},scale:{start:.4,end:0},alpha:{start:.8,end:0},lifespan:300,frequency:60,tint:[16737792,16750848,52479],blendMode:"ADD",follow:e,followOffset:{x:0,y:0},emitting:!1});t.setDepth(e.depth-1);const s=`thrust_${Date.now()}`;return this.emitters.set(s,{emitter:t,ship:e}),s}updateThrustEffect(e){const t=this.emitters.get(e);if(!t)return;const{emitter:s,ship:i}=t,a=i.rotation-Math.PI/2,n=20,l=-Math.cos(a)*n,o=-Math.sin(a)*n;s.setPosition(i.x+l,i.y+o),s.setAngle({min:h.Math.RadToDeg(a)+160,max:h.Math.RadToDeg(a)+200})}setThrustEmitting(e,t){const s=this.emitters.get(e);s&&(s.emitter.setVisible(t),s.emitter.emitting=t)}createExplosion(e,t,s="medium"){const i={small:{particleCount:5,speed:{min:50,max:150},scale:{start:.4,end:0},lifespan:300},medium:{particleCount:10,speed:{min:100,max:250},scale:{start:.6,end:0},lifespan:400},large:{particleCount:15,speed:{min:150,max:350},scale:{start:.8,end:0},lifespan:500}},a=i[s]||i.medium,n=this.scene.add.particles(e,t,"particle_basic",{speed:a.speed,scale:a.scale,alpha:{start:1,end:0},lifespan:a.lifespan,tint:[16711680,16737792,16750848,16763904],blendMode:"ADD",quantity:a.particleCount,emitting:!1});n.setDepth(100),n.explode();const l=this.scene.add.particles(e,t,"particle_square",{speed:{min:a.speed.min*.6,max:a.speed.max*.6},scale:{start:.8,end:.2},alpha:{start:1,end:0},lifespan:a.lifespan*1.5,tint:[6710886,8947848,11184810],rotate:{min:0,max:360},quantity:Math.floor(a.particleCount*.5),emitting:!1});l.setDepth(99),l.explode(),this.scene.time.delayedCall(a.lifespan*2,()=>{n.destroy(),l.destroy()})}createImpactSparks(e,t,s=0){const i=this.scene.add.particles(e,t,"particle_spark",{speed:{min:100,max:200},scale:{start:.6,end:0},alpha:{start:1,end:0},lifespan:300,angle:{min:s-45,max:s+45},tint:[16776960,16777215,16750848],blendMode:"ADD",quantity:8,emitting:!1});i.setDepth(101),i.explode(),this.scene.time.delayedCall(600,()=>i.destroy())}createMiningEffect(e,t,s,i){const a=h.Math.Angle.Between(e,t,s,i),n=this.scene.add.particles(e,t,"particle_basic",{speed:150,scale:{start:.5,end:0},alpha:{start:.8,end:0},lifespan:800,angle:{min:h.Math.RadToDeg(a)-15,max:h.Math.RadToDeg(a)+15},tint:[65280,65484,16776960],blendMode:"ADD",frequency:200,quantity:1});n.setDepth(10),this.scene.time.delayedCall(1e3,()=>n.destroy())}createProjectileTrail(e){const t=this.scene.add.particles(0,0,"particle_basic",{speed:10,scale:{start:.2,end:0},alpha:{start:.4,end:0},lifespan:150,frequency:40,tint:[52479],blendMode:"ADD",follow:e,emitting:!0});t.setDepth(e.depth-1);const s=`trail_${Date.now()}_${Math.random()}`;return this.emitters.set(s,{emitter:t,projectile:e}),s}removeEmitter(e){const t=this.emitters.get(e);t&&(t.emitter.destroy(),this.emitters.delete(e))}cleanup(){this.emitters.forEach(e=>e.emitter.destroy()),this.emitters.clear()}}class C{constructor(e){this.scene=e,this.floatingTexts=[]}animateCounter(e,t,s,i=500,a=null){const n={value:t};this.scene.tweens.add({targets:n,value:s,duration:i,ease:"Cubic.easeOut",onUpdate:()=>{const l=a?a(n.value):n.value.toFixed(2);e.setText(l)}})}animateBar(e,t,s,i=300,a="Cubic.easeOut"){e.originalWidth||(e.originalWidth=e.width),this.scene.tweens.add({targets:e,scaleX:s,duration:i,ease:a})}createFloatingText(e,t,s,i={}){const{color:a="#ffffff",fontSize:n="24px",duration:l=1500,distance:o=80,fadeDelay:r=500}=i,c=this.scene.add.text(e,t,s,{fontFamily:"Arial",fontSize:n,color:a,stroke:"#000000",strokeThickness:4,fontStyle:"bold"}).setOrigin(.5).setDepth(1e3);return this.floatingTexts.push(c),this.scene.tweens.add({targets:c,y:t-o,duration:l,ease:"Cubic.easeOut"}),this.scene.tweens.add({targets:c,alpha:0,duration:l-r,delay:r,onComplete:()=>{c.destroy();const d=this.floatingTexts.indexOf(c);d>-1&&this.floatingTexts.splice(d,1)}}),c}showCryptoGain(e,t,s){const i=`+${s.toFixed(2)} ‚¨°`;return this.createFloatingText(e,t,i,{color:"#00ff00",fontSize:"20px",duration:1200,distance:60})}showDamage(e,t,s){const i=`-${Math.round(s)}`;return this.createFloatingText(e,t,i,{color:"#ff0000",fontSize:"28px",duration:1e3,distance:50})}pulse(e,t=1.1,s=300,i=0){return this.scene.tweens.killTweensOf(e),this.scene.tweens.add({targets:e,scale:t,duration:s/2,yoyo:!0,repeat:i,ease:"Sine.easeInOut"})}shakeText(e,t=5,s=200){const i=e.x,a=e.y,n=this.scene.time.addEvent({delay:16,repeat:s/16,callback:()=>{e.x=i+h.Math.Between(-t,t),e.y=a+h.Math.Between(-t,t)},callbackScope:this});this.scene.time.delayedCall(s,()=>{n.remove(),e.x=i,e.y=a})}showAchievement(e,t,s=3e3){const i=this.scene.cameras.main.width/2,a=-150,n=100,l=this.scene.add.container(i,a);l.setDepth(2e3),l.setScrollFactor(0);const o=this.scene.add.rectangle(0,0,400,100,6680,.95);o.setStrokeStyle(2,65484);const r=this.scene.add.text(0,-20,e,{fontFamily:"Arial",fontSize:"24px",color:"#00ffcc",fontStyle:"bold"}).setOrigin(.5),c=this.scene.add.text(0,15,t,{fontFamily:"Arial",fontSize:"16px",color:"#aef7ee"}).setOrigin(.5);return l.add([o,r,c]),this.scene.tweens.add({targets:l,y:n,duration:500,ease:"Back.easeOut"}),this.scene.time.delayedCall(s,()=>{this.scene.tweens.add({targets:l,y:a,alpha:0,duration:400,ease:"Back.easeIn",onComplete:()=>l.destroy()})}),l}glowPulse(e,t="#ff0000"){this.scene.tweens.killTweensOf(e);const s={glowAlpha:0};return this.scene.tweens.add({targets:s,glowAlpha:1,duration:600,yoyo:!0,repeat:-1,ease:"Sine.easeInOut",onUpdate:()=>{e.setShadow(0,0,t,10*s.glowAlpha,!1,!0)}})}removeGlow(e){this.scene.tweens.killTweensOf(e),e.setShadow(0,0,"transparent",0)}cleanup(){this.floatingTexts.forEach(e=>{e&&e.active&&e.destroy()}),this.floatingTexts=[]}}class A{constructor(e){this.scene=e,this.trails=new Map,this.graphics=this.scene.add.graphics(),this.graphics.setDepth(5)}createLineTrail(e,t=8,s=52479,i=.6,a=2){this.trails.set(e,{type:"line",points:[],maxPoints:t,color:s,alpha:i,width:a})}updateLineTrail(e,t,s){const i=this.trails.get(e);!i||i.type!=="line"||(i.points.push({x:t,y:s}),i.points.length>i.maxPoints&&i.points.shift())}renderLineTrails(){this.graphics.clear(),this.trails.forEach((e,t)=>{if(!(e.type!=="line"||e.points.length<2))for(let s=0;s<e.points.length-1;s++){const i=e.points[s],a=e.points[s+1],n=s/e.points.length,l=e.alpha*n;this.graphics.lineStyle(e.width,e.color,l),this.graphics.lineBetween(i.x,i.y,a.x,a.y)}})}createSpriteTrail(e,t={}){const{frequency:s=50,lifespan:i=300,alphaStart:a=.6,alphaEnd:n=0,tint:l=null,scaleStart:o=1,scaleEnd:r=.8}=t,c=this.scene.time.addEvent({delay:s,callback:()=>{const u=this.scene.add.sprite(e.x,e.y,e.texture.key,e.frame.name);u.setRotation(e.rotation),u.setScale(e.scaleX*o,e.scaleY*o),u.setAlpha(a),u.setDepth(e.depth-1),l!==null&&u.setTint(l),this.scene.tweens.add({targets:u,alpha:n,scaleX:e.scaleX*r,scaleY:e.scaleY*r,duration:i,ease:"Linear",onComplete:()=>u.destroy()})},loop:!0}),d=`sprite_trail_${Date.now()}_${Math.random()}`;return this.trails.set(d,{type:"sprite",timer:c,sprite:e}),d}removeSpriteTrail(e){const t=this.trails.get(e);!t||t.type!=="sprite"||(t.timer.remove(),this.trails.delete(e))}createMotionBlur(e,t=3){const s=`blur_${Date.now()}_${Math.random()}`,i=[],a=t,n=()=>{i.push({x:e.x,y:e.y,rotation:e.rotation}),i.length>a&&i.shift(),i.forEach((l,o)=>{const r=o/a*.3,c=this.scene.add.sprite(l.x,l.y,e.texture.key,e.frame.name);c.setRotation(l.rotation),c.setAlpha(r),c.setDepth(e.depth-1),this.scene.time.delayedCall(50,()=>c.destroy())})};return this.trails.set(s,{type:"blur",updateCallback:n}),s}removeLineTrail(e){this.trails.delete(e)}removeTrail(e){const t=this.trails.get(e);t&&(t.type==="sprite"&&t.timer&&t.timer.remove(),this.trails.delete(e))}cleanup(){this.trails.forEach((e,t)=>{e.type==="sprite"&&e.timer&&e.timer.remove()}),this.trails.clear(),this.graphics.clear()}}class O extends h.Scene{constructor(){super("GameScene"),this.debugExplosionMarkers=!0,this.activeExplosions=[],this.enemiesGroup=null,this.isThrusting=!1,this.isGameOver=!1,this.cryptoBalance=0,this.miningRate=0,this.miningPlanets=[],this.enemies=[],this.playerName="Pilot",this.playerNameText=null,this.shipMaxHealth=100,this.shipHealth=100,this.shipSpeed=.1,this.shipMaxSpeed=500,this.shipAcceleration=800,this.shipMaxFuel=100,this.shipFuel=this.shipMaxFuel,this.fuelConsumptionRate=20,this.fuelRechargeRate=10,this.fuelDepleted=!1,this.shipMaxOxygen=100,this.shipOxygen=100,this.shipCargoCapacity=50,this.currentCargo=0,this.oxygenConsumptionRate=1,this.shipMetadata=null,this.cullRadius=1200,this.lastCleanup=0,this.cleanupInterval=3e4,this.juiceManager=null,this.audioManager=null,this.particleEffects=null,this.uiAnimations=null,this.trailEffects=null,this.thrustEmitterId=null}preload(){this.load.setPath(""),this.load.json("defaultShipMetadata","src/assets/default_ship_metadata.json"),this.load.atlas("ship","/assets/images/01.png","/assets/images/01.json"),this.load.image("ship_idle","/assets/images/idle.png"),this.load.atlas("rocket","/assets/images/rocket.png","/assets/images/rocket.json"),this.load.atlas("minibullet","/assets/images/minibullet.png","/assets/images/minibullet.json"),this.load.atlas("enemy","/assets/images/02.png","/assets/images/02.json"),this.load.atlas("meteoro","/assets/images/meteoro.png","/assets/images/meteoro.json"),console.log("Carregando textura de explos√£o..."),this.load.atlas("explosion","/assets/images/explosion.png","/assets/images/explosion.json"),this.load.atlas("planets","/assets/background/planets.png","/assets/background/planets.json"),this.load.audio("rocket","/assets/sounds_effects/rocket.mp3"),this.load.audio("explosion","/assets/sounds_effects/explosion.mp3"),this.load.audio("bullet","/assets/sounds_effects/bullet.mp3"),this.load.on("filecomplete",function(e,t,s){console.log("Asset carregado:",e,t)}),this.load.on("loaderror",function(e){console.error("Erro ao carregar asset:",e.src)})}async create(e){if(y("game_scene_loaded",{player_name:e?.playerName||"Unknown",has_wallet:!!e?.walletAddress,has_nft:!!e?.nftImage}),this.juiceManager=new F(this),this.audioManager=new B(this),this.particleEffects=new b(this),this.uiAnimations=new C(this),this.trailEffects=new A(this),this.juiceManager.fadeIn(800),e&&e.playerName&&(this.playerName=e.playerName),this.connectedWallet=e&&e.walletAddress?e.walletAddress:null,this.loadDefaultShipCharacteristics(),this.game.config.width,this.game.config.height,this.physics.world.setBounds(-2e3,-2e3,4e3,4e3),this.rocketSound=this.sound.add("rocket",{loop:!0,volume:.5}),this.isRocketPlaying=!1,this.createBackground(),this.createMiningPlanets(),this.anims.create({key:"ship_thrust",frames:this.anims.generateFrameNames("ship",{prefix:"01 ",start:0,end:1,suffix:".aseprite"}),frameRate:10,repeat:-1}),this.anims.create({key:"ship_idle",frames:[{key:"ship_idle"}],frameRate:1,repeat:0}),this.anims.create({key:"enemy_thrust",frames:this.anims.generateFrameNames("enemy",{prefix:"02 ",start:0,end:1,suffix:".aseprite"}),frameRate:10,repeat:-1}),this.anims.create({key:"explosion_anim",frames:this.anims.generateFrameNames("explosion",{prefix:"explosion ",start:0,end:15,suffix:".aseprite",zeroPad:0}),frameRate:15,repeat:0}),this.anims.create({key:"meteoro_anim",frames:[{key:"meteoro",frame:"meteoro 0.aseprite"},{key:"meteoro",frame:"meteoro 1.aseprite"}],frameRate:8,repeat:-1}),this.ship=this.physics.add.sprite(0,0,"ship_idle"),this.ship.play("ship_idle"),this.connectedWallet)try{const{findFirstNftImageForOwner:s,findFirstNftMetadataForOwner:i}=await M(async()=>{const{findFirstNftImageForOwner:l,findFirstNftMetadataForOwner:o}=await import("./solana_nft-86y89O3K.js");return{findFirstNftImageForOwner:l,findFirstNftMetadataForOwner:o}},__vite__mapDeps([0,1,2]),import.meta.url),[a,n]=await Promise.all([s(this.connectedWallet,{network:"devnet"}),i(this.connectedWallet,{network:"devnet"})]);a?(console.log("Found NFT image for wallet",this.connectedWallet,a),n&&n.attributes&&this.applyNFTCharacteristics(n),this.load.image("nft_ship",a),this.load.once("complete",()=>{try{const l=this.textures.get("nft_ship");if(l&&l.source&&l.source[0]){this.ship.setTexture("nft_ship");const o=.6,r=this.ship.displayWidth,c=this.ship.displayHeight;Math.max(r,c)>256&&this.ship.setScale(o)}}catch(l){console.warn("Failed to apply NFT texture",l)}}),this.load.start()):(console.log("No NFT image found for wallet",this.connectedWallet),console.log("Using default ship characteristics from JSON"))}catch(s){console.error("Error while loading NFT image for wallet",this.connectedWallet,s),console.log("Using default ship characteristics from JSON")}else console.log("No wallet connected, using default ship characteristics from JSON");this.ship.body.setCircle(Math.max(this.ship.width,this.ship.height)/2*.6),this.ship.body.setOffset(this.ship.width*.5-Math.max(this.ship.width,this.ship.height)/2*.6,this.ship.height*.5-Math.max(this.ship.width,this.ship.height)/2*.6),this.thrustEmitterId=this.particleEffects.createThrustEffect(this.ship),this.playerNameText=this.add.text(this.ship.x,this.ship.y+40,this.playerName,{fontFamily:"Arial",fontSize:"16px",color:"#ffffff",align:"center"}).setOrigin(.5).setDepth(5),this.createEnemies();let t=this.textures.exists("explosion")?this.textures.get("explosion").getFrameNames().filter(s=>s!=="__BASE"):[];if(t=t.sort((s,i)=>{const a=s.match(/(\d+)/g),n=i.match(/(\d+)/g),l=a?parseInt(a[a.length-1],10):0,o=n?parseInt(n[n.length-1],10):0;return l-o}),console.log("DEBUG: create() explosion frames (sorted):",t),this.explosionFrameNames=t,t.length>0){const s=t.map(i=>({key:"explosion",frame:i}));this.anims.exists("explosion_anim")&&this.anims.remove("explosion_anim"),this.anims.create({key:"explosion_anim",frames:s,frameRate:15,repeat:0}),console.log("DEBUG: explosion_anim created with",s.length,"frames")}else console.warn("WARN: nenhum frame de explosao encontrado no atlas `explosion`.");this.ship.setMaxVelocity(300),this.ship.setCollideWorldBounds(!1),this.cameras.main.startFollow(this.ship),this.createCrosshair(),this.cameras.main.setZoom(1),this.cameras.main.setViewport(0,0,this.game.config.width,this.game.config.height),this.createUI(),this.setupMining(),this.cursors=this.input.keyboard.createCursorKeys(),this.spaceKey=this.input.keyboard.addKey(h.Input.Keyboard.KeyCodes.SPACE),this.testExplosionKey=this.input.keyboard.addKey(h.Input.Keyboard.KeyCodes.E),this.projectiles=this.physics.add.group(),this.meteorsGroup=this.physics.add.group(),this.setupCollisions(),this.createMeteors(),this.input.on("pointerdown",s=>{s.leftButtonDown()&&this.fireProjectile()})}createMeteors(){this.meteorSpawnTimer=this.time.addEvent({delay:8e3,callback:()=>{(this.meteorsGroup?this.meteorsGroup.getLength():0)<3&&this.spawnMeteor()},callbackScope:this,loop:!0})}spawnMeteor(){const e=this.cameras&&this.cameras.main?this.cameras.main:null;let t,s;if(e){const r=e.width/2/e.zoom,c=e.height/2/e.zoom,d=e.scrollX+r,u=e.scrollY+c,p=h.Math.Between(0,3),m=120;p===0?(t=d-r-m,s=h.Math.Between(u-c,u+c)):p===1?(t=d+r+m,s=h.Math.Between(u-c,u+c)):p===2?(t=h.Math.Between(d-r,d+r),s=u-c-m):(t=h.Math.Between(d-r,d+r),s=u+c+m)}else{const p=h.Math.Between(0,3);p===0?(t=-2100,s=h.Math.Between(-2e3,2e3)):p===1?(t=2100,s=h.Math.Between(-2e3,2e3)):p===2?(t=h.Math.Between(-2e3,2e3),s=-2100):(t=h.Math.Between(-2e3,2e3),s=2100)}const i=this.physics.add.sprite(t,s,"meteoro","meteoro 0.aseprite");if(i.setScale(h.Math.FloatBetween(.5,.8)),i.setDepth(1),i.setOrigin(.5),i.body.setAllowGravity(!1),i.setCollideWorldBounds(!1),i.body.setDrag(0),i.body.setMaxVelocity(1e3),i.body){const r=Math.max(i.displayWidth,i.displayHeight)*.45;i.body.setCircle(r),i.body.setOffset((i.displayWidth-r)/2,(i.displayHeight-r)/2)}i.health=30;let a,n;this.ship&&h.Math.Between(0,100)<40?(a=this.ship.x+h.Math.Between(-200,200),n=this.ship.y+h.Math.Between(-200,200)):(a=h.Math.Between(-600,600),n=h.Math.Between(-600,600));const l=h.Math.Angle.Between(i.x,i.y,a,n),o=h.Math.Between(120,280);i.vx=Math.cos(l)*o,i.vy=Math.sin(l)*o,i.moveAngle=l,i.setVelocity(i.vx,i.vy),i.rotation=l,i.play("meteoro_anim"),this.trailEffects&&(i.trailId=this.trailEffects.createLineTrail(`meteor_${Date.now()}_${Math.random()}`,15,16737792,.4,2)),this.meteorsGroup.add(i),console.log("Spawned meteor at",t,s,"moving towards",a,n,"speed:",o),this.meteors&&Array.isArray(this.meteors)?this.meteors.push(i):this.meteors=[i],this.time.delayedCall(25e3,()=>{i&&i.active&&(i.trailId&&this.trailEffects&&this.trailEffects.removeTrail(i.trailId),i.destroy())})}cullEntities(){if(!this.ship)return;const e=this.ship.x,t=this.ship.y,s=this.cullRadius,i=s*s;this.meteorsGroup&&this.meteorsGroup.getChildren().forEach(a=>{if(!a)return;const n=a.x-e,l=a.y-t,o=n*n+l*l,r=o<=i;a.setVisible(r),r&&a.trailId&&this.trailEffects&&this.trailEffects.updateLineTrail(a.trailId,a.x,a.y),o>s*2*(s*2)&&(a.trailId&&this.trailEffects&&this.trailEffects.removeTrail(a.trailId),a.destroy())}),this.enemies&&this.enemies.length&&this.enemies.forEach(a=>{if(!a)return;const n=a.x-e,l=a.y-t,o=n*n+l*l<=i;a.setVisible(o),a.body&&(a.body.enable=o),a.active=o,o?a.anims&&!a.anims.isPlaying&&a.play("enemy_thrust",!0):a.anims&&a.anims.isPlaying&&a.anims.pause()}),this.miningPlanets&&this.miningPlanets.length&&this.miningPlanets.forEach(a=>{if(!a)return;const n=a.x-e,l=a.y-t,o=n*n+l*l<=i;a.setVisible(o)})}createBackground(){this.add.rectangle(0,0,4e3,4e3,0).setOrigin(0).setDepth(-10),this.distantStars=this.add.group();for(let e=0;e<30;e++){const t=h.Math.Between(-2e3,2e3),s=h.Math.Between(-2e3,2e3),i=this.add.rectangle(t,s,1,1,16777215);i.setDepth(-9),this.distantStars.add(i)}this.brightStars=this.add.group();for(let e=0;e<8;e++){const t=h.Math.Between(-2e3,2e3),s=h.Math.Between(-2e3,2e3),i=this.add.rectangle(t,s,2,2,16777215);i.setDepth(-8),this.brightStars.add(i)}}createMiningPlanets(){const e=this.textures.exists("planets")?this.textures.get("planets").getFrameNames():null;console.log("DEBUG: planets atlas exists?",this.textures.exists("planets")),console.log("DEBUG: planets frameNames:",e);for(let t=0;t<8;t++){const s=h.Math.Between(-1500,1500),i=h.Math.Between(-1500,1500);let a=null;if(e&&e.length>0){const l=e.filter(o=>o!=="__BASE");a=h.Utils.Array.GetRandom(l)}const n=a?this.add.image(s,i,"planets",a):this.add.image(s,i,"planets");console.log(`DEBUG: Created planet at (${s}, ${i}) using frame:`,a),n.setScale(h.Math.FloatBetween(.6,1.2)),n.setDepth(-.5),n.isMiningPlanet=!0,n.miningRate=h.Math.FloatBetween(.1,.5),this.miningPlanets.push(n)}}createEnemies(){this.enemiesGroup||(this.enemiesGroup=this.physics.add.group());for(let e=0;e<2;e++)this.spawnSingleEnemy();this.enemySpawnTimer=this.time.addEvent({delay:25e3,callback:()=>{this.enemies.length<3&&this.spawnSingleEnemy()},callbackScope:this,loop:!0})}spawnSingleEnemy(){let e,t;if(this.ship){const r=h.Math.FloatBetween(0,Math.PI*2);e=this.ship.x+Math.cos(r)*800,t=this.ship.y+Math.sin(r)*800}else e=h.Math.Between(-1500,1500),t=h.Math.Between(-1500,1500);const s=this.physics.add.sprite(e,t,"enemy");s.setScale(h.Math.FloatBetween(.4,.6)),s.setDepth(1),s.play("enemy_thrust");const i=h.Math.Between(150,250);s.health=i,s.maxHealth=i,s.speed=h.Math.FloatBetween(40,120);const a=40,n=5;s.healthBarBg=this.add.rectangle(s.x,s.y+30,a,n,0).setOrigin(.5).setDepth(2),s.healthBar=this.add.rectangle(s.x,s.y+30,a,n,65280).setOrigin(.5).setDepth(3);const l=this.time.addEvent({delay:h.Math.Between(1500,4e3),callback:()=>{if(!s||!s.active||!s.body||typeof s.setVelocity!="function")return;let o;this.ship&&h.Math.Between(0,100)<30?(o=h.Math.Angle.Between(s.x,s.y,this.ship.x,this.ship.y),o+=h.Math.FloatBetween(-.5,.5)):o=h.Math.FloatBetween(0,Math.PI*2),s.setVelocity(Math.cos(o)*s.speed,Math.sin(o)*s.speed)},callbackScope:this,loop:!0});s._movementTimer=l,this.enemies.push(s),this.enemiesGroup.add(s),console.log(`Spawned enemy at (${e}, ${t}). Total enemies: ${this.enemies.length}`)}setupCollisions(){this.enemiesGroup||(this.enemiesGroup=this.physics.add.group()),this.physics.add.overlap(this.projectiles,this.enemiesGroup,this.hitEnemy,null,this),this.meteorsGroup||(this.meteorsGroup=this.physics.add.group()),this.physics.add.overlap(this.projectiles,this.meteorsGroup,this.hitMeteor,null,this),this.physics.add.overlap(this.ship,this.meteorsGroup,this.shipHitByMeteor,null,this),this.physics.add.overlap(this.ship,this.enemiesGroup,this.shipHitByEnemy,null,this),this.physics.add.collider(this.ship,this.enemiesGroup,this.shipHitByEnemy,null,this)}hitEnemy(e,t){const i=h.Math.Angle.Between(e.x,e.y,t.x,t.y);this.particleEffects.createImpactSparks(e.x,e.y,h.Math.RadToDeg(i)+180),this.juiceManager.damageFlash(t,100),this.juiceManager.screenShake(80,3),this.audioManager.playImpact(.6),this.uiAnimations.createFloatingText(t.x+h.Math.Between(-20,20),t.y-20,"-35",{color:"#ff4444",fontSize:"18px",duration:1e3,distance:40,fadeDelay:300}),e.destroy(),t.health-=35;const a=Math.max(0,t.health/t.maxHealth);if(this.uiAnimations.animateBar(t.healthBar,t.healthBar.scaleX,a,200),a<.3?t.healthBar.setFillStyle(16711680):a<.6&&t.healthBar.setFillStyle(16737792),t.health<=0){this.juiceManager.impactEffect("large"),this.uiAnimations.createFloatingText(t.x,t.y-30,"DESTROYED!",{color:"#00ff00",fontSize:"24px",duration:1500,distance:60,fadeDelay:500}),this.createExplosion(t.x,t.y),this.particleEffects.createExplosion(t.x,t.y,"medium"),this.audioManager.playExplosion("medium"),t._movementTimer&&t._movementTimer.remove(!1),t.healthBar&&t.healthBar.destroy(),t.healthBarBg&&t.healthBarBg.destroy();const n=this.enemies.indexOf(t);n>-1&&this.enemies.splice(n,1),t.destroy()}}shipHitByEnemy(e,t){if(this.isGameOver)return;this.juiceManager.damageFlash(e,150),this.juiceManager.screenShake(200,8),this.juiceManager.flash(150,16711680,.4),this.uiAnimations.showDamage(e.x,e.y-30,25),this.shipHealth-=25,this.updateUI(),this.createExplosion(e.x,e.y),this.particleEffects.createExplosion(e.x,e.y,"medium"),this.audioManager.playExplosion("large"),t._movementTimer&&t._movementTimer.remove(!1),t.healthBar&&t.healthBar.destroy(),t.healthBarBg&&t.healthBarBg.destroy();const s=this.enemies.indexOf(t);s>-1&&this.enemies.splice(s,1),t.destroy(),this.shipHealth<=0&&this.gameOver()}hitMeteor(e,t){const s=h.Math.Angle.Between(e.x,e.y,t.x,t.y);this.particleEffects.createImpactSparks(e.x,e.y,h.Math.RadToDeg(s)+180),this.juiceManager.screenShake(60,2),e.destroy(),t.health-=15,t.health<=0?(this.createExplosion(t.x,t.y),this.particleEffects.createExplosion(t.x,t.y,"small"),this.audioManager.playExplosion("small"),this.juiceManager.impactEffect("small"),t.destroy()):this.audioManager.playImpact(.4)}shipHitByMeteor(e,t){this.isGameOver||(this.juiceManager.damageFlash(e,120),this.juiceManager.screenShake(150,5),this.juiceManager.flash(120,16737792,.3),this.uiAnimations.showDamage(e.x,e.y-30,10),this.shipHealth-=10,this.updateUI(),this.createExplosion(t.x,t.y),this.particleEffects.createExplosion(t.x,t.y,"small"),this.audioManager.playExplosion("small"),t.destroy(),this.shipHealth<=0&&this.gameOver())}createExplosion(e,t){const s=this.add.sprite(e,t,"explosion");s.setDepth(100),s.play("explosion_anim"),s.once("animationcomplete",()=>{s.destroy()})}gameOver(e=""){console.log("Game Over",e?`- ${e}`:""),!this.isGameOver&&(this.isGameOver=!0,y("game_over",{player_name:this.playerName,reason:e||"unknown",final_score:this.score||0,final_level:this.level||1,enemies_killed:this.enemiesKilled||0,crypto_mined:this.cryptoMined||0}),this.ship&&this.ship.body&&(this.ship.body.enable=!1),this.juiceManager.slowMotion(1e3,.2),this.particleEffects.createExplosion(this.ship.x,this.ship.y,"large"),this.audioManager.playExplosion("large"),this.time.delayedCall(500,()=>{this.ship&&this.ship.setVisible(!1)}),this.tweens.add({targets:this.cameras.main,zoom:.5,duration:1e3,ease:"Cubic.easeIn"}),this.time.delayedCall(1500,()=>{this.showGameOverScreen(e)}))}showGameOverScreen(e=""){this.sound.stopAll();const t=this.add.rectangle(this.cameras.main.scrollX+this.cameras.main.width/2,this.cameras.main.scrollY+this.cameras.main.height/2,this.cameras.main.width*3,this.cameras.main.height*3,0,.9).setScrollFactor(0).setDepth(200),s=this.cameras.main.width/2,i=this.cameras.main.height/2,a=700,n=550,l=this.add.rectangle(s,i,a,n,657935,.98).setScrollFactor(0).setDepth(201),o=this.add.rectangle(s,i,a,n,16711680,0).setScrollFactor(0).setDepth(201).setStrokeStyle(5,16711680,1);this.add.rectangle(s,i,a-10,n-10,16711680,0).setScrollFactor(0).setDepth(201).setStrokeStyle(2,16711680,.6);const r=this.add.text(s,i-180,"GAME OVER",{fontFamily:"Arial",fontSize:"80px",color:"#ff0000",fontStyle:"bold",stroke:"#000000",strokeThickness:6}).setOrigin(.5).setScrollFactor(0).setDepth(202);e&&this.add.text(s,i-120,e,{fontFamily:"Arial",fontSize:"24px",color:"#ffaa00",fontStyle:"bold"}).setOrigin(.5).setScrollFactor(0).setDepth(202),this.tweens.add({targets:r,scale:{from:1,to:1.08},duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"});const c=i-60;this.add.text(s,c,"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ STATISTICS ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ",{fontFamily:"Arial",fontSize:"26px",color:"#00d4ff",fontStyle:"bold"}).setOrigin(.5).setScrollFactor(0).setDepth(202),this.add.text(s,c+60,`üí∞ Crypto Mined: ${this.cryptoBalance.toFixed(2)}`,{fontFamily:"Arial",fontSize:"32px",color:"#00ff88",fontStyle:"bold"}).setOrigin(.5).setScrollFactor(0).setDepth(202),this.add.text(s,c+110,`üë§ Pilot: ${this.playerName}`,{fontFamily:"Arial",fontSize:"26px",color:"#ffffff"}).setOrigin(.5).setScrollFactor(0).setDepth(202);const d=this.add.rectangle(s,i+150,400,80,65280,.3).setScrollFactor(0).setDepth(202).setInteractive({useHandCursor:!0}).setStrokeStyle(4,65280,1),u=this.add.text(s,i+150,"üîÑ PLAY AGAIN",{fontFamily:"Arial",fontSize:"30px",color:"#00ff00",fontStyle:"bold"}).setOrigin(.5).setScrollFactor(0).setDepth(203),p=this.add.rectangle(s,i+245,400,70,54527,.3).setScrollFactor(0).setDepth(202).setInteractive({useHandCursor:!0}).setStrokeStyle(3,54527,.8),m=this.add.text(s,i+245,"üè† BACK TO MENU",{fontFamily:"Arial",fontSize:"26px",color:"#00d4ff",fontStyle:"bold"}).setOrigin(.5).setScrollFactor(0).setDepth(203);d.on("pointerover",()=>{d.setFillStyle(65280,.6),u.setScale(1.1),this.tweens.add({targets:d,scaleX:1.05,scaleY:1.05,duration:200,ease:"Back.easeOut"})}),d.on("pointerout",()=>{d.setFillStyle(65280,.3),u.setScale(1),this.tweens.add({targets:d,scaleX:1,scaleY:1,duration:200})}),p.on("pointerover",()=>{p.setFillStyle(54527,.6),m.setScale(1.1),this.tweens.add({targets:p,scaleX:1.05,scaleY:1.05,duration:200,ease:"Back.easeOut"})}),p.on("pointerout",()=>{p.setFillStyle(54527,.3),m.setScale(1),this.tweens.add({targets:p,scaleX:1,scaleY:1,duration:200})}),d.on("pointerdown",()=>{y("game_restarted",{player_name:this.playerName,final_score:this.score||0,final_level:this.level||1}),d.setScale(.95),this.time.delayedCall(100,()=>{this.juiceManager.fadeOut(500,()=>{this.isGameOver=!1,this.scene.restart({playerName:this.playerName})})})}),p.on("pointerdown",()=>{y("return_to_menu",{player_name:this.playerName,final_score:this.score||0,final_level:this.level||1}),p.setScale(.95),this.time.delayedCall(100,()=>{this.juiceManager.fadeOut(500,()=>{const g=document.getElementById("game-launch");g&&(g.style.display="none"),this.scene.stop()})})}),t.setAlpha(0),l.setScale(.3),o.setScale(.3),r.setScale(0),this.tweens.add({targets:t,alpha:.9,duration:600,ease:"Power2"}),this.tweens.add({targets:[l,o],scale:1,duration:600,ease:"Back.easeOut"}),this.tweens.add({targets:r,scale:1,duration:800,delay:300,ease:"Elastic.easeOut"})}createCrosshair(){this.crosshair=this.add.circle(0,0,5,16711680),this.crosshair.setStrokeStyle(2,16777215),this.crosshair.setDepth(10)}createUI(){const e={fontSize:"13px",fill:"#00d4ff",fontFamily:"Arial, sans-serif",fontStyle:"bold"},t={fontSize:"20px",fill:"#ffffff",fontFamily:"Arial, sans-serif",fontStyle:"bold"},s=16,i=16,a=320,n=18,l=320;this.uiPanel=this.add.rectangle(s,i,a,l,657935,.85).setOrigin(0,0).setScrollFactor(0).setDepth(18),this.uiPanelBorder=this.add.rectangle(s,i,a,l,54527,0).setOrigin(0,0).setScrollFactor(0).setDepth(18).setStrokeStyle(2,54527,.8),this.uiPanelInnerBorder=this.add.rectangle(s+3,i+3,a-6,l-6,54527,0).setOrigin(0,0).setScrollFactor(0).setDepth(18).setStrokeStyle(1,54527,.3);let o=i+n;const r=s+n,c=a-n*2;this.add.text(r,o,"üí∞ CRYPTO",e).setScrollFactor(0).setDepth(20),o+=20,this.cryptoText=this.add.text(r,o,"0.00",{...t,fill:"#00ff88",fontSize:"22px"}).setScrollFactor(0).setDepth(20),o+=32,this.add.text(r,o,"‚ù§Ô∏è HEALTH",e).setScrollFactor(0).setDepth(20),o+=20;const d=20;this.healthBarBg=this.add.rectangle(r,o,c,d,2228224,.9).setOrigin(0,0).setScrollFactor(0).setDepth(19).setStrokeStyle(1,6684672,.6),this.healthBar=this.add.rectangle(r+1,o+1,c-2,d-2,16711680,1).setOrigin(0,0).setScrollFactor(0).setDepth(20),this.healthText=this.add.text(r+c/2,o+d/2,"100/100",{fontSize:"13px",fill:"#ffffff",fontFamily:"Arial, sans-serif",fontStyle:"bold"}).setOrigin(.5,.5).setScrollFactor(0).setDepth(21),o+=d+16,this.add.text(r,o,"‚ö° FUEL",e).setScrollFactor(0).setDepth(20),o+=20;const u=18;this.fuelBarBg=this.add.rectangle(r,o,c,u,6690,.9).setOrigin(0,0).setScrollFactor(0).setDepth(19).setStrokeStyle(1,17510,.6),this.fuelBar=this.add.rectangle(r+1,o+1,c-2,u-2,43775,1).setOrigin(0,0).setScrollFactor(0).setDepth(20),this.fuelText=this.add.text(r+c/2,o+u/2,"100/100",{fontSize:"12px",fill:"#ffffff",fontFamily:"Arial, sans-serif",fontStyle:"bold"}).setOrigin(.5,.5).setScrollFactor(0).setDepth(21),o+=u+16,this.add.text(r,o,"ü´Å OXYGEN",e).setScrollFactor(0).setDepth(20),o+=20;const p=18;this.oxygenBarBg=this.add.rectangle(r,o,c,p,4386,.9).setOrigin(0,0).setScrollFactor(0).setDepth(19).setStrokeStyle(1,17510,.6),this.oxygenBar=this.add.rectangle(r+1,o+1,c-2,p-2,52479,1).setOrigin(0,0).setScrollFactor(0).setDepth(20),this.oxygenText=this.add.text(r+c/2,o+p/2,"100/100",{fontSize:"12px",fill:"#ffffff",fontFamily:"Arial, sans-serif",fontStyle:"bold"}).setOrigin(.5,.5).setScrollFactor(0).setDepth(21),o+=p+16,this.add.text(r,o,"üì¶ CARGO",e).setScrollFactor(0).setDepth(20),o+=20,this.cargoText=this.add.text(r,o,"0/50 kg",{fontSize:"16px",fill:"#ffaa00",fontFamily:"Arial, sans-serif",fontStyle:"bold"}).setScrollFactor(0).setDepth(20),o+=25,this.speedText=this.add.text(r,o,"üöÄ SPEED: 0 km/h",{fontSize:"13px",fill:"#55aaff",fontFamily:"Arial, sans-serif",fontStyle:"bold"}).setScrollFactor(0).setDepth(20),o+=20,this.rarityText=this.add.text(r,o,"",{fontSize:"12px",fill:"#cccccc",fontFamily:"Arial, sans-serif",fontStyle:"bold"}).setScrollFactor(0).setDepth(20)}setupMining(){this.miningTimer=this.time.addEvent({delay:1e3,callback:this.mineCrypto,callbackScope:this,loop:!0})}mineCrypto(){if(this.ship&&this.miningPlanets.length>0){let e=0;for(let t of this.miningPlanets){const s=h.Math.Distance.Between(this.ship.x,this.ship.y,t.x,t.y);if(s<200){const i=Math.max(0,(200-s)/200),a=t.miningRate*(1+i);e+=a,this.particleEffects.createMiningEffect(t.x,t.y,this.ship.x,this.ship.y),t.isPulsing||(t.isPulsing=!0,this.uiAnimations.pulse(t,1.05,1e3,-1))}else t.isPulsing&&(t.isPulsing=!1,this.tweens.killTweensOf(t),t.setScale(t.scale))}if(e>0){const t=this.cryptoBalance;this.cryptoBalance+=e,this.cryptoText&&this.uiAnimations.animateCounter(this.cryptoText,t,this.cryptoBalance,500,s=>`${s.toFixed(2)}`),(!this.lastMiningTextTime||Date.now()-this.lastMiningTextTime>3e3)&&(this.uiAnimations.showCryptoGain(this.ship.x,this.ship.y-50,e),this.lastMiningTextTime=Date.now())}}}fireProjectile(){this.juiceManager.screenShake(40,1);const e=this.ship.rotation-Math.PI/2,t=Math.cos(e)*30,s=Math.sin(e)*30,i=this.physics.add.sprite(this.ship.x+t,this.ship.y+s,"minibullet","minibullet 0.aseprite");i.setScale(.6),i.setDepth(1),i.setOrigin(.5,.5),i.body.setAllowGravity(!1),i.setCollideWorldBounds(!1),i.rotation=e;const a=800;i.setVelocity(Math.cos(e)*a,Math.sin(e)*a),this.projectiles.add(i);const n=12;i.speedX=Math.cos(e)*n,i.speedY=Math.sin(e)*n,this.anims.exists("minibullet_anim")||this.anims.create({key:"minibullet_anim",frames:[{key:"minibullet",frame:"minibullet 0.aseprite"},{key:"minibullet",frame:"minibullet 1.aseprite"}],frameRate:12,repeat:-1}),i.play("minibullet_anim");const l=this.particleEffects.createProjectileTrail(i);i._trailId=l,this.audioManager.playShoot(),this.time.delayedCall(3e3,()=>{i&&i.active&&(i._trailId&&this.particleEffects.removeEmitter(i._trailId),i.destroy())})}update(e,t){if(e-this.lastCleanup>this.cleanupInterval&&(this.performMemoryCleanup(),this.lastCleanup=e),!this.lastDebugTime||e-this.lastDebugTime>5e3){const s=this.meteorsGroup?this.meteorsGroup.getLength():0,i=this.enemies?this.enemies.length:0,a=this.projectiles?this.projectiles.getLength():0;console.log(`[PERFORMANCE] Meteoros: ${s}, Inimigos: ${i}, Proj√©teis: ${a}`),this.lastDebugTime=e}if(this.trailEffects&&this.trailEffects.renderLineTrails(),this.cullEntities(),this.testExplosionKey&&h.Input.Keyboard.JustDown(this.testExplosionKey)){const s=this.cameras.main,i=s.scrollX+s.width/2,a=s.scrollY+s.height/2;if(console.log("DEBUG: test explosion spawn at",i,a),this.textures.exists("explosion")){const n=this.textures.get("explosion").getFrameNames().filter(r=>r!=="__BASE");console.log("DEBUG: explosion frames for test:",n);const l=this.explosionFrameNames&&this.explosionFrameNames.length?this.explosionFrameNames[0]:n[0],o=l?this.add.sprite(i,a,"explosion",l):this.add.sprite(i,a,"explosion");o.setOrigin(.5,.5),o.setDepth(1e3),this.children.bringToTop(o),this.anims.exists("explosion_anim")?(o.once("animationstart",()=>console.log("DEBUG: test explosion animation started")),o.once("animationcomplete",()=>{console.log("DEBUG: test explosion animation complete - destroying test sprite"),o.destroy()}),o.play("explosion_anim")):console.warn("DEBUG: explosion_anim not found for test")}else console.warn("DEBUG: explosion atlas not found for test")}if(this.projectiles&&this.projectiles.getChildren().forEach(s=>{s.active&&s.speedX!==void 0&&(s.x+=s.speedX,s.y+=s.speedY)}),this.meteorsGroup&&this.meteorsGroup.getChildren().forEach(s=>{s.active&&s.body&&(s.vx!==void 0&&s.vy!==void 0&&Math.abs(s.body.velocity.x)<10&&Math.abs(s.body.velocity.y)<10&&s.setVelocity(s.vx,s.vy),s.body&&(s.body.velocity.x!==0||s.body.velocity.y!==0)&&(s.rotation=h.Math.Angle.Between(s.x-s.body.velocity.x,s.y-s.body.velocity.y,s.x,s.y)+Math.PI/2))}),this.playerNameText&&this.ship&&(this.playerNameText.x=this.ship.x,this.playerNameText.y=this.ship.y+40),this.ship){if(this.distantStars&&this.brightStars){const n=this.cameras.main,l=n.scrollX,o=n.scrollY;this.distantStars.getChildren().forEach(r=>{r.x=r.initialX!==void 0?r.initialX-l*.1:(r.initialX=r.x)-l*.1,r.y=r.initialY!==void 0?r.initialY-o*.1:(r.initialY=r.y)-o*.1}),this.brightStars.getChildren().forEach(r=>{r.x=r.initialX!==void 0?r.initialX-l*.3:(r.initialX=r.x)-l*.3,r.y=r.initialY!==void 0?r.initialY-o*.3:(r.initialY=r.y)-o*.3})}const s=this.input.activePointer.positionToCamera(this.cameras.main);if(this.crosshair&&(this.crosshair.x=s.x,this.crosshair.y=s.y),this.ship.rotation=h.Math.Angle.Between(this.ship.x,this.ship.y,s.x,s.y)+Math.PI/2,this.spaceKey.isDown&&!this.fuelDepleted){this.isThrusting||(this.ship.play("ship_thrust",!0),this.isThrusting=!0,this.thrustEmitterId&&this.particleEffects.setThrustEmitting(this.thrustEmitterId,!0),this.isRocketPlaying||(this.rocketSound.play(),this.isRocketPlaying=!0)),this.thrustEmitterId&&this.particleEffects.updateThrustEffect(this.thrustEmitterId);const n=this.ship.rotation-Math.PI/2,l=Math.cos(n)*this.shipSpeed,o=Math.sin(n)*this.shipSpeed;this.ship.setAcceleration(l*this.shipAcceleration,o*this.shipAcceleration);const r=t/1e3;this.shipFuel-=this.fuelConsumptionRate*r,this.shipFuel<=0&&(this.shipFuel=0,this.fuelDepleted=!0,this.ship.setAcceleration(0),this.ship.play("ship_idle",!0),this.isThrusting=!1,this.isRocketPlaying&&(this.rocketSound.stop(),this.isRocketPlaying=!1))}else{this.isThrusting&&(this.ship.play("ship_idle",!0),this.isThrusting=!1,this.thrustEmitterId&&this.particleEffects.setThrustEmitting(this.thrustEmitterId,!1),this.isRocketPlaying&&(this.rocketSound.stop(),this.isRocketPlaying=!1)),this.ship.setAcceleration(0);const n=t/1e3;this.fuelDepleted?(this.shipFuel=Math.min(this.shipMaxFuel,this.shipFuel+this.fuelRechargeRate/2*n),this.shipFuel>=5&&(this.fuelDepleted=!1)):this.shipFuel=Math.min(this.shipMaxFuel,this.shipFuel+this.fuelRechargeRate*n)}if(this.fuelBar){const n=Math.max(0,this.shipFuel/this.shipMaxFuel);this.fuelBar.setScale(n,1)}this.fuelText&&this.fuelText.setText(`${Math.round(this.shipFuel)}/${this.shipMaxFuel}`);const i=this.ship.body.velocity,a=Math.sqrt(i.x*i.x+i.y*i.y);if(a>this.shipMaxSpeed){const n=this.shipMaxSpeed/a;this.ship.setVelocity(i.x*n,i.y*n)}this.updateEnemies(),this.updateOxygen(t),this.updateUI()}}updateOxygen(e){if(this.isGameOver)return;const t=e/1e3;this.shipOxygen=Math.max(0,this.shipOxygen-this.oxygenConsumptionRate*t),this.shipOxygen<=0&&this.gameOver("Oxig√™nio esgotado!")}updateEnemies(){for(let e=0;e<this.enemies.length;e++){const t=this.enemies[e];t.active&&(t.body&&(t.body.velocity.x!==0||t.body.velocity.y!==0)&&(t.rotation=h.Math.Angle.Between(t.x-t.body.velocity.x,t.y-t.body.velocity.y,t.x,t.y)+Math.PI/2),t.rotation+=.01,t.healthBarBg&&(t.healthBarBg.x=t.x,t.healthBarBg.y=t.y+30),t.healthBar&&(t.healthBar.x=t.x,t.healthBar.y=t.y+30))}}updateUI(){const e=Math.max(0,this.shipHealth/this.shipMaxHealth);this.healthBar.scaleX!==e&&this.uiAnimations.animateBar(this.healthBar,this.healthBar.scaleX,e,250),this.healthText.setText(`${Math.round(this.shipHealth)}/${this.shipMaxHealth}`),e<.3&&!this.healthText._glowing?(this.healthText._glowing=!0,this.uiAnimations.glowPulse(this.healthText,"#ff0000")):e>=.3&&this.healthText._glowing&&(this.healthText._glowing=!1,this.uiAnimations.removeGlow(this.healthText));const t=Math.max(0,this.shipFuel/this.shipMaxFuel);if(Math.abs(this.fuelBar.scaleX-t)>.01&&this.uiAnimations.animateBar(this.fuelBar,this.fuelBar.scaleX,t,200,"Linear"),this.fuelText.setText(`${Math.round(this.shipFuel)}/${this.shipMaxFuel}`),t<.2&&!this.fuelBar._pulsing?(this.fuelBar._pulsing=!0,this.fuelBar.setFillStyle(16737792)):t>=.2&&this.fuelBar._pulsing&&(this.fuelBar._pulsing=!1,this.fuelBar.setFillStyle(43775)),this.oxygenBar&&this.oxygenText){const r=Math.max(0,this.shipOxygen/this.shipMaxOxygen);Math.abs(this.oxygenBar.scaleX-r)>.01&&this.uiAnimations.animateBar(this.oxygenBar,this.oxygenBar.scaleX,r,200,"Linear"),this.oxygenText.setText(`${Math.round(this.shipOxygen)}/${this.shipMaxOxygen}`),r<.25?this.oxygenBar.setFillStyle(16711680):r<.5?this.oxygenBar.setFillStyle(16755200):this.oxygenBar.setFillStyle(52479)}if(this.cargoText){this.cargoText.setText(`${this.currentCargo}/${this.shipCargoCapacity} kg`);const r=this.currentCargo/this.shipCargoCapacity;r>=.9?this.cargoText.setColor("#ff4444"):r>=.7?this.cargoText.setColor("#ffaa00"):this.cargoText.setColor("#ffaa00")}const s=this.ship.body.velocity,i=Math.round(Math.sqrt(s.x*s.x+s.y*s.y));this.speedText.setText(`üöÄ SPEED: ${i}/${this.shipMaxSpeed} km/h`);const a=Math.min(1,i/this.shipMaxSpeed),n=Math.round(85+170*a),l=Math.round(170-170*a);if(this.speedText.setColor(`rgb(${n},${l},255)`),this.rarityText&&this.shipMetadata){const r=this.getAttributeValue(this.shipMetadata.attributes,"Raridade")||"Comum";this.rarityText.setText(`‚≠ê ${r.toUpperCase()}`),this.rarityText.setColor(this.getRarityColor(r))}}shutdown(){this.enemySpawnTimer&&this.enemySpawnTimer.remove(),this.meteorSpawnTimer&&this.meteorSpawnTimer.remove(),this.particleEffects&&this.particleEffects.cleanup(),this.trailEffects&&this.trailEffects.cleanup(),this.uiAnimations&&this.uiAnimations.cleanup(),this.audioManager&&this.audioManager.destroy()}loadDefaultShipCharacteristics(){try{const e=this.cache.json.get("defaultShipMetadata");if(e&&e.gameplay_stats){const t=e.gameplay_stats;this.shipMaxSpeed=t.max_speed||100,this.shipCargoCapacity=t.cargo_capacity||50,this.shipMaxFuel=t.max_fuel||100,this.shipMaxOxygen=t.max_oxygen||100,this.shipMaxHealth=t.max_health||100,this.shipAcceleration=t.acceleration||800,this.fuelConsumptionRate=t.fuel_consumption_rate||20,this.fuelRechargeRate=t.fuel_recharge_rate||10,this.oxygenConsumptionRate=t.oxygen_consumption_rate||1,this.shipFuel=this.shipMaxFuel,this.shipOxygen=this.shipMaxOxygen,this.shipHealth=this.shipMaxHealth,this.currentCargo=0,this.shipMetadata=e,console.log("‚úÖ Caracter√≠sticas da nave carregadas do JSON:",{velocidade:this.shipMaxSpeed,carga:this.shipCargoCapacity,combustivel:this.shipMaxFuel,oxigenio:this.shipMaxOxygen,escudo:this.shipMaxHealth})}else console.warn("‚ö†Ô∏è JSON da nave padr√£o n√£o encontrado ou inv√°lido, usando valores padr√£o")}catch(e){console.error("‚ùå Erro ao carregar caracter√≠sticas da nave:",e),console.log("Usando valores padr√£o do c√≥digo")}}applyNFTCharacteristics(e){try{if(!e||!e.attributes){console.warn("NFT metadata inv√°lida, mantendo caracter√≠sticas padr√£o");return}const t=e.attributes,s=this.getAttributeValue(t,"Velocidade")||this.shipMaxSpeed,i=this.getAttributeValue(t,"Carga")||this.shipCargoCapacity,a=this.getAttributeValue(t,"Combust√≠vel")||this.shipMaxFuel,n=this.getAttributeValue(t,"Oxig√™nio")||this.shipMaxOxygen,l=this.getAttributeValue(t,"Escudo")||this.shipMaxHealth,o=this.getAttributeValue(t,"Raridade")||"Comum";this.shipMaxSpeed=s,this.shipCargoCapacity=i,this.shipMaxFuel=a,this.shipMaxOxygen=n,this.shipMaxHealth=l,this.shipFuel=this.shipMaxFuel,this.shipOxygen=this.shipMaxOxygen,this.shipHealth=this.shipMaxHealth,this.currentCargo=0,this.shipMetadata=e,console.log("‚úÖ Caracter√≠sticas do NFT aplicadas:",{nome:e.name||"NFT Desconhecido",raridade:o,velocidade:s,carga:i,combustivel:a,oxigenio:n,escudo:l}),e.name&&this.playerNameText&&(this.playerNameText.setText(e.name),this.playerNameText.setColor(this.getRarityColor(o)))}catch(t){console.error("‚ùå Erro ao aplicar caracter√≠sticas do NFT:",t),console.log("Mantendo caracter√≠sticas padr√£o da nave")}}getAttributeValue(e,t){if(!e||!Array.isArray(e))return null;const s=e.find(i=>i.trait_type===t||i.trait_type===t.toLowerCase());return s?s.value:null}getRarityColor(e){return{Comum:"#CCCCCC",Incomum:"#00FF00",Raro:"#0080FF",√âpico:"#A020F0",Lend√°rio:"#FFD700"}[e]||"#FFFFFF"}performMemoryCleanup(){console.log("[MEMORY] Performing cleanup..."),this.projectiles&&this.projectiles.getChildren().forEach(e=>{e.active&&e.lifespan&&(e.lifespan-=1e3,e.lifespan<=0&&e.destroy())}),this.meteorsGroup&&this.meteorsGroup.getChildren().forEach(e=>{e.active&&this.ship&&h.Math.Distance.Between(this.ship.x,this.ship.y,e.x,e.y)>this.cullRadius*3&&e.destroy()}),this.enemies&&this.enemies.forEach((e,t)=>{e.active&&this.ship&&h.Math.Distance.Between(this.ship.x,this.ship.y,e.x,e.y)>this.cullRadius*3&&(e.destroy(),this.enemies.splice(t,1))}),window.gc&&window.gc(),console.log("[MEMORY] Cleanup completed")}}class k extends h.Scene{constructor(){super("MenuScene"),this.playerName="",this.menuOptions=["PLAY","CONFIG","CREDITS"],this.selectedOption=0,this.menuTexts=[],this.selectedUnderline=null,this.inputActive=!0}preload(){this.load.image("phantom_logo","/assets/icones/phantom_logo.png"),this.load.image("astronauta","/assets/icones/astronauta.png"),this.load.image("nave1","/assets/icones/nave1.png"),this.load.image("nave2","/assets/icones/nave2.png"),this.load.image("stars","/assets/background/stars.png"),this.load.audio("menu_select","/assets/sounds_effects/bullet.mp3"),this.load.audio("menu_confirm","/assets/sounds_effects/rocket-launch.mp3")}create(){console.log("üé¨ MenuScene create() called"),y("menu_scene_loaded",{screen_width:this.cameras.main.width,screen_height:this.cameras.main.height});const e=this.cameras.main.width,t=this.cameras.main.height;console.log(`üìê Screen size: ${e}x${t}`),this.createAnimatedBackground(e,t),this.createTitle(e,t),this.createPhantomLogo(e,t),this.createDecorations(e,t),this.createMainMenu(e,t),this.createControls(e,t),this.setupInputs(),this.entranceAnimation(),console.log("‚úÖ MenuScene created successfully")}createAnimatedBackground(e,t){this.add.rectangle(0,0,e,t,17).setOrigin(0).setDepth(-10),this.starsBg=this.add.image(e/2,t/2,"stars").setOrigin(.5).setScale(1.2).setDepth(-9),this.starsBg.setAlpha(.3),this.createStarField(e,t),this.nebula=this.add.rectangle(e/2,t/2,e*.8,t*.6,4386),this.nebula.setDepth(-8),this.nebula.setAlpha(.2),this.tweens.add({targets:this.starsBg,x:e/2+50,duration:2e4,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createStarField(e,t){this.stars=this.add.group();for(let s=0;s<100;s++){const i=h.Math.Between(0,e),a=h.Math.Between(0,t),n=h.Math.Between(1,3),l=this.add.rectangle(i,a,n,n,16777215);l.setDepth(-7),l.setAlpha(h.Math.FloatBetween(.3,1)),this.stars.add(l)}for(let s=0;s<30;s++){const i=h.Math.Between(0,e),a=h.Math.Between(0,t),n=this.add.rectangle(i,a,2,2,65535);n.setDepth(-6),n.setAlpha(h.Math.FloatBetween(.5,1)),this.stars.add(n),this.tweens.add({targets:n,alpha:.2,duration:h.Math.Between(1e3,3e3),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}createTitle(e,t){this.title=this.add.text(e/2,t*.25,"SPACE CRYPTO MINER",{fontFamily:"Arial",fontSize:"52px",color:"#00ffcc",stroke:"#001a18",strokeThickness:6,fontStyle:"bold",shadow:{offsetX:0,offsetY:0,color:"#00ffcc",blur:20,stroke:!0,fill:!0}}).setOrigin(.5),this.subtitle=this.add.text(e/2,t*.32,"Mine Crypto in the Stars",{fontFamily:"Arial",fontSize:"20px",color:"#aef7ee",stroke:"#001a18",strokeThickness:3,fontStyle:"italic"}).setOrigin(.5),this.tweens.add({targets:this.title,scaleX:1.08,scaleY:1.08,duration:2500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.tweens.add({targets:this.title,alpha:.8,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createPhantomLogo(e,t){this.phantomLogo=this.add.image(e/2,t*.12,"phantom_logo").setOrigin(.5).setScale(.5).setAlpha(.9),this.tweens.add({targets:this.phantomLogo,y:t*.12+5,duration:3e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createDecorations(e,t){this.astronaut=this.add.image(e*.15,t*.65,"astronauta").setOrigin(.5).setScale(.5).setAlpha(.8),this.ship=this.add.image(e*.85,t*.65,"nave1").setOrigin(.5).setScale(.5).setAlpha(.8),this.tweens.add({targets:[this.astronaut,this.ship],y:"+=15",duration:4e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.tweens.add({targets:this.ship,angle:5,duration:6e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createMainMenu(e,t){const s=t*.5,i=70;this.selectedUnderline=this.add.rectangle(e/2,s+15,120,4,65484),this.selectedUnderline.setDepth(1),this.menuTexts=[],this.menuOptions.forEach((a,n)=>{const l=s+n*i,o=this.add.text(e/2,l,a,{fontFamily:"Arial",fontSize:"32px",color:n===0?"#00ffcc":"#d9ffff",stroke:"#001010",strokeThickness:4,fontStyle:"bold",shadow:{offsetX:2,offsetY:2,color:"#000000",blur:5,stroke:!0,fill:!0}}).setOrigin(.5);this.menuTexts.push(o)}),this.updateUnderlinePosition()}createControls(e,t){this.add.text(e/2,t*.85,"Use ‚Üë‚Üì Arrow Keys or Mouse to Navigate",{fontFamily:"Arial",fontSize:"16px",color:"#888888",stroke:"#000000",strokeThickness:2,fontStyle:"italic"}).setOrigin(.5),this.add.text(e/2,t*.9,"Press ENTER or Click to Select",{fontFamily:"Arial",fontSize:"16px",color:"#888888",stroke:"#000000",strokeThickness:2,fontStyle:"italic"}).setOrigin(.5)}setupInputs(){this.cursors=this.input.keyboard.createCursorKeys(),this.enterKey=this.input.keyboard.addKey(h.Input.Keyboard.KeyCodes.ENTER),this.spaceKey=this.input.keyboard.addKey(h.Input.Keyboard.KeyCodes.SPACE),this.menuTexts.forEach((e,t)=>{e.setInteractive({useHandCursor:!0}),e.on("pointerover",()=>{this.inputActive&&(this.selectedOption=t,this.updateMenuSelection(),this.playSound("menu_select"))}),e.on("pointerdown",()=>{this.inputActive&&this.selectOption(t)})})}entranceAnimation(){this.cameras.main.fadeIn(1500,0,0,0),this.tweens.add({targets:[this.title,this.subtitle],alpha:0,duration:0,onComplete:()=>{this.tweens.add({targets:[this.title,this.subtitle],alpha:1,duration:1200,ease:"Power2"})}}),this.tweens.add({targets:this.menuTexts,alpha:0,duration:0,delay:800,onComplete:()=>{this.tweens.add({targets:this.menuTexts,alpha:1,duration:1e3,ease:"Power2"})}})}update(){this.inputActive&&(h.Input.Keyboard.JustDown(this.cursors.up)?(this.selectedOption=(this.selectedOption-1+this.menuOptions.length)%this.menuOptions.length,this.updateMenuSelection(),this.playSound("menu_select")):h.Input.Keyboard.JustDown(this.cursors.down)&&(this.selectedOption=(this.selectedOption+1)%this.menuOptions.length,this.updateMenuSelection(),this.playSound("menu_select")),(h.Input.Keyboard.JustDown(this.enterKey)||h.Input.Keyboard.JustDown(this.spaceKey))&&this.selectOption(this.selectedOption))}updateMenuSelection(){this.menuTexts.forEach((e,t)=>{e.setStyle({fontFamily:"Arial",fontSize:"32px",color:t===this.selectedOption?"#00ffcc":"#d9ffff",stroke:"#001010",strokeThickness:4,fontStyle:"bold",shadow:{offsetX:2,offsetY:2,color:"#000000",blur:5,stroke:!0,fill:!0}})}),this.updateUnderlinePosition()}updateUnderlinePosition(){if(!this.menuTexts||!this.selectedUnderline)return;const e=this.menuTexts[this.selectedOption];if(!e)return;const t=e.x,s=e.y+15,i=Math.max(100,e.width+30);this.tweens.add({targets:this.selectedUnderline,x:t,y:s,width:i,duration:250,ease:"Power2"})}selectOption(e){this.inputActive=!1,this.playSound("menu_confirm");const t=this.menuOptions[e];y("menu_option_selected",{option:t,option_index:e}),this.menuTexts[e].setStyle({fontFamily:"Arial",fontSize:"36px",color:"#ffffff",stroke:"#001010",strokeThickness:5,fontStyle:"bold",shadow:{offsetX:3,offsetY:3,color:"#00ffcc",blur:10,stroke:!0,fill:!0}}),this.cameras.main.fadeOut(800,0,0,0),this.time.delayedCall(800,()=>{switch(e){case 0:this.startGame();break;case 1:this.openConfig();break;case 2:this.showCredits();break}})}startGame(){const e=window.__GAME_CONFIG__||{playerName:localStorage.getItem("playerName")||"Pilot",walletAddress:null,nftImage:null};y("game_started",{player_name:e.playerName,has_wallet:!!e.walletAddress,has_nft:!!e.nftImage}),this.scene.start("GameScene",e)}openConfig(){const e={playerName:this.playerName};if(window&&window.solana&&window.solana.isPhantom)try{const t=window.solana.publicKey?window.solana.publicKey.toString():null;t&&(e.walletAddress=t)}catch{}this.scene.start("ConfigScene",e)}showCredits(){this.showTemporaryMessage("Credits coming soon!",2e3),this.time.delayedCall(2e3,()=>{this.inputActive=!0,this.cameras.main.fadeIn(500,0,0,0)})}playSound(e){try{this.sound&&this.sound.get(e)&&this.sound.play(e,{volume:.2})}catch{}}showTemporaryMessage(e,t=2e3){this._tempMsg&&this._tempMsg.destroy(),this._tempMsg=this.add.text(this.cameras.main.width/2,this.cameras.main.height/2+200,e,{fontFamily:"Arial",fontSize:"28px",color:"#ff4444",stroke:"#000000",strokeThickness:4,fontStyle:"bold",shadow:{offsetX:2,offsetY:2,color:"#000000",blur:5,stroke:!0,fill:!0}}).setOrigin(.5),this._tempMsg.setAlpha(0),this.tweens.add({targets:this._tempMsg,alpha:1,duration:400,ease:"Power2"}),this.time.delayedCall(t,()=>{this._tempMsg&&this.tweens.add({targets:this._tempMsg,alpha:0,duration:400,ease:"Power2",onComplete:()=>{this._tempMsg.destroy(),this._tempMsg=null}})})}}class _ extends h.Scene{constructor(){super("ConfigScene"),this.playerName="",this.walletAddress=null,this.nftImageUrl=null}preload(){this.load.image("phantom_logo","/assets/icones/phantom_logo.png")}create(e){const t=this.cameras.main.width,s=this.cameras.main.height,i=h.Math.Clamp(t/900,.8,1.2);this.add.rectangle(t/2,s/2,Math.min(t*.9,800),Math.min(s*.85,600),6680,.95).setOrigin(.5),this.add.text(t/2,s*.12,"SETTINGS",{fontFamily:"Arial",fontSize:Math.round(28*i)+"px",color:"#00ffcc"}).setOrigin(.5);const a=s*.22;this.add.text(t*.12,a,"WALLET",{fontFamily:"Arial",fontSize:Math.round(18*i)+"px",color:"#aef7ee"}).setOrigin(0,.5),this.walletText=this.add.text(t*.12,a+40,"No wallet connected",{fontFamily:"Arial",fontSize:Math.round(14*i)+"px",color:"#cfeff0"}).setOrigin(0,0);const n=Math.round(t*.24),l=Math.round(44*i);this.connectBtn=this.add.rectangle(t*.78,a+20,n,l,140840,.98).setOrigin(.5).setInteractive({useHandCursor:!0}).setStrokeStyle(2,65484),this.connectBtnText=this.add.text(this.connectBtn.x,this.connectBtn.y,"CONNECT PHANTOM",{fontFamily:"Arial",fontSize:Math.round(14*i)+"px",color:"#ccfff6"}).setOrigin(.5),this.connectBtn.on("pointerdown",async()=>{if(window&&window.solana&&window.solana.isPhantom)try{if(this.walletAddress){try{await window.solana.disconnect()}catch{}this.walletAddress=null,this.nftImageUrl=null,this.walletText.setText("No wallet connected"),this.connectBtnText.setText("CONNECT PHANTOM"),this.nftPreview&&(this.nftPreview.destroy(),this.nftPreview=null)}else{const r=await window.solana.connect();this.walletAddress=r.publicKey?r.publicKey.toString():window.solana.publicKey&&window.solana.publicKey.toString(),this.connectBtnText.setText("DISCONNECT"),this.walletText.setText(this.walletAddress),await this.fetchAndShowNft()}}catch(r){console.error("Phantom connection error",r),this.showTempMessage("Error connecting/disconnecting wallet")}else this.showTempMessage("PHANTOM NOT FOUND IN BROWSER")});const o=s*.45;this.add.text(t*.12,o,"PLAYER NAME",{fontFamily:"Arial",fontSize:Math.round(18*i)+"px",color:"#aef7ee"}).setOrigin(0,.5),this.nameDisplay=this.add.text(t*.12,o+40,e&&e.playerName?e.playerName:"Click and type...",{fontFamily:"Arial",fontSize:Math.round(16*i)+"px",color:"#66fff0"}).setOrigin(0,0).setInteractive(),this.nameDisplay.on("pointerdown",()=>{this.startNameInput()}),this.saveBtn=this.add.rectangle(t*.4,s*.78,Math.round(160*i),Math.round(52*i),140840,.98).setOrigin(.5).setInteractive({useHandCursor:!0}).setStrokeStyle(2,65484),this.saveText=this.add.text(this.saveBtn.x,this.saveBtn.y,"SAVE",{fontFamily:"Arial",fontSize:Math.round(16*i)+"px",color:"#ccfff6"}).setOrigin(.5),this.saveBtn.on("pointerdown",()=>{this.saveConfig()}),this.disconnectBtn=this.add.rectangle(t*.6,s*.78,Math.round(160*i),Math.round(52*i),3342336,.98).setOrigin(.5).setInteractive({useHandCursor:!0}).setStrokeStyle(2,16737894),this.disconnectText=this.add.text(this.disconnectBtn.x,this.disconnectBtn.y,"DISCONNECT",{fontFamily:"Arial",fontSize:Math.round(14*i)+"px",color:"#ff9999"}).setOrigin(.5),this.disconnectBtn.on("pointerdown",async()=>{if(this.walletAddress&&window&&window.solana&&window.solana.isPhantom)try{await window.solana.disconnect()}catch{}this.walletAddress=null,this.nftImageUrl=null,this.walletText.setText("No wallet connected"),this.connectBtnText.setText("CONNECT PHANTOM"),this.nftPreview&&(this.nftPreview.destroy(),this.nftPreview=null)}),this.msgText=this.add.text(t/2,s*.92,"",{fontFamily:"Arial",fontSize:Math.round(14*i)+"px",color:"#ffd6d6"}).setOrigin(.5)}startNameInput(){this.playerName=this.playerName||"",!this.nameKeyListener&&(this.nameDisplay.setText(this.playerName+"|"),this.nameKeyListener=e=>{if(e.key==="Enter"){this.nameDisplay.setText(this.playerName||""),this.input.keyboard.off("keydown",this.nameKeyListener),this.nameKeyListener=null;return}e.key==="Backspace"?this.playerName=this.playerName.slice(0,-1):e.key.length===1&&this.playerName.length<20&&(this.playerName+=e.key),this.nameDisplay.setText(this.playerName+"|")},this.input.keyboard.on("keydown",this.nameKeyListener))}async fetchAndShowNft(){if(this.walletAddress){this.msgText.setText("Searching NFT...");try{const{findFirstNftImageForOwner:e}=await M(async()=>{const{findFirstNftImageForOwner:s}=await import("./solana_nft-86y89O3K.js");return{findFirstNftImageForOwner:s}},__vite__mapDeps([0,1,2]),import.meta.url),t=await e(this.walletAddress,{network:"devnet"});t?(this.nftImageUrl=t,this.nftPreview&&this.nftPreview.destroy(),this.load.image("cfg_nft",t),this.load.once("complete",()=>{try{this.nftPreview=this.add.image(this.cameras.main.width*.85,this.cameras.main.height*.35,"cfg_nft").setOrigin(.5).setScale(.18).setDepth(10)}catch(s){console.warn("Failed nft preview",s)}}),this.load.start(),this.msgText.setText("NFT found")):this.msgText.setText("No NFT found")}catch(e){console.error("fetchAndShowNft error",e),this.msgText.setText("Error searching NFT")}this.time.delayedCall(2500,()=>{this.msgText.setText("")})}}saveConfig(){if(this.playerName){try{localStorage.setItem("playerName",this.playerName)}catch{}this.showTempMessage("Settings saved")}else this.showTempMessage("Enter a name before saving")}showTempMessage(e,t=2e3){this.msgText&&this.msgText.setText(e),this.time.delayedCall(t,()=>{this.msgText&&this.msgText.setText("")})}}const D={type:Phaser.AUTO,width:window.innerWidth,height:window.innerHeight,backgroundColor:"#000000",physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scene:[k,O,_],scale:{mode:Phaser.Scale.RESIZE,autoCenter:Phaser.Scale.CENTER_BOTH}};function P(){try{const f=document.createElement("script");f.src="https://vercel.com/speed-insights/script.js",f.defer=!0,document.head.appendChild(f),console.log("üìä Speed Insights initialized")}catch(f){console.warn("‚ö†Ô∏è Failed to initialize Speed Insights:",f)}}function x(){const f=document.getElementById("loading");f&&(f.style.display="none")}function w(f){const e=document.getElementById("error"),t=document.getElementById("loading");t&&(t.style.display="none"),e&&(e.style.display="block",e.textContent=`Erro: ${f}`)}try{console.log("üöÄ Iniciando Space Crypto Miner...");const f=new Phaser.Game(D);f.events.once("boot",()=>{console.log("üéÆ Game booted"),x()}),f.events.once("scenecreate",()=>{console.log("üé¨ First scene created"),x()}),setTimeout(()=>{console.log("‚è∞ Force hiding loading screen"),x()},1e3),window.addEventListener("resize",()=>{f.scale.resize(window.innerWidth,window.innerHeight)}),f.events.on("error",e=>{console.error("Game error:",e),w("Erro ao carregar o jogo")}),window.game=f,T(),P(),console.log("‚úÖ Jogo inicializado com sucesso!"),setTimeout(()=>{x(),console.log("‚è∞ Loading screen hidden by timeout")},3e3)}catch(f){console.error("‚ùå Erro ao inicializar o jogo:",f),w("Falha na inicializa√ß√£o do jogo")}window.addEventListener("error",f=>{console.error("Uncaught error:",f.error),w("Erro inesperado no jogo")});window.addEventListener("unhandledrejection",f=>{console.error("Unhandled promise rejection:",f.reason),w("Erro de promise n√£o tratada")});
