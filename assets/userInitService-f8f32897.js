async function u(s,e,i=null){var n,d,c,_;try{console.log("üîç Verificando inicializa√ß√£o do usu√°rio:",e);const{data:o,error:r}=await s.from("user_profiles").select("id").eq("google_email",e).maybeSingle();if(r)throw console.error("‚ùå Erro ao verificar perfil:",r),new Error("Failed to check user profile: "+r.message);if(o)return console.log("‚úÖ Usu√°rio j√° inicializado. Profile ID:",o.id),{success:!0,message:"User already initialized",profile_id:o.id};console.log("‚ö†Ô∏è Perfil n√£o encontrado. Inicializando dados do usu√°rio...");const f=((n=i==null?void 0:i.user_metadata)==null?void 0:n.name)||((d=i==null?void 0:i.user_metadata)==null?void 0:d.full_name)||e.split("@")[0],m=((c=i==null?void 0:i.user_metadata)==null?void 0:c.picture)||((_=i==null?void 0:i.user_metadata)==null?void 0:_.avatar_url)||null,p=(i==null?void 0:i.id)||null,{data:t,error:l}=await s.rpc("initialize_user_data",{p_google_email:e,p_display_name:f,p_avatar_url:m,p_auth_user_id:p});if(l)throw console.error("‚ùå Erro ao inicializar dados do usu√°rio:",l),new Error("Failed to initialize user data: "+l.message);if(!t||t.length===0)throw console.error("‚ùå Nenhum resultado retornado da inicializa√ß√£o"),new Error("No result returned from initialization");const a=t[0];if(!a.success)throw console.error("‚ùå Falha na inicializa√ß√£o:",a.message),new Error("Initialization failed: "+a.message);return console.log("‚úÖ Dados do usu√°rio inicializados com sucesso!"),console.log("üìä IDs criados:",{profile_id:a.profile_id,settings_id:a.settings_id,stats_id:a.stats_id,wallet_id:a.wallet_id}),{success:!0,message:a.message,profile_id:a.profile_id,settings_id:a.settings_id,stats_id:a.stats_id,wallet_id:a.wallet_id}}catch(o){throw console.error("‚ùå Erro em ensureUserInitialized:",o),o}}export{u as e};
