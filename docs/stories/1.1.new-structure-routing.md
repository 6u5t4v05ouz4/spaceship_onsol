# Story 1.1: Configuração da Nova Estrutura e Roteamento Básico

## Status

approved

---

## Story

**As a** Arquiteto/Desenvolvedor,
**I want** criar a nova estrutura de pastas (`src/web/`, `src/game/`, `src/shared/`) e configurar um roteador JavaScript básico,
**so that** a base organizacional do site esteja estabelecida e a navegação inicial seja possível.

---

## Acceptance Criteria

1. ✅ Estrutura de pastas `src/web`, `src/game`, `src/shared` criada
2. ✅ Roteador JS configurado para `/`, `/login`, `/dashboard`, `/profile`, `/auth-callback`
3. ✅ `vite.config.js` atualizado para ponto de entrada único
4. ✅ Página inicial simples (`/`) renderiza via roteador
5. ✅ `npm run build` e `npm run preview` funcionam

---

## Dev Notes

### Previous Story Insights

- N/A - Esta é a primeira história de implementação do épico (História 1.0 de backup foi pulada)

### Estrutura de Diretórios Atual vs. Desejada

**Estado Atual (Brownfield):**
- Múltiplos arquivos HTML na raiz: `index.html`, `game.html`, `dashboard.html`, `login.html`, `profile.html`, `auth-callback.html`
- Código fonte em `src/` com organização mista entre jogo Phaser e lógica web
- Estrutura confusa com backup files e duplicações
[Source: architecture/02-high-level-overview.md, architecture/03-module-organization.md]

**Estado Desejado:**
- `src/web/` - Componentes e páginas do site (Login, Dashboard, Profile)
- `src/game/` - Lógica exclusiva do Phaser (scenes, managers)
- `src/shared/` - Código compartilhado (auth, config, utils, styles)
- Ponto de entrada único em `index.html` com roteamento SPA (Single Page Application)
[Source: epic-1-refactoring.md]

### Roteador Sugerido

**Recomendação:** Usar a biblioteca `page.js` (leve, sem dependências pesadas)
- **Alternativa:** `navigo.js` ou `router5.js` se necessário recursos avançados
- **Compatibilidade:** Deve integrar com Phaser 3.90.0 e Vite 7.1.9
[Source: epic-1-refactoring.md]

### Vite Configuration Updates

**Mudança Crítica:** 
- `vite.config.js` atualmente suporta múltiplos pontos de entrada
- Novo config deve definir **ponto de entrada único**: `index.html`
- Manter configuração de dev server customizado (`dev-server.cjs`) para OAuth local redirect handling
[Source: architecture/05-api-specifications.md#proxy-de-desenvolvimento]

**Comportamento Esperado:**
- `npm run dev` → Inicia servidor em `localhost:3000` (ou porta configurada)
- `npm run build` → Gera bundle único em `/dist/`
- `npm run preview` → Testa build local

### Estrutura de Código Compartilhado (`src/shared/`)

Deve incluir (não criar ainda, apenas preparar estrutura):
- **`config/`** - Configurações (já existe em `src/config/`)
- **`auth.js`** - Lógica de autenticação (já existe)
- **`styles/`** - Estilos CSS globais (já existe em `src/styles/`)
- **`utils/`** - Funções utilitárias (já existe em `src/utils/`)

**Nota:** Esta história apenas **reorganiza estrutura**, não refatora o código existente.
[Source: architecture/03-module-organization.md]

### Package.json Entry Point

**Mudança Necessária:**
- Campo `"main"` ou entrada do build deve apontar para `index.html` único
- Script `"dev"` e `"build"` devem funcionar com novo ponto de entrada
- Campo `"type": "module"` mantido para suporte a ES modules
[Source: architecture/02-high-level-overview.md#arquivos-críticos-para-compreender-o-sistema]

### Arquivos HTML Obsoletos

**Após esta história:**
- Os arquivos HTML antigos (`login.html`, `dashboard.html`, etc) devem ser **movidos para `/backup/`** ou deletados
- Serão substituídos por componentes dinâmicos renderizados via roteador
- Limpeza completa será feita na História 1.8

### Testing

**Padrão de Testes para esta História:**
- Testes de navegação/roteamento (E2E com Playwright ou Vitest + Jsdom)
- Verificação se roteador carrega componentes corretos para cada rota
- Testes de build (se `npm run build` e `npm run preview` funcionam)
[Source: docs/architecture/testing-strategy.md - a ser lido]

---

## Tasks / Subtasks

- [ ] **Task 1: Criar Estrutura de Diretórios** (AC: 1)
  - [ ] Criar pasta `src/web/` com subpastas: `pages/`, `components/`, `services/`
  - [ ] Criar pasta `src/game/` e mover/reorganizar código Phaser existente (scenes, managers)
  - [ ] Criar pasta `src/shared/` e preparar reorganização de código comum
  - [ ] Atualizar `.gitignore` se necessário para novas estruturas

- [ ] **Task 2: Instalar e Configurar Roteador** (AC: 2)
  - [ ] Instalar `page.js` via npm: `npm install page`
  - [ ] Criar arquivo `src/shared/router.js` com configuração base do roteador
  - [ ] Definir rotas: `/`, `/login`, `/dashboard`, `/profile`, `/auth-callback`
  - [ ] Implementar fallback para rota padrão (`/`)
  - [ ] Documentar padrão de adição de novas rotas

- [ ] **Task 3: Criar Arquivo Entrada Única `index.html`** (AC: 3, 4)
  - [ ] Criar novo `index.html` na raiz com estrutura SPA básica
  - [ ] Incluir elemento `<div id="app"></div>` para renderização dinâmica
  - [ ] Importar arquivo main JS (ex: `src/main.js`)
  - [ ] Incluir tags meta básicas (viewport, charset)
  - [ ] Remover/backup dos múltiplos HTMLs antigos

- [ ] **Task 4: Criar Página Inicial Básica** (AC: 4)
  - [ ] Criar arquivo `src/web/pages/HomePage.js` com conteúdo simples
  - [ ] Página deve renderizar texto: "Welcome to Space Crypto Miner" e links para outras rotas
  - [ ] Conectar rota `/` ao HomePage via roteador

- [ ] **Task 5: Atualizar vite.config.js** (AC: 3)
  - [ ] Configurar ponto de entrada único: `index.html`
  - [ ] Manter configuração de dev server customizado se necessário
  - [ ] Verificar compatibilidade com Phaser 3.90.0
  - [ ] Testar build process: `npm run build`

- [ ] **Task 6: Atualizar package.json** (AC: 3)
  - [ ] Remover/atualizar múltiplos pontos de entrada se existirem
  - [ ] Verificar scripts `dev`, `build`, `preview`
  - [ ] Confirmar que dependências incluem `page.js`

- [ ] **Task 7: Criar Arquivo main.js** (AC: 4)
  - [ ] Criar `src/main.js` como ponto de entrada principal
  - [ ] Inicializar roteador
  - [ ] Renderizar página inicial
  - [ ] Gerenciar transições entre rotas

- [ ] **Task 8: Testes Funcionais** (AC: 4, 5)
  - [ ] Executar `npm run dev` e verificar se homepage renderiza em `localhost:3000/`
  - [ ] Testar navegação: clicar em link `/login` deve carregar página de login
  - [ ] Testar navegação: clicar em link `/dashboard` deve carregar página de dashboard
  - [ ] Testar `npm run build` sem erros
  - [ ] Testar `npm run preview` e verificar build final funciona

- [ ] **Task 9: Documentação Técnica** (AC: todas)
  - [ ] Documentar padrão de criação de novas páginas/componentes
  - [ ] Documentar estrutura do roteador e como adicionar rotas
  - [ ] Criar README em `src/web/` explicando organização
  - [ ] Atualizar documentação de arquitetura se necessário

---

## Testing

### Padrão de Testes para esta História

- **Test Framework:** Vitest (ou Jest se preferir)
- **E2E Framework:** Playwright ou Cypress (opcional para esta sprint)
- **Localização de Testes:** `tests/` na raiz ou `src/**/*.test.js`

### Testes Específicos Necessários

1. **Teste de Roteamento Básico:**
   - Verificar que ao navegar para `/`, a HomePage renderiza
   - Verificar que ao navegar para `/login`, carrega página de login
   - Verificar que rotas inválidas redirecionam para home

2. **Teste de Build:**
   - `npm run build` deve completar sem erros
   - Arquivos devem estar em `dist/`
   - `npm run preview` deve servir build com sucesso

3. **Teste de Estrutura:**
   - Diretórios `src/web/`, `src/game/`, `src/shared/` devem existir
   - Arquivos main.js, router.js devem estar presentes

[Source: docs/architecture/testing-strategy.md]

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-18 | 1.0 | Initial story created by Scrum Master | Bob (SM) |

---

## Dev Agent Record

*To be populated during implementation by the development agent.*

### Agent Model Used

TBD

### Debug Log References

TBD

### Completion Notes List

TBD

### File List

TBD

---

## QA Results

*To be populated by QA Agent after story implementation.*
