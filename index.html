<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Space Crypto Miner — Início</title>
    <link rel="icon" href="/assets/icones/icone.png">
    <style>
        :root{
            --bg:#000814;
            --panel:#001a18;
            --accent:#00ffcc;
            --muted:#66fff0;
            --danger:#ff6666;
            --glass: rgba(0,26,24,0.7);
            --card-radius:14px;
            --max-width:1100px;
            font-family: Arial, Helvetica, sans-serif;
            color-scheme: dark;
        }
        html,body{height:100%;margin:0;background:linear-gradient(180deg,#000814 0%, #001220 60%);color:#dffaf6}
        .wrap{max-width:var(--max-width);margin:28px auto;padding:20px}
        header{display:flex;align-items:center;justify-content:space-between;gap:16px}
        .brand{display:flex;align-items:center;gap:12px}
        .brand img{width:56px;height:56px}
        .brand h1{margin:0;font-size:20px;color:var(--accent)}
        .top-actions{display:flex;gap:12px;align-items:center}
        .btn{background:var(--panel);border:1px solid rgba(0,255,204,0.06);padding:10px 14px;border-radius:10px;color:#ccfff6;cursor:pointer}
        .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04)}
        .layout{display:grid;grid-template-columns:360px 1fr;gap:20px;margin-top:22px}
        .card{background:var(--panel);border-radius:var(--card-radius);padding:16px;box-shadow:0 6px 24px rgba(0,0,0,0.6)}
        .profile .avatar{width:100%;height:180px;background:linear-gradient(90deg,#042428,#002028);border-radius:10px;display:flex;align-items:center;justify-content:center}
        .profile .avatar img{max-width:92%;max-height:92%;border-radius:8px}
        .field{margin-top:12px}
        .field label{display:block;font-size:13px;color:#9feee6;margin-bottom:6px}
        .field input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted)}
        .modes{display:flex;flex-direction:column;gap:12px}
        .mode{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:10px;background:linear-gradient(90deg,rgba(0,255,204,0.02),transparent)}
        .leaderboard{margin-top:18px}
        footer{margin-top:20px;text-align:center;color:#88fff0;opacity:0.9}
        /* Play overlay (the phaser container will mount here) */
        #game-launch{position:fixed;inset:0;display:none;background:rgba(0,0,0,0.85);align-items:center;justify-content:center;z-index:60}
        #game-container{width:100%;height:100%;max-width:100%;max-height:100%}
        .play-area{display:flex;align-items:center;gap:12px}
        .play-btn{background:linear-gradient(90deg,#00ffcc,#66fff0);color:#001a18;padding:18px 28px;border-radius:12px;font-size:20px;font-weight:700;border:none;cursor:pointer}
        .small{font-size:13px;color:#9feee6}
        @media(max-width:900px){.layout{grid-template-columns:1fr}.brand h1{font-size:18px}}
    </style>
</head>
<body>
    <div class="wrap">
        <header>
            <div class="brand">
                <img src="/assets/icones/icone.png" alt="logo">
                <div>
                    <h1>SPACE CRYPTO MINER</h1>
                    <div class="small">Conquiste o espaço com sua carteira Phantom</div>
                </div>
            </div>
            <div class="top-actions">
                <button id="connectPhantom" class="btn">Conectar Phantom</button>
                <button id="openPlay" class="btn play-btn">PLAY</button>
            </div>
        </header>

        <div class="layout">
            <aside class="card profile">
                <div class="avatar" id="nftAvatar">
                    <img id="avatarImg" src="/assets/icones/astronauta.png" alt="avatar">
                </div>
                <div class="field">
                    <label>Nome do jogador</label>
                    <input id="playerName" placeholder="Digite seu nome (ex: Pilot123)">
                </div>
                <div class="field">
                    <label>Carteira</label>
                    <div id="walletAddr" class="small">Nenhuma carteira conectada</div>
                </div>
                <div class="field">
                    <label>Status do NFT</label>
                    <div id="nftStatus" class="small">Nenhum NFT detectado</div>
                </div>
                <div style="margin-top:12px;display:flex;gap:8px;">
                    <button id="saveBtn" class="btn">Salvar</button>
                    <button id="disconnectBtn" class="btn ghost">Desconectar</button>
                </div>
            </aside>

            <main>
                <div class="card">
                    <h3>Modos</h3>
                    <div class="modes">
                        <div class="mode"><div>PVE</div><div class="small">Explorar e minerar</div></div>
                        <div class="mode"><div>PVP</div><div class="small">Combates contra outros pilotos</div></div>
                        <div class="mode"><div>Event</div><div class="small">Eventos especiais</div></div>
                    </div>

                    <div class="leaderboard card" style="margin-top:14px;padding:12px;background:linear-gradient(90deg,rgba(0,255,204,0.02),transparent)">
                        <h4>Leaderboard (placeholder)</h4>
                        <ol id="leaders">
                            <li>—</li>
                        </ol>
                    </div>
                </div>

                <div class="card" style="margin-top:16px">
                    <h4>Sobre</h4>
                    <p class="small">Este é um protótipo onde jogadores podem usar NFTs para customizar suas naves. Use Phantom para conectar sua carteira (Devnet para testes).</p>
                </div>
            </main>
        </div>

        <footer>
            <div>ALPHA 0.0.1 • Desenvolvido para demo</div>
        </footer>
    </div>

    <div id="game-launch">
        <div id="game-container"></div>
    </div>

    <script type="module">
        import { findFirstNftImageForOwner } from '/src/solana_nft.js';

        // Basic UI wiring
        const connectBtn = document.getElementById('connectPhantom');
        const openPlay = document.getElementById('openPlay');
        const playerNameInput = document.getElementById('playerName');
        const walletAddrEl = document.getElementById('walletAddr');
        const nftStatusEl = document.getElementById('nftStatus');
        const avatarImg = document.getElementById('avatarImg');
        const saveBtn = document.getElementById('saveBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');

        // Load saved name
        try { const saved = localStorage.getItem('playerName'); if (saved) playerNameInput.value = saved; } catch(e){}

        async function connectPhantom() {
            if (!(window && window.solana && window.solana.isPhantom)) { alert('Instale Phantom ou abra o site num navegador com a extensão Phantom'); return; }
            try {
                const resp = await window.solana.connect();
                const pub = resp.publicKey ? resp.publicKey.toString() : (window.solana.publicKey && window.solana.publicKey.toString());
                walletAddrEl.textContent = pub;
                // try to find NFT image (devnet by default)
                nftStatusEl.textContent = 'Buscando NFT...';
                const imageUrl = await findFirstNftImageForOwner(pub, { network: 'devnet' });
                if (imageUrl) {
                    nftStatusEl.textContent = 'NFT encontrado';
                    avatarImg.src = imageUrl;
                } else {
                    nftStatusEl.textContent = 'Nenhum NFT encontrado';
                }
                window.__GAME_CONFIG__ = { playerName: playerNameInput.value || 'Piloto', walletAddress: pub, nftImage: imageUrl || null };
                connectBtn.textContent = 'Conectado';
            } catch(e) {
                console.error('connect error', e); alert('Falha ao conectar Phantom');
            }
        }

        connectBtn.addEventListener('click', connectPhantom);
        disconnectBtn.addEventListener('click', async () => {
            if (window && window.solana && window.solana.isPhantom) { try { await window.solana.disconnect(); } catch(e){} }
            walletAddrEl.textContent = 'Nenhuma carteira conectada';
            nftStatusEl.textContent = 'Nenhum NFT detectado';
            avatarImg.src = '/assets/icones/astronauta.png';
            window.__GAME_CONFIG__ = null;
            connectBtn.textContent = 'Conectar Phantom';
        });

        saveBtn.addEventListener('click', () => {
            const name = playerNameInput.value.trim();
            if (!name) return alert('Digite um nome antes de salvar');
            try { localStorage.setItem('playerName', name); } catch(e){}
            window.__GAME_CONFIG__ = window.__GAME_CONFIG__ || {};
            window.__GAME_CONFIG__.playerName = name;
            alert('Configurações salvas');
        });

        openPlay.addEventListener('click', () => {
            // Prepare config and show phaser container
            const cfg = window.__GAME_CONFIG__ || { playerName: playerNameInput.value || 'Piloto', walletAddress: null, nftImage: null };
            window.__GAME_CONFIG__ = cfg;
            document.getElementById('game-launch').style.display = 'flex';
            // mount phaser (main.js uses #game-container)
            import('/src/main.js');
        });

        // Expose quick helper for debugging
        window.__connectPhantom = connectPhantom;
    </script>
</body>
</html>